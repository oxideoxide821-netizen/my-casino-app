<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>ELITE DEB CASINO</title>
  <style>
    :root {
      --gold: #f3ba2f;
      --bg: #050608;
      --card: #101219;
      --accent: #00f2ff;
      --red: #ff4757;
      --text-soft: #a9b3c1;
      --rare: #4dd0e1;
      --epic: #ce93d8;
      --legend: #f3ba2f;
      --myth: #ff7675;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #151827 0, #050608 55%);
      color: #fff;
      height: 100vh;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .header {
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(10px);
      background: linear-gradient(to right, rgba(10,12,20,.95), rgba(10,12,20,.8));
      border-bottom: 1px solid rgba(255,255,255,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .brand {
      font-weight: 800;
      letter-spacing: .08em;
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-soft);
    }
    .brand span { color: var(--accent); }
    .bal-box {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 11px;
    }
    .bal-main {
      font-size: 18px;
      font-weight: 900;
      color: var(--gold);
      text-shadow: 0 0 8px rgba(243,186,47,.4);
    }
    .bal-sub { color: var(--text-soft); font-size: 10px; }

    .page {
      height: calc(100vh - 80px);
      padding: 14px 14px 100px;
      overflow-y: auto;
      display: none;
    }
    .page.active { display: block; }

    /* –£–õ–£–ß–®–ò–¢–ï–õ–¨ NFT */
    .upgrader-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 350;
    }
    .upgrader {
      width: 90vw;
      max-width: 380px;
      background: linear-gradient(145deg, #111321, #05060c);
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .upgrader-header {
      text-align: center;
      margin-bottom: 16px;
    }
    .upgrader-title { font-size: 16px; font-weight: 800; margin-bottom: 4px; }
    .upgrade-circle {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      margin: 0 auto 20px;
      position: relative;
      background: radial-gradient(circle, rgba(243,186,47,0.2) 0%, transparent 70%);
      border: 4px solid rgba(243,186,47,0.4);
    }
    .circle-fill {
      position: absolute;
      inset: 8px;
      border-radius: 50%;
      background: conic-gradient(#f3ba2f 0deg var(--success-deg, 0deg), rgba(243,186,47,0.2) var(--success-deg, 0deg) 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      font-weight: 900;
      color: #000;
      text-shadow: 0 1px 2px rgba(255,255,255,0.5);
    }
    .upgrade-nft {
      width: 100px;
      height: 100px;
      border-radius: 16px;
      margin: 0 auto 12px;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.15), transparent 50%);
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(243,186,47,0.6);
      box-shadow: 0 8px 24px rgba(243,186,47,0.3);
    }
    .upgrade-nft::before {
      content: "‚ú®";
      position: absolute;
      font-size: 24px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .upgrade-btns {
      display: flex;
      gap: 8px;
      margin: 16px 0;
    }
    .btn-upgrade {
      flex: 1;
      border-radius: 12px;
      padding: 12px;
      border: none;
      font-size: 13px;
      font-weight: 700;
      background: linear-gradient(135deg, #f3ba2f, #ffe38b);
      color: #000;
    }
    .upgrade-cost { 
      text-align: center; 
      font-size: 12px; 
      color: var(--gold); 
      font-weight: 600;
      margin: 8px 0;
    }
    .upgrade-risk { 
      text-align: center; 
      font-size: 11px; 
      color: var(--red); 
      margin-bottom: 16px;
    }

    /* CASES GRID - –£–õ–£–ß–®–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù –ö–ï–ô–°–û–í */
    .case-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .case3d-wrap {
      perspective: 900px;
    }

    .case-card {
      position: relative;
      border-radius: 20px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 20px 40px rgba(0,0,0,0.85);
      transform-style: preserve-3d;
      transform: rotateY(0deg) rotateX(0deg);
      transition: transform .28s cubic-bezier(0.25,0.46,0.45,0.94), box-shadow .28s ease, border-color .28s ease;
      overflow: hidden;
      background: linear-gradient(145deg, #1a1d2a, #0a0c14);
    }
    .case-card::before {
      content: "";
      position: absolute;
      inset: -50%;
      background: conic-gradient(from 220deg, rgba(0,242,255,0.35), transparent, rgba(243,186,47,0.45), transparent);
      opacity: 0;
      transition: .28s;
      mix-blend-mode: screen;
      animation: rotateGlow 8s linear infinite;
    }
    @keyframes rotateGlow {
      to { transform: rotate(360deg); }
    }
    .case-card:hover {
      transform: rotateY(12deg) rotateX(-6deg) translateY(-4px);
      box-shadow: 0 28px 55px rgba(0,0,0,0.98), 0 0 30px rgba(243,186,47,0.4);
      border-color: rgba(243,186,47,0.8);
    }
    .case-card:hover::before { opacity: 1; }

    /* –ö–ï–ô–° - –†–ï–ê–õ–ò–°–¢–ò–ß–ù–´–ô */
    .case-top {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 8px;
    }

    .case-box3d {
      width: 60px;
      height: 60px;
      position: relative;
      transform-style: preserve-3d;
      transform: rotateX(-20deg) rotateY(-28deg) translateZ(10px);
      transition: transform .3s ease;
    }
    .case-card:hover .case-box3d {
      transform: rotateX(-14deg) rotateY(-10deg) translateZ(16px);
    }
    .case-face {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      background: linear-gradient(145deg, #22263c, #090b12);
      box-shadow: 0 4px 16px rgba(0,0,0,0.9), inset 0 1px 3px rgba(255,255,255,0.1);
      backface-visibility: hidden;
    }
    .case-top-face {
      transform: rotateX(90deg) translateZ(30px);
      background: linear-gradient(135deg, #2a314b, #151827);
      border-radius: 12px 12px 0 0;
    }
    .case-front-face {
      transform: translateZ(30px);
      border-radius: 0 12px 12px 12px;
    }
    .case-left-face {
      transform: rotateY(-90deg) translateZ(30px);
      border-radius: 12px 0 12px 12px;
    }
    .case-right-face {
      transform: rotateY(90deg) translateZ(30px);
      border-radius: 0 12px 12px 12px;
    }
    
    /* –ö–õ–Æ–ß–ò –ò –ó–ê–ú–ö–ò –ù–ê –ö–ï–ô–°–ï */
    .case-lock {
      position: absolute;
      width: 16px;
      height: 20px;
      background: #8b4513;
      border-radius: 3px 3px 8px 8px;
      top: 12px;
      right: 8px;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), 0 2px 4px rgba(0,0,0,0.4);
    }
    .case-lock::before {
      content: "";
      position: absolute;
      width: 20px;
      height: 8px;
      background: #654321;
      border-radius: 4px;
      top: -6px;
      left: -2px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.4);
    }
    .case-keyhole {
      position: absolute;
      width: 4px;
      height: 6px;
      background: #333;
      border-radius: 1px;
      bottom: 4px;
      left: 6px;
    }

    .case-meta { flex: 1; transform: translateZ(14px); }
    .case-title {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: .1em;
      color: #cfd6ff;
      margin-bottom: 2px;
    }
    .case-name { 
      font-size: 14px; 
      font-weight: 800; 
      margin-bottom: 2px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .case-rarity { 
      font-size: 10px; 
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 12px;
      display: inline-block;
      border: 1px solid;
    }
    .case-card[data-tier="COMMON"] .case-rarity { color: #9ca3af; border-color: #9ca3af; }
    .case-card[data-tier="RARE"] .case-rarity { color: var(--rare); border-color: var(--rare); }
    .case-card[data-tier="EPIC"] .case-rarity { color: var(--epic); border-color: var(--epic); }
    .case-card[data-tier="LEGEND"] .case-rarity { color: var(--legend); border-color: var(--legend); }
    .case-card[data-tier="MYTH"] .case-rarity { color: var(--myth); border-color: var(--myth); }

    .case-price {
      margin-top: 8px;
      font-size: 13px;
      font-weight: 800;
      color: var(--gold);
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }
    .case-price span { 
      font-size: 10px; 
      color: var(--text-soft); 
      opacity: 0.9;
    }

    .case-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: var(--text-soft);
    }
    .case-btn {
      border-radius: 20px;
      padding: 6px 14px;
      border: none;
      background: linear-gradient(135deg, #f3ba2f, #ffdf7f);
      color: #000;
      font-size: 10px;
      font-weight: 900;
      box-shadow: 0 4px 12px rgba(243,186,47,0.4);
      text-transform: uppercase;
      letter-spacing: .05em;
    }
    .case-btn:active {
      transform: scale(0.95);
    }

    .stat-card {
      background: linear-gradient(135deg,#151728,#0a0c14);
      border-radius: 20px;
      padding: 16px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 20px 40px rgba(0,0,0,0.7);
      margin-bottom: 16px;
    }

    .small { font-size: 11px; color: var(--text-soft); }

    .profile-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .avatar {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #1f2340, #090b12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 800;
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    }
    .profile-name { font-size: 14px; font-weight: 800; }
    .profile-tag { font-size: 11px; color: var(--text-soft); }
    .badge {
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid rgba(243,186,47,.8);
      color: var(--gold);
      background: rgba(243,186,47,.15);
      font-weight: 700;
    }

    .nft-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .nft-card {
      border-radius: 18px;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 16px 35px rgba(0,0,0,0.85);
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at top, #181a2c, #090b13);
      cursor: pointer;
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .nft-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 24px 50px rgba(0,0,0,0.95);
    }
    .nft-card.upgradable {
      border-color: rgba(243,186,47,0.6);
      box-shadow: 0 16px 35px rgba(243,186,47,0.3);
    }
    .nft-inner {
      border-radius: 14px;
      padding: 12px;
      background: radial-gradient(circle at top, #20223a, #06070f);
      position: relative;
      overflow: hidden;
    }
    .nft-bg-shape {
      position: absolute;
      inset: -40%;
      background: conic-gradient(from 180deg, rgba(0,242,255,0.45), transparent, rgba(243,186,47,0.35), transparent);
      opacity: 0.7;
      mix-blend-mode: screen;
      animation: nftRotate 12s linear infinite;
    }
    @keyframes nftRotate {
      to { transform: rotate(360deg); }
    }
    .nft-figure {
      position: relative;
      width: 100%;
      height: 80px;
      border-radius: 12px;
      background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.2), transparent 60%);
      overflow: hidden;
      margin-bottom: 8px;
    }
    .nft-stripe {
      position: absolute;
      width: 180%;
      height: 24px;
      background: linear-gradient(90deg, rgba(255,255,255,0.7), transparent);
      transform: rotate(-25deg);
      top: 12px;
      left: -50%;
      animation: stripeMove 3s linear infinite;
    }
    @keyframes stripeMove {
      to { transform: translateX(100%) rotate(-25deg); }
    }
    .nft-stripe:nth-child(2) { top: 40px; animation-delay: 1s; opacity: .6; }
    .nft-stripe:nth-child(3) { top: 65px; animation-delay: 2s; opacity: .3; }

    .nft-name { 
      font-size: 13px; 
      font-weight: 700; 
      margin-bottom: 4px;
      position: relative;
      z-index: 1;
    }
    .nft-meta { 
      font-size: 11px; 
      color: var(--text-soft); 
      position: relative;
      z-index: 1;
      font-weight: 600;
    }

    .upgrade-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(243,186,47,0.9);
      color: #000;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 9px;
      font-weight: 900;
      text-transform: uppercase;
    }

    .nav {
      position: fixed;
      left: 14px;
      right: 14px;
      bottom: 18px;
      background: rgba(8,9,16,0.97);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 24px 50px rgba(0,0,0,0.95);
      display: flex;
      justify-content: space-around;
      padding: 12px 10px;
      z-index: 200;
    }
    .nav-i {
      font-size: 22px;
      opacity: 0.5;
      transition: .25s;
      padding: 8px;
      border-radius: 16px;
    }
    .nav-i.active {
      opacity: 1;
      color: var(--gold);
      transform: translateY(-4px) scale(1.08);
      background: rgba(243,186,47,0.15);
    }

    .modal-back {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
      backdrop-filter: blur(8px);
    }
    .modal {
      width: 92%;
      max-width: 380px;
      background: linear-gradient(145deg, #111321, #05060c);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 30px 60px rgba(0,0,0,0.95);
      padding: 20px;
      max-height: 85vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .modal-title { font-size: 16px; font-weight: 800; }
    .pill {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 20px;
      background: rgba(0,242,255,0.2);
      color: var(--accent);
      font-weight: 700;
      border: 1px solid rgba(0,242,255,0.4);
    }
    .modal-actions {
      margin-top: 16px;
      display: flex;
      gap: 12px;
    }
    .btn {
      flex: 1;
      border-radius: 20px;
      padding: 12px;
      border: none;
      font-size: 13px;
      font-weight: 800;
      transition: all .2s ease;
    }
    .btn-primary {
      background: linear-gradient(135deg, #f3ba2f, #ffe38b);
      color: #000;
      box-shadow: 0 8px 24px rgba(243,186,47,0.4);
    }
    .btn-primary:active { transform: scale(0.96); }
    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.25);
      color: #fff;
      backdrop-filter: blur(10px);
    }
    .btn-ghost:active { transform: scale(0.96); }

    .pack-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 16px;
      background: rgba(21,23,39,0.8);
      margin-bottom: 10px;
      font-size: 12px;
      cursor: pointer;
      transition: all .2s ease;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .pack-row:hover, .pack-row.selected {
      background: rgba(243,186,47,0.15);
      border-color: rgba(243,186,47,0.4);
      transform: translateY(-1px);
    }
    .pack-title { font-weight: 800; }
    .pack-coins { color: var(--gold); font-weight: 800; font-size: 14px; }
    .pack-tag { font-size: 10px; color: var(--text-soft); }

    /* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ - –í–°–ï–ì–î–ê –í–ò–î–ò–ú–ê –î–õ–Ø –¢–ï–ë–Ø */
    #admin-panel {
      background: linear-gradient(135deg, #1a0d2a, #0a0514) !important;
      border: 2px solid rgba(243,186,47,0.8) !important;
      box-shadow: 0 0 40px rgba(243,186,47,0.6) !important;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="brand">ELITE <span>DEB</span></div>
    <div class="bal-box">
      <div class="bal-main"><span id="balance">15 000</span> ü™ô</div>
      <div class="bal-sub" id="event-label">üî• –û–≥–Ω–µ–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è</div>
    </div>
  </div>

  <!-- SHOP -->
  <div class="page active" id="p-shop">
    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-size:14px;font-weight:800;">üé∞ –ö–ï–ô–°–´</div>
        <button class="btn btn-primary" style="font-size:11px;padding:8px 16px;border-radius:20px;" onclick="openTopupModal()">‚≠ê –î–û–î–ï–ü</button>
      </div>
      <div class="small">üéÅ –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –∫–µ–π—Å—ã —Å –∑–∞–º–∫–∞–º–∏/–∫–ª—é—á–∞–º–∏. 100% CSS.</div>
    </div>
    <div class="case-grid" id="case-container"></div>
  </div>

  <!-- INVENTORY -->
  <div class="page" id="p-inv">
    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <div style="font-size:14px;font-weight:800;">üéí –ú–û–ô –ò–ù–í–ï–ù–¢–ê–†–¨</div>
        <button class="btn btn-primary" style="font-size:11px;padding:6px 12px;border-radius:16px;" onclick="craftItems()">‚öóÔ∏è –ö–†–ê–§–¢ 3‚Üí1</button>
      </div>
      <div class="small">NFT —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ª—É—á—à–µ–Ω–∏—è (–∫–∞–∫ –≤ Play's NFT Battle)</div>
    </div>
    <div id="inventory-empty" class="small" style="margin-top:12px;text-align:center;opacity:0.7;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ç–∫—Ä–æ–π –ø–∞—Ä—É –∫–µ–π—Å–æ–≤!</div>
    <div class="nft-grid" id="inventory-grid"></div>
  </div>

  <!-- PROFILE -->
  <div class="page" id="p-prof">
    <div class="stat-card">
      <div class="profile-head">
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="avatar"><span id="prof-initial">M</span></div>
          <div>
            <div class="profile-name" id="prof-name">–ò–≥—Ä–æ–∫</div>
            <div class="profile-tag" id="prof-username">@user</div>
          </div>
        </div>
        <div><div class="badge" id="prof-title">–ù–æ–≤–∏—á–æ–∫</div></div>
      </div>
      <div class="small">
        –í—Å–µ–≥–æ –∫–µ–π—Å–æ–≤: <span id="prof-cases">0</span> ‚Ä¢ –õ—É—á—à–∏–π –¥—Ä–æ–ø: <span id="prof-best">‚Äì</span>
      </div>
    </div>

    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <div style="font-size:14px;font-weight:800;">üìÜ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°</div>
        <span class="pill" id="daily-pill">–î–æ—Å—Ç—É–ø–µ–Ω</span>
      </div>
      <div class="small">–ë–æ–Ω—É—Å + –∏–≤–µ–Ω—Ç —à–∞–Ω—Å—ã!</div>
      <button class="btn btn-primary" style="margin-top:12px;" onclick="claimDaily()">–ó–ê–ë–†–ê–¢–¨ ü™ô</button>
    </div>

    <!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ - –¢–ï–ü–ï–†–¨ –í–°–ï–ì–î–ê –í–ò–î–ò–ú–ê –î–õ–Ø –¢–ï–ë–Ø -->
    <div class="stat-card" id="admin-panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="font-size:14px;font-weight:800;color:var(--gold);">üëë –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</div>
        <span class="pill" style="background:rgba(243,186,47,0.3);color:var(--gold);">MAX POWER</span>
      </div>
      <div class="modal-actions" style="gap:8px;margin-top:8px;">
        <button class="btn btn-primary" onclick="adminAddBalance()">+1M ü™ô</button>
        <button class="btn btn-primary" onclick="adminSetRich()">–í–°–ï–ú 10M</button>
        <button class="btn btn-primary" onclick="toggleEvent()">üî• –¢–û–ì–ì–õ –ò–í–ï–ù–¢</button>
      </div>
      <div class="small" style="margin-top:12px;opacity:.9;">–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å - –≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ ‚úÖ</div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="page" id="p-set">
    <div class="stat-card">
      <div style="font-size:14px;font-weight:800;margin-bottom:12px;">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <span class="small">–í–∏–±—Ä–∞—Ü–∏—è</span>
        <input type="checkbox" id="set-vibrate" checked>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <span class="small">–ó–≤—É–∫–∏</span>
        <input type="checkbox" id="set-sound" checked>
      </div>
      <button class="btn btn-ghost" style="margin-top:16px;" onclick="tg?.close()">‚ùå –í–´–ô–¢–ò</button>
    </div>
  </div>

  <!-- NFT DROP MODAL -->
  <div class="modal-back" id="drop-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">‚ú® –ù–æ–≤—ã–π NFT-–¥—Ä–æ–ø</div>
        <span class="pill" id="drop-rarity-pill">RARE</span>
      </div>
      <div class="nft-inner" style="margin:0 0 16px 0;padding:20px;border-radius:20px;">
        <div class="nft-bg-shape"></div>
        <div class="nft-figure" style="height:120px;">
          <div class="nft-stripe" style="animation-duration:2s;"></div>
          <div class="nft-stripe" style="animation-duration:2.5s;"></div>
          <div class="nft-stripe" style="animation-duration:3s;"></div>
        </div>
      </div>
      <div style="font-size:16px;font-weight:800;text-align:center;margin-bottom:6px;" id="drop-name">Virus Core #001</div>
      <div class="small" style="text-align:center;margin-bottom:20px;" id="drop-desc">–†–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç!</div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="rejectDrop()">‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è</button>
        <button class="btn btn-primary" onclick="acceptDrop()">‚úÖ –í –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
      </div>
    </div>
  </div>

  <!-- –£–õ–£–ß–®–ò–¢–ï–õ–¨ NFT MODAL -->
  <div class="upgrader-modal" id="upgrader-modal">
    <div class="upgrader">
      <div class="upgrader-header">
        <div class="upgrader-title">‚ö° –£–õ–£–ß–®–ò–¢–ï–õ–¨ NFT</div>
        <div class="upgrade-circle">
          <div class="circle-fill" id="upgrade-progress">0%</div>
        </div>
        <div class="upgrade-nft" id="upgrade-nft-preview"></div>
      </div>
      <div class="upgrade-cost" id="upgrade-cost">–£–ª—É—á—à–µ–Ω–∏–µ: 5 000 ü™ô</div>
      <div class="upgrade-risk">‚ö†Ô∏è –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ NFT: <span id="upgrade-risk">15%</span></div>
      <div class="upgrade-btns">
        <button class="btn btn-ghost" onclick="closeUpgrader()">‚ùå –û—Ç–º–µ–Ω–∞</button>
        <button class="btn btn-primary" onclick="performUpgrade()">üöÄ –£–õ–£–ß–®–ò–¢–¨</button>
      </div>
    </div>
  </div>

  <!-- TOPUP MODAL -->
  <div class="modal-back" id="topup-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">üíé –ö–∞—Å—Å–∞ ELITE DEB</div>
        <span class="pill">NFT BATTLE</span>
      </div>
      <div class="small" style="margin-bottom:16px;">–í—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç –º–æ–Ω–µ—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)</div>
      <div class="pack-row" onclick="selectPack(10000)">
        <div>
          <div class="pack-title">Starter</div>
          <div class="pack-tag">–î–ª—è —Ä–∞–∑–≥–æ–Ω–∞</div>
        </div>
        <div class="pack-coins">10 000 ü™ô</div>
      </div>
      <div class="pack-row" onclick="selectPack(50000)">
        <div>
          <div class="pack-title">Grinder</div>
          <div class="pack-tag">–ö–µ–π—Å—ã 24/7</div>
        </div>
        <div class="pack-coins">50 000 ü™ô</div>
      </div>
      <div class="pack-row" onclick="selectPack(250000)">
        <div>
          <div class="pack-title">Whale</div>
          <div class="pack-tag">NFT‚Äë–∏–º–ø–µ—Ä–∏—è</div>
        </div>
        <div class="pack-coins">250 000 ü™ô</div>
      </div>
      <div class="small" id="topup-selected" style="margin-top:12px;">–ü–∞–∫–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeTopupModal()">–ó–ê–ö–†–´–¢–¨</button>
        <button class="btn btn-primary" onclick="applyTopup()">–ü–û–ü–û–õ–ù–ò–¢–¨</button>
      </div>
    </div>
  </div>

  <div class="nav">
    <div class="nav-i active" onclick="openTab('p-shop', this)">üì¶</div>
    <div class="nav-i" onclick="openTab('p-inv', this)">üéí</div>
    <div class="nav-i" onclick="openTab('p-prof', this)">üëë</div>
    <div class="nav-i" onclick="openTab('p-set', this)">‚öôÔ∏è</div>
  </div>

  <audio id="snd-spin" src="https://cdn.freesound.org/previews/341/341695_6261196-lq.mp3"></audio>
  <audio id="snd-drop" src="https://cdn.freesound.org/previews/235/235909_3982175-lq.mp3"></audio>
  <audio id="snd-upgrade" src="https://cdn.freesound.org/previews/387/387739_4175099-lq.mp3"></audio>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.expand();

    const ADMIN_USERNAME = "Random06"; // –¢–í–û–ô –Æ–ó–ï–†–ù–ï–ô–ú
    const STORAGE_KEY = "elite_deb_state_css3d_v2";

    let state = {
      bal: 15000,
      inv: [],
      totalCases: 0,
      bestDropName: null,
      bestDropRarity: null,
      lastDaily: null,
      eventFireWeek: true
    };

    let currentUpgradingNFT = null;
    let selectedPack = null;

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) state = Object.assign(state, JSON.parse(raw));
      } catch(e) { console.log("Load state error:", e); }
    }
    function saveState() {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e) {}
    }
    loadState();

    const RARITY = [
      {code: "COMMON", label: "–û–ë–´–ß–ù–´–ô", color:"#9ca3af", weight:1},
      {code: "RARE", label:"–†–ê–†–ï", color:"#4dd0e1", weight:2},
      {code: "EPIC", label:"–≠–ü–ò–ö", color:"#ce93d8", weight:3},
      {code: "LEGEND", label:"–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô", color:"#f3ba2f", weight:4},
      {code: "MYTH", label:"–ú–ò–§–ò–ß–ï–°–ö–ò–ô", color:"#ff7675", weight:5}
    ];

    const NFTS = [
      { id:1, name:"Virus Core #001", rarity:"RARE", desc:"–°–µ—Ä–¥—Ü–µ –≤–∏—Ä—É—Å–∞", upgradeLevel: 0 },
      { id:2, name:"Toxic Blade #07", rarity:"EPIC", desc:"–¢–æ–∫—Å–∏—á–Ω–æ–µ –ª–µ–∑–≤–∏–µ", upgradeLevel: 0 },
      { id:3, name:"Crown of Glitch", rarity:"LEGEND", desc:"–ö–æ—Ä–æ–Ω–∞ —Å–±–æ—è", upgradeLevel: 0 },
      { id:4, name:"Neon Chip", rarity:"COMMON", desc:"–ù–µ–æ–Ω–æ–≤—ã–π —á–∏–ø", upgradeLevel: 0 },
      { id:5, name:"Quantum Shard", rarity:"MYTH", desc:"–ö–≤–∞–Ω—Ç–æ–≤—ã–π –æ—Å–∫–æ–ª–æ–∫", upgradeLevel: 0 }
    ];

    let CASES = [];
    const CASE_TEMPLATES = [
      { tier:"COMMON", basePrice: 1500, previewNFTs: [NFTS[3]] },
      { tier:"RARE", basePrice: 7500, previewNFTs: [NFTS[0]] },
      { tier:"EPIC", basePrice: 25000, previewNFTs: [NFTS[1]] },
      { tier:"LEGEND", basePrice: 120000, previewNFTs: [NFTS[2]] },
      { tier:"MYTH", basePrice: 400000, previewNFTs: [NFTS[4]] }
    ];

    function genCases() {
      CASES = [];
      let id = 1;
      for (let t of CASE_TEMPLATES) {
        for (let i = 0; i < 20; i++) {
          if (id > 100) break;
          CASES.push({
            id, name: `–ö–µ–π—Å #${id}`, tier: t.tier,
            price: t.basePrice * (1 + i * 0.2),
            previewNFTs: t.previewNFTs
          });
          id++;
        }
      }
      for (; id <= 220; id++) {
        const t = CASE_TEMPLATES[Math.floor(Math.random() * CASE_TEMPLATES.length)];
        CASES.push({
          id, name: `–ö–µ–π—Å #${id}`, tier: t.tier,
          price: t.basePrice * (1 + Math.random() * 5),
          previewNFTs: t.previewNFTs
        });
      }
    }
    genCases();

    function formatCoins(n) { return Math.floor(n).toLocaleString("ru-RU"); }

    function drawCases() {
      const cont = document.getElementById("case-container");
      cont.innerHTML = CASES.map(c => `
        <div class="case3d-wrap">
          <div class="case-card" data-tier="${c.tier}" onclick="openCase(${c.id})">
            <div class="case-top">
              <div class="case-box3d">
                <div class="case-face case-top-face"></div>
                <div class="case-face case-front-face">
                  <div class="case-lock"></div>
                  <div class="case-keyhole"></div>
                </div>
                <div class="case-face case-left-face"></div>
                <div class="case-face case-right-face"></div>
              </div>
              <div class="case-meta">
                <div class="case-title">–ö–ï–ô–°</div>
                <div class="case-name">${c.name}</div>
                <div class="case-rarity">${RARITY.find(r=>r.code===c.tier)?.label || c.tier}</div>
              </div>
            </div>
            <div class="case-price">
              <div>${formatCoins(c.price)} ü™ô</div>
              <span>${c.previewNFTs[0]?.name.split(" ")[0] || "NFT"}</span>
            </div>
            <div class="case-footer">
              <span>üîì –û—Ç–∫—Ä—ã—Ç—å</span>
              <button class="case-btn">–ö–†–£–¢–ò–¢–¨!</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function hapticImpact(style = "light") {
      if (!document.getElementById("set-vibrate").checked) return;
      try { tg?.HapticFeedback?.impactOccurred(style); } catch(e) {}
    }
    function playSound(id) {
      if (!document.getElementById("set-sound").checked) return;
      const el = document.getElementById(id);
      if (el) { el.currentTime = 0; el.play().catch(() => {}); }
    }

    let pendingDrop = null;
    function openCase(id) {
      const c = CASES.find(x => x.id === id);
      if (!c || state.bal < c.price) {
        if (state.bal < c.price) alert("üí∏ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
        hapticImpact("heavy");
        return;
      }
      state.bal -= c.price;
      state.totalCases++;
      updateBalance();
      saveState();
      hapticImpact("light");
      playSound("snd-spin");
      setTimeout(() => {
        let pool = NFTS;
        if (state.eventFireWeek) {
          pool = [...NFTS, ...NFTS.filter(n => ["RARE", "EPIC", "LEGEND"].includes(n.rarity))];
        }
        const drop = { ...pool[Math.floor(Math.random() * pool.length)], id: Date.now() };
        pendingDrop = drop;
        showDropModal(drop);
        hapticImpact("heavy");
        playSound("snd-drop");
      }, 1200);
    }

    function showDropModal(drop) {
      document.getElementById("drop-name").textContent = drop.name;
      document.getElementById("drop-desc").textContent = drop.desc;
      const pill = document.getElementById("drop-rarity-pill");
      const r = RARITY.find(x => x.code === drop.rarity);
      pill.textContent = r.label;
      pill.style.color = r.color;
      pill.style.borderColor = r.color;
      pill.style.backgroundColor = r.color + "44";
      document.getElementById("drop-modal").style.display = "flex";
    }

    function acceptDrop() {
      if (!pendingDrop) return closeDropModal();
      state.inv.push(pendingDrop);
      const dropRarityWeight = RARITY.find(r => r.code === pendingDrop.rarity)?.weight || 0;
      const bestWeight = RARITY.find(r => r.code === state.bestDropRarity)?.weight || 0;
      if (dropRarityWeight > bestWeight) {
        state.bestDropRarity = pendingDrop.rarity;
        state.bestDropName = pendingDrop.name;
      }
      pendingDrop = null;
      saveState();
      renderInventory();
      updateProfile();
      closeDropModal();
      hapticImpact("light");
    }
    function rejectDrop() { pendingDrop = null; closeDropModal(); hapticImpact("medium"); }
    function closeDropModal() { document.getElementById("drop-modal").style.display = "none"; }

    function renderInventory() {
      const grid = document.getElementById("inventory-grid");
      const empty = document.getElementById("inventory-empty");
      if (!state.inv.length) {
        grid.innerHTML = "";
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";
      grid.innerHTML = state.inv.map((nft, i) => {
        const r = RARITY.find(x => x.code === nft.rarity);
        const canUpgrade = nft.upgradeLevel < 5;
        return `
          <div class="nft-card ${canUpgrade ? 'upgradable' : ''}" onclick="${canUpgrade ? `openUpgrader(${i})` : 'inspectNFT(' + i + ')'}" data-rarity="${nft.rarity}">
            ${canUpgrade ? '<div class="upgrade-badge">‚ö° LV.' + (nft.upgradeLevel + 1) + '</div>' : ''}
            <div class="nft-inner">
              <div class="nft-bg-shape"></div>
              <div class="nft-figure">
                <div class="nft-stripe"></div><div class="nft-stripe"></div><div class="nft-stripe"></div>
              </div>
              <div class="nft-name">${nft.name}</div>
              <div class="nft-meta">${r?.label || nft.rarity} ${nft.upgradeLevel > 0 ? `(+${nft.upgradeLevel})` : ''}</div>
            </div>
          </div>`;
      }).join('');
    }

    function openUpgrader(idx) {
      currentUpgradingNFT = state.inv[idx];
      if (!currentUpgradingNFT) return;
      
      const level = currentUpgradingNFT.upgradeLevel;
      const progress = (level / 5) * 100;
      const cost = 5000 * (level + 1);
      const risk = 15 + (level * 5); // 15-40%
      
      document.getElementById("upgrade-progress").textContent = `${progress.toFixed(0)}%`;
      document.getElementById("upgrade-progress").style.setProperty('--success-deg', progress + 'deg');
      document.getElementById("upgrade-nft-preview").style.borderColor = RARITY.find(r => r.code === currentUpgradingNFT.rarity)?.color || '#f3ba2f';
      document.getElementById("upgrade-cost").textContent = `–£–ª—É—á—à–µ–Ω–∏–µ: ${formatCoins(cost)} ü™ô`;
      document.getElementById("upgrade-risk").innerHTML = `‚ö†Ô∏è –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏: <strong>${risk}%</strong>`;
      
      document.getElementById("upgrader-modal").style.display = "flex";
      hapticImpact("medium");
    }

    function closeUpgrader() {
      document.getElementById("upgrader-modal").style.display = "none";
      currentUpgradingNFT = null;
    }

    function performUpgrade() {
      if (!currentUpgradingNFT || state.bal < 5000 * (currentUpgradingNFT.upgradeLevel + 1)) {
        alert("üí∏ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!");
        return;
      }
      
      const cost = 5000 * (currentUpgradingNFT.upgradeLevel + 1);
      const risk = 15 + (currentUpgradingNFT.upgradeLevel * 5);
      
      state.bal -= cost;
      
      if (Math.random() * 100 < risk) {
        // –ü–æ—Ç–µ—Ä—è NFT
        const idx = state.inv.indexOf(currentUpgradingNFT);
        if (idx > -1) state.inv.splice(idx, 1);
        alert("üí• NFT –£–ù–ò–ß–¢–û–ñ–ï–ù! –†–∏—Å–∫ –Ω–µ –ø—Ä–æ—à—ë–ª...");
        playSound("snd-spin");
        hapticImpact("heavy");
      } else {
        // –£—Å–ø–µ—Ö
        currentUpgradingNFT.upgradeLevel++;
        if (currentUpgradingNFT.upgradeLevel >= 5) {
          currentUpgradingNFT.rarity = RARITY[Math.min(4, RARITY.findIndex(r => r.code === currentUpgradingNFT.rarity) + 1)]?.code || "MYTH";
        }
        alert("üöÄ –£–°–ü–ï–•! NFT —É–ª—É—á—à–µ–Ω!");
        playSound("snd-upgrade");
        hapticImpact("light");
      }
      
      updateBalance();
      saveState();
      renderInventory();
      updateProfile();
      closeUpgrader();
    }

    function inspectNFT(idx) {
      const nft = state.inv[idx];
      if (!nft) return;
      pendingDrop = nft;
      showDropModal(nft);
    }

    function craftItems() {
      if (state.inv.length < 3) return alert("–ù—É–∂–Ω–æ 3+ NFT –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞!");
      const first = state.inv[0];
      const better = {
        id: Date.now(),
        name: first.name + " ‚òÖ",
        rarity: RARITY[Math.min(4, RARITY.findIndex(r => r.code === first.rarity) + 1)]?.code || "MYTH",
        desc: "–ö—Ä–∞—Ñ—Ç–æ–≤—ã–π —à–µ–¥–µ–≤—Ä!",
        upgradeLevel: 0
      };
      state.inv.splice(0, 3);
      state.inv.push(better);
      pendingDrop = better;
      showDropModal(better);
      renderInventory();
      saveState();
    }

    function claimDaily() {
      const today = new Date().toDateString();
      if (state.lastDaily === today) return alert("‚úÖ –ë–æ–Ω—É—Å —É–∂–µ –∑–∞–±—Ä–∞–Ω —Å–µ–≥–æ–¥–Ω—è!");
      const reward = 3000 + (state.eventFireWeek ? 2500 : 1500) * Math.random();
      state.bal += reward;
      state.lastDaily = today;
      updateBalance();
      saveState();
      updateDailyUI();
      alert(`üéÅ +${formatCoins(reward)} ü™ô`);
      hapticImpact("light");
    }

    function updateDailyUI() {
      const pill = document.getElementById("daily-pill");
      const today = new Date().toDateString();
      if (state.lastDaily === today) {
        pill.textContent = "–ó–∞–±—Ä–∞–Ω";
        pill.style.background = "rgba(192,202,216,0.2)";
        pill.style.color = "#9ca3af";
        pill.style.borderColor = "#9ca3af";
      } else {
        pill.textContent = "–î–æ—Å—Ç—É–ø–µ–Ω";
        pill.style.background = "rgba(0,242,255,0.25)";
        pill.style.color = "#00f2ff";
        pill.style.borderColor = "#00f2ff";
      }
    }

    function updateBalance() {
      document.getElementById("balance").textContent = formatCoins(state.bal);
    }

    function updateProfile() {
      const user = tg?.initDataUnsafe?.user;
      document.getElementById("prof-name").textContent = user?.first_name || "–ò–≥—Ä–æ–∫";
      document.getElementById("prof-username").textContent = user?.username ? "@" + user.username : "@user";
      document.getElementById("prof-initial").textContent = (user?.first_name || "M")[0]?.toUpperCase() || "M";
      document.getElementById("prof-cases").textContent = state.totalCases;
      document.getElementById("prof-best").textContent = state.bestDropName || "‚Äì";
      
      // –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ –í–°–ï–ì–î–ê –í–ò–î–ò–ú–ê
      document.getElementById("admin-panel").style.display = "block";

      const rarity = state.bestDropRarity;
      const titles = ["–ù–æ–≤–∏—á–æ–∫", "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä", "–û—Ö–æ—Ç–Ω–∏–∫", "–õ–µ–≥–µ–Ω–¥–∞", "–ú–∏—Ñ"];
      document.getElementById("prof-title").textContent = titles[RARITY.findIndex(r => r.code === rarity)] || "–ù–æ–≤–∏—á–æ–∫";
    }

    function updateEventLabel() {
      document.getElementById("event-label").textContent = state.eventFireWeek ? "üî• –û–≥–Ω–µ–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è" : "üé≤ –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º";
    }

    function openTab(id, el) {
      document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      document.querySelectorAll(".nav-i").forEach(i => i.classList.remove("active"));
      el.classList.add("active");
      hapticImpact("light");
    }

    // –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò
    function adminAddBalance() {
      state.bal += 1000000;
      updateBalance();
      saveState();
      hapticImpact("heavy");
      alert("üí∞ +1M –¥–æ–±–∞–≤–ª–µ–Ω–æ!");
    }
    function adminSetRich() {
      state.bal = 10000000;
      updateBalance();
      saveState();
      hapticImpact("heavy");
      alert("üëë –í—Å–µ —Ç–µ–ø–µ—Ä—å –±–æ–≥–∞—á–∏!");
    }
    function toggleEvent() {
      state.eventFireWeek = !state.eventFireWeek;
      updateEventLabel();
      saveState();
      hapticImpact("medium");
      alert(state.eventFireWeek ? "üî• –ò–≤–µ–Ω—Ç –≤–∫–ª—é—á–µ–Ω!" : "üé≤ –ò–≤–µ–Ω—Ç –≤—ã–∫–ª—é—á–µ–Ω");
    }

    // –¢–û–ü–ê–ü –§–£–ù–ö–¶–ò–ò
    function openTopupModal() {
      document.getElementById("topup-modal").style.display = "flex";
      selectedPack = null;
      document.getElementById("topup-selected").textContent = "–ü–∞–∫–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω";
      document.querySelectorAll(".pack-row").forEach(r => r.classList.remove("selected"));
    }
    function closeTopupModal() { document.getElementById("topup-modal").style.display = "none"; }
    function selectPack(amount) {
      selectedPack = amount;
      document.getElementById("topup-selected").textContent = `–ì–æ—Ç–æ–≤–æ: ${formatCoins(amount)} ü™ô`;
      document.querySelectorAll(".pack-row").forEach(r => r.classList.remove("selected"));
      event.currentTarget.classList.add("selected");
      hapticImpact("light");
    }
    function applyTopup() {
      if (!selectedPack) return alert("–í—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç!");
      state.bal += selectedPack;
      updateBalance();
      saveState();
      closeTopupModal();
      hapticImpact("heavy");
      alert(`üíé –î–æ–¥–µ–ø: +${formatCoins(selectedPack)} ü™ô`);
    }

    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    drawCases();
    updateBalance();
    renderInventory();
    updateProfile();
    updateDailyUI();
    updateEventLabel();
  </script>
</body>
</html>
