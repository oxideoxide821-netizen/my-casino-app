<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>ELITE DEB CASINO</title>
  <style>
    :root {
      --gold: #f3ba2f;
      --bg: #050608;
      --card: #101219;
      --accent: #00f2ff;
      --red: #ff4757;
      --text-soft: #a9b3c1;
      --rare: #4dd0e1;
      --epic: #ce93d8;
      --legend: #f3ba2f;
      --myth: #ff7675;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #151827 0, #050608 55%);
      color: #fff;
      height: 100vh;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .header {
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(10px);
      background: linear-gradient(to right, rgba(10,12,20,.95), rgba(10,12,20,.8));
      border-bottom: 1px solid rgba(255,255,255,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .brand {
      font-weight: 800;
      letter-spacing: .08em;
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-soft);
    }
    .brand span { color: var(--accent); }
    .bal-box {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 11px;
    }
    .bal-main {
      font-size: 18px;
      font-weight: 900;
      color: var(--gold);
      text-shadow: 0 0 8px rgba(243,186,47,.4);
    }
    .bal-sub { color: var(--text-soft); font-size: 10px; }

    .page {
      height: calc(100vh - 80px);
      padding: 14px 14px 100px;
      overflow-y: auto;
      display: none;
    }
    .page.active { display: block; }

    /* CASES GRID */
    .case-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .case3d-wrap {
      perspective: 900px;
    }

    .case-card {
      position: relative;
      border-radius: 18px;
      padding: 10px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 18px 35px rgba(0,0,0,0.8);
      transform-style: preserve-3d;
      transform: rotateY(0deg) rotateX(0deg);
      transition: transform .23s ease, box-shadow .23s ease, border-color .23s ease;
      overflow: hidden;
      background: radial-gradient(circle at top, #1b1e2d 0, #05060c 60%);
    }
    .case-card::before {
      content:"";
      position:absolute;
      inset:-40%;
      background: conic-gradient(from 220deg,
        rgba(0,242,255,0.3),
        transparent,
        rgba(243,186,47,0.4),
        transparent);
      opacity:0;
      transition:.23s;
      mix-blend-mode:screen;
    }
    .case-card:hover {
      transform: rotateY(10deg) rotateX(-4deg) translateY(-2px);
      box-shadow: 0 24px 45px rgba(0,0,0,0.95);
      border-color: rgba(243,186,47,0.6);
    }
    .case-card:hover::before { opacity:1; }

    .case-top {
      display:flex;
      gap:8px;
      align-items:center;
    }

    /* PURE CSS 3D BOX INSIDE CARD */
    .box3d {
      width:52px;
      height:52px;
      position:relative;
      transform-style:preserve-3d;
      transform: rotateX(-18deg) rotateY(-24deg) translateZ(8px);
      transition: transform .25s ease;
    }
    .case-card:hover .box3d {
      transform: rotateX(-12deg) rotateY(-8deg) translateZ(12px);
    }
    .box-face {
      position:absolute;
      inset:0;
      border-radius:10px;
      background:linear-gradient(145deg,#22263c,#090b12);
      box-shadow:0 0 14px rgba(0,0,0,0.9);
    }
    .box-top {
      transform: rotateX(90deg) translateZ(26px);
      transform-origin: center center;
      background:linear-gradient(135deg,#2a314b,#151827);
    }
    .box-front {
      transform: translateZ(26px);
      background:linear-gradient(145deg,#252a44,#0b0d16);
    }
    .box-side {
      width:52px;
      height:52px;
      background:linear-gradient(145deg,#202542,#080914);
    }
    .box-left {
      transform: rotateY(-90deg) translateZ(26px);
    }
    .box-right {
      transform: rotateY(90deg) translateZ(26px);
    }
    .box-glow {
      position:absolute;
      inset:-30%;
      background: radial-gradient(circle at top, rgba(0,242,255,0.4), transparent 65%);
      mix-blend-mode:screen;
      opacity:0.7;
      pointer-events:none;
    }

    /* rarity colors */
    .case-card[data-tier="COMMON"] .box-top { background:linear-gradient(135deg,#2d3748,#1a202c); }
    .case-card[data-tier="COMMON"] .box-front { background:linear-gradient(145deg,#2c3e50,#111827); }

    .case-card[data-tier="RARE"] .box-top { background:linear-gradient(135deg,#2193b0,#6dd5ed); }
    .case-card[data-tier="RARE"] .box-front { background:linear-gradient(145deg,#1a2a3c,#0b1118); }

    .case-card[data-tier="EPIC"] .box-top { background:linear-gradient(135deg,#8e2de2,#4a00e0); }
    .case-card[data-tier="EPIC"] .box-front { background:linear-gradient(145deg,#261338,#0b0915); }

    .case-card[data-tier="LEGEND"] .box-top { background:linear-gradient(135deg,#f3ba2f,#ffd86f); }
    .case-card[data-tier="LEGEND"] .box-front { background:linear-gradient(145deg,#3b2f13,#120d06); }

    .case-card[data-tier="MYTH"] .box-top { background:linear-gradient(135deg,#ff512f,#dd2476); }
    .case-card[data-tier="MYTH"] .box-front { background:linear-gradient(145deg,#3b1217,#140407); }

    .case-meta { flex:1; transform: translateZ(12px); }
    .case-title {
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:#cfd6ff;
      margin-bottom:3px;
    }
    .case-name { font-size:13px; font-weight:700; }
    .case-rarity { font-size:10px; color:var(--text-soft); }

    .case-price {
      margin-top:6px;
      font-size:12px;
      font-weight:600;
      color:var(--gold);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .case-price span { font-size:10px;color:var(--text-soft); }

    .case-footer {
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:10px;
      color:var(--text-soft);
    }
    .case-btn {
      border-radius:999px;
      padding:5px 10px;
      border:none;
      background:linear-gradient(135deg,#f3ba2f,#ffdf7f);
      color:#000;
      font-size:10px;
      font-weight:800;
    }

    .stat-card {
      background: linear-gradient(135deg,#151728,#0a0c14);
      border-radius: 18px;
      padding: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 18px 35px rgba(0,0,0,0.65);
      margin-bottom: 12px;
    }

    .small { font-size:11px; color:var(--text-soft); }

    .profile-head {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:6px;
    }
    .avatar {
      width:40px;
      height:40px;
      border-radius:999px;
      background:radial-gradient(circle at top,#1f2340,#090b12);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:20px;
    }
    .profile-name { font-size:13px;font-weight:700; }
    .profile-tag { font-size:10px;color:var(--text-soft); }
    .badge {
      font-size:10px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid rgba(243,186,47,.7);
      color:var(--gold);
      background:rgba(243,186,47,.14);
    }

    .nft-grid {
      display:grid;
      grid-template-columns:repeat(2,minmax(0,1fr));
      gap:10px;
      margin-top:8px;
    }
    .nft-card {
      border-radius:16px;
      padding:8px;
      border:1px solid rgba(255,255,255,0.05);
      box-shadow:0 12px 30px rgba(0,0,0,.8);
      position:relative;
      overflow:hidden;
      background: radial-gradient(circle at top,#181a2c,#090b13);
    }
    .nft-inner {
      border-radius:12px;
      padding:10px;
      background:radial-gradient(circle at top,#20223a,#06070f);
      position:relative;
      overflow:hidden;
    }
    .nft-bg-shape {
      position:absolute;
      inset:-30%;
      background:conic-gradient(from 180deg,
        rgba(0,242,255,0.4),
        transparent,
        rgba(243,186,47,0.3),
        transparent);
      opacity:0.6;
      mix-blend-mode:screen;
    }
    .nft-figure {
      position:relative;
      width:100%;
      height:70px;
      border-radius:10px;
      background: radial-gradient(circle at 20% 20%, rgba(255,255,255,0.15), transparent 50%);
      overflow:hidden;
    }
    .nft-stripe {
      position:absolute;
      width:160%;
      height:20px;
      background:linear-gradient(90deg,rgba(255,255,255,0.6),transparent);
      transform:rotate(-20deg);
      top:10px;
      left:-40%;
    }
    .nft-stripe:nth-child(2){ top:35px; opacity:.5; }
    .nft-stripe:nth-child(3){ top:60px; opacity:.25; }

    .nft-name { font-size:12px;font-weight:600;margin-top:6px;position:relative; }
    .nft-meta { font-size:10px;color:var(--text-soft);position:relative; }

    .nft-card[data-rarity="COMMON"] .nft-inner { border:1px solid rgba(192,202,216,0.3); }
    .nft-card[data-rarity="RARE"] .nft-inner { border:1px solid rgba(77,208,225,0.7); }
    .nft-card[data-rarity="EPIC"] .nft-inner { border:1px solid rgba(206,147,216,0.7); }
    .nft-card[data-rarity="LEGEND"] .nft-inner { border:1px solid rgba(243,186,47,0.9); }
    .nft-card[data-rarity="MYTH"] .nft-inner { border:1px solid rgba(255,118,117,0.9); }

    .nav {
      position:fixed;
      left:14px;
      right:14px;
      bottom:18px;
      background:rgba(8,9,16,0.96);
      border-radius:20px;
      border:1px solid rgba(255,255,255,0.08);
      box-shadow:0 20px 45px rgba(0,0,0,0.9);
      display:flex;
      justify-content:space-around;
      padding:10px 8px;
      z-index:200;
    }
    .nav-i {
      font-size:19px;
      opacity:0.45;
      transition:.2s;
    }
    .nav-i.active {
      opacity:1;
      color:var(--gold);
      transform:translateY(-2px) scale(1.05);
    }

    .modal-back {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.8);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:300;
    }
    .modal {
      width:90%;
      max-width:360px;
      background:linear-gradient(145deg,#111321,#05060c);
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.06);
      box-shadow:0 20px 50px rgba(0,0,0,0.9);
      padding:14px;
    }
    .modal-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .modal-title {font-size:13px;font-weight:700;}
    .pill {
      font-size:10px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(0,242,255,0.15);
      color:var(--accent);
    }
    .modal-actions {
      margin-top:10px;
      display:flex;
      gap:8px;
    }
    .btn {
      flex:1;
      border-radius:999px;
      padding:9px 10px;
      border:none;
      font-size:11px;
      font-weight:700;
    }
    .btn-primary {
      background:linear-gradient(135deg,#f3ba2f,#ffe38b);
      color:#000;
    }
    .btn-ghost {
      background:transparent;
      border:1px solid rgba(255,255,255,0.18);
      color:#fff;
    }

    .pack-row {
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:8px 10px;
      border-radius:12px;
      background:#151727;
      margin-bottom:6px;
      font-size:11px;
    }
    .pack-title {font-weight:600;}
    .pack-coins {color:var(--gold);font-weight:600;}
    .pack-tag {font-size:9px;color:var(--text-soft);}

  </style>
</head>
<body>
  <div class="header">
    <div class="brand">ELITE <span>DEB</span></div>
    <div class="bal-box">
      <div class="bal-main"><span id="balance">15 000</span> ü™ô</div>
      <div class="bal-sub" id="event-label">üî• –û–≥–Ω–µ–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è</div>
    </div>
  </div>

  <!-- SHOP -->
  <div class="page active" id="p-shop">
    <div class="stat-card" style="margin-bottom:10px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-size:12px;font-weight:600;">üé∞ –ö–ï–ô–°–´</div>
        <button class="btn btn-ghost" style="flex:0 0 auto;font-size:10px;padding:5px 9px;border-radius:999px;" onclick="openTopupModal()">‚≠ê –î–û–î–ï–ü</button>
      </div>
      <div class="small">–ü—Å–µ–≤–¥–æ‚Äë3D –∫–µ–π—Å—ã –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–æ–∫, –≤—Å—ë –Ω–∞ CSS. –ë–∞–ª–∞–Ω—Å —á–∏—Å—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π.</div>
    </div>
    <div class="case-grid" id="case-container"></div>
  </div>

  <!-- INVENTORY -->
  <div class="page" id="p-inv">
    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
        <div style="font-size:12px;font-weight:600;">üéí –ú–û–ô –ò–ù–í–ï–ù–¢–ê–†–¨</div>
        <button class="btn" style="flex:0 0 auto;font-size:10px;padding:5px 9px;border-radius:999px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:#fff;" onclick="craftItems()">‚öóÔ∏è –ö–†–ê–§–¢ 3‚Üí1</button>
      </div>
      <div class="small">NFT‚Äë–∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–∂–µ –±–µ–∑ PNG: —á–∏—Å—Ç—ã–π CSS, –Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑ –∏–≥—Ä—ã.</div>
    </div>
    <div id="inventory-empty" class="small" style="margin-top:10px;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ç–∫—Ä–æ–π –ø–∞—Ä—É –∫–µ–π—Å–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–µ.</div>
    <div class="nft-grid" id="inventory-grid"></div>
  </div>

  <!-- PROFILE -->
  <div class="page" id="p-prof">
    <div class="stat-card">
      <div class="profile-head">
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="avatar"><span id="prof-initial">M</span></div>
          <div>
            <div class="profile-name" id="prof-name">–ò–≥—Ä–æ–∫</div>
            <div class="profile-tag" id="prof-username">@user</div>
          </div>
        </div>
        <div><div class="badge" id="prof-title">–ù–æ–≤–∏—á–æ–∫</div></div>
      </div>
      <div class="small">
        –í—Å–µ–≥–æ –∫–µ–π—Å–æ–≤: <span id="prof-cases">0</span> ‚Ä¢ –õ—É—á—à–∏–π –¥—Ä–æ–ø: <span id="prof-best">‚Äì</span>
      </div>
    </div>

    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
        <div style="font-size:12px;font-weight:600;">üìÜ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°</div>
        <span class="pill" id="daily-pill">–î–æ—Å—Ç—É–ø–µ–Ω</span>
      </div>
      <div class="small">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å –∏ –±—É—Å—Ç —à–∞–Ω—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è –∏–≤–µ–Ω—Ç–∞.</div>
      <button class="btn btn-primary" style="margin-top:8px;" onclick="claimDaily()">–ó–ê–ë–†–ê–¢–¨ –ë–û–ù–£–°</button>
    </div>

    <div class="stat-card" id="admin-panel" style="display:none;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
        <div style="font-size:12px;font-weight:600;">üëë –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</div>
        <span class="pill">MAX MODE</span>
      </div>
      <div class="modal-actions" style="margin-top:4px;">
        <button class="btn btn-ghost" onclick="adminAddBalance()">+100K –°–ï–ë–ï</button>
        <button class="btn btn-ghost" onclick="toggleEvent()">üî• –ò–í–ï–ù–¢</button>
      </div>
      <button class="btn btn-ghost" style="margin-top:6px;" onclick="adminSetRich()">–°–î–ï–õ–ê–¢–¨ –í–°–ï–• –ë–û–ì–ê–¢–´–ú–ò (–ª–æ–∫–∞–ª—å–Ω–æ)</button>
      <div class="small" style="margin-top:6px;opacity:.7;">–í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="page" id="p-set">
    <div class="stat-card">
      <div style="font-size:12px;font-weight:600;margin-bottom:4px;">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span class="small">–í–∏–±—Ä–∞—Ü–∏—è (Haptic Feedback)</span>
        <input type="checkbox" id="set-vibrate" checked>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <span class="small">–ó–≤—É–∫–∏</span>
        <input type="checkbox" id="set-sound" checked>
      </div>
      <button class="btn btn-ghost" style="margin-top:12px;" onclick="tg?.close()">–í–´–ô–¢–ò –ò–ó –ú–ò–ù–ò‚Äë–ê–ü–ü</button>
    </div>
  </div>

  <!-- NFT DROP MODAL -->
  <div class="modal-back" id="drop-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">–ù–æ–≤—ã–π NFT‚Äë–¥—Ä–æ–ø</div>
        <span class="pill" id="drop-rarity-pill">RARE</span>
      </div>
      <div class="nft-inner" style="margin-bottom:8px;">
        <div class="nft-bg-shape"></div>
        <div class="nft-figure">
          <div class="nft-stripe"></div>
          <div class="nft-stripe"></div>
          <div class="nft-stripe"></div>
        </div>
      </div>
      <div style="font-size:13px;font-weight:600;" id="drop-name">Virus Core #001</div>
      <div class="small" id="drop-desc">–†–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –≤–∏—Ä—É—Å–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.</div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="rejectDrop()">–û–¢–ö–ê–ó–ê–¢–¨–°–Ø</button>
        <button class="btn btn-primary" onclick="acceptDrop()">–í–ó–Ø–¢–¨ –í –ò–ù–í–ï–ù–¢–ê–†–¨</button>
      </div>
    </div>
  </div>

  <!-- TOPUP MODAL -->
  <div class="modal-back" id="topup-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">–ö–∞—Å—Å–∞ ELITE DEB</div>
        <span class="pill">NFT BATTLE STYLE</span>
      </div>
      <div class="small" style="margin-bottom:8px;">–í—ã–±–µ—Ä–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –º–æ–Ω–µ—Ç. –ú—ã –ø—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏–º —Ç–≤–æ–π –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å.</div>
      <div class="pack-row" onclick="selectPack(10000)">
        <div>
          <div class="pack-title">Starter</div>
          <div class="pack-tag">–†–∞–∑–æ–≥—Ä–µ—Ç—å—Å—è</div>
        </div>
        <div class="pack-coins">10 000 ü™ô</div>
      </div>
      <div class="pack-row" onclick="selectPack(50000)">
        <div>
          <div class="pack-title">Grinder</div>
          <div class="pack-tag">–ñ–∏—Ç—å –≤ –∫–µ–π—Å–∞—Ö</div>
        </div>
        <div class="pack-coins">50 000 ü™ô</div>
      </div>
      <div class="pack-row" onclick="selectPack(250000)">
        <div>
          <div class="pack-title">Whale</div>
          <div class="pack-tag">‚ÄúNFT‚Äë–±–æ—Å—Å‚Äù —É—Ä–æ–≤–µ–Ω—å</div>
        </div>
        <div class="pack-coins">250 000 ü™ô</div>
      </div>
      <div class="small" id="topup-selected" style="margin-top:6px;">–ü–∞–∫–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω.</div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeTopupModal()">–ó–ê–ö–†–´–¢–¨</button>
        <button class="btn btn-primary" onclick="applyTopup()">–î–û–ë–ê–í–ò–¢–¨ –ö –ë–ê–õ–ê–ù–°–£</button>
      </div>
    </div>
  </div>

  <div class="nav">
    <div class="nav-i active" onclick="openTab('p-shop', this)">üì¶</div>
    <div class="nav-i" onclick="openTab('p-inv', this)">üéí</div>
    <div class="nav-i" onclick="openTab('p-prof', this)">üë§</div>
    <div class="nav-i" onclick="openTab('p-set', this)">‚öôÔ∏è</div>
  </div>

  <audio id="snd-spin" src="https://cdn.freesound.org/previews/341/341695_6261196-lq.mp3"></audio>
  <audio id="snd-drop" src="https://cdn.freesound.org/previews/235/235909_3982175-lq.mp3"></audio>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.expand();

    const ADMIN_USERNAME = "Random06"; // –ø–æ–º–µ–Ω—è–π –Ω–∞ —Å–≤–æ–π username
    const STORAGE_KEY = "elite_deb_state_css3d";

    let state = {
      bal: 15000,
      inv: [],
      totalCases: 0,
      bestDropName: null,
      bestDropRarity: null,
      lastDaily: null,
      eventFireWeek: true
    };

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        state = Object.assign(state, JSON.parse(raw));
      } catch(e){}
    }
    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch(e){}
    }
    loadState();

    const RARITY = [
      {code: "COMMON", label: "COMMON", color:"#c0cad8"},
      {code: "RARE", label:"RARE", color:"#4dd0e1"},
      {code: "EPIC", label:"EPIC", color:"#ce93d8"},
      {code: "LEGEND", label:"LEGENDARY", color:"#f3ba2f"},
      {code: "MYTH", label:"MYTHICAL", color:"#ff7675"}
    ];

    const NFTS = [
      { id:1, name:"Virus Core #001", rarity:"RARE", desc:"–°–µ—Ä–¥—Ü–µ —Å—Ç–∞—Ä–æ–≥–æ –≤–∏—Ä—É—Å–Ω–æ–≥–æ —è–¥—Ä–∞, –¥–∞—ë—Ç –ª—ë–≥–∫–∏–π –±—É—Å—Ç —É–¥–∞—á–∏."},
      { id:2, name:"Toxic Blade #07", rarity:"EPIC", desc:"–õ–µ–∑–≤–∏–µ, –ø—Ä–æ–ø–∏—Ç–∞–Ω–Ω–æ–µ —Ç–æ–∫—Å–∏–Ω–æ–º. –†–µ–∂–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–∞–º."},
      { id:3, name:"Crown of Glitch", rarity:"LEGEND", desc:"–ö–æ—Ä–æ–Ω–∞ —Å–±–æ—è. –ö–æ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç ‚Äî –∫–∞–∑–∏–Ω–æ –∫–∞—à–ª—è–µ—Ç."},
      { id:4, name:"Neon Chip", rarity:"COMMON", desc:"–û–±—ã—á–Ω—ã–π —á–∏–ø, –Ω–æ —Å–∏–ª—å–Ω–æ —Å–≤–µ—Ç–∏—Ç—Å—è, –∫–æ–≥–¥–∞ –±–∞–ª–∞–Ω—Å –∂–∏–≤."}
    ];

    let CASES = [];
    const CASE_TEMPLATES = [
      { tier:"COMMON",  basePrice: 1500 },
      { tier:"RARE",    basePrice: 7500 },
      { tier:"EPIC",    basePrice: 25000 },
      { tier:"LEGEND",  basePrice: 120000 },
      { tier:"MYTH",    basePrice: 400000 }
    ];

    function genCases() {
      CASES = [];
      let id = 1;
      // 100 —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–µ–π—Å–æ–≤
      for (let t of CASE_TEMPLATES) {
        for (let i=0;i<20;i++) {
          if (id>100) break;
          CASES.push({
            id,
            name:`–ö–µ–π—Å #${id}`,
            tier:t.tier,
            price: t.basePrice * (1+i*0.25),
            previewNFTs: NFTS.slice(0,3)
          });
          id++;
        }
      }
      // –µ—â—ë –¥–æ 220 –∫–µ–π—Å–æ–≤ —Ä–∞–Ω–¥–æ–º–æ–º
      for (;id<=220;id++) {
        const t = CASE_TEMPLATES[Math.floor(Math.random()*CASE_TEMPLATES.length)];
        CASES.push({
          id,
          name:`–ö–µ–π—Å #${id}`,
          tier:t.tier,
          price: t.basePrice * (1+Math.random()*6),
          previewNFTs: NFTS.sort(()=>0.5-Math.random()).slice(0,3)
        });
      }
    }
    genCases();

    function formatCoins(n) {
      return Math.floor(n).toLocaleString("ru-RU");
    }

    function drawCases() {
      const cont = document.getElementById("case-container");
      cont.innerHTML = "";
      CASES.forEach(c => {
        cont.innerHTML += `
        <div class="case3d-wrap">
          <div class="case-card" data-tier="${c.tier}" onclick="openCase(${c.id})">
            <div class="case-top">
              <div class="box3d">
                <div class="box-face box-top"></div>
                <div class="box-face box-front"></div>
                <div class="box-face box-left box-side"></div>
                <div class="box-face box-right box-side"></div>
                <div class="box-glow"></div>
              </div>
              <div class="case-meta">
                <div class="case-title">–ö–ï–ô–°</div>
                <div class="case-name">${c.name}</div>
                <div class="case-rarity">${c.tier}</div>
              </div>
            </div>
            <div class="case-price">
              <div>${formatCoins(c.price)} ü™ô</div>
              <span>–õ—É—Ç: ${c.previewNFTs.map(x=>x.name.split(" ")[0]).join(", ")}</span>
            </div>
            <div class="case-footer">
              <span>–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å</span>
              <button class="case-btn">–ö–†–£–¢–ò–¢–¨</button>
            </div>
          </div>
        </div>`;
      });
    }

    function hapticImpact(style="light") {
      if (!document.getElementById("set-vibrate").checked) return;
      try { tg?.HapticFeedback?.impactOccurred(style); } catch(e){}
    }
    function playSound(id) {
      if (!document.getElementById("set-sound").checked) return;
      const el = document.getElementById(id);
      if (!el) return;
      el.currentTime = 0;
      el.play().catch(()=>{});
    }

    let pendingDrop = null;

    function openCase(id) {
      const c = CASES.find(x=>x.id===id);
      if (!c) return;
      if (state.bal < c.price) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –¥–ª—è —ç—Ç–æ–≥–æ –∫–µ–π—Å–∞.");
        hapticImpact("medium");
        return;
      }
      state.bal -= c.price;
      state.totalCases++;
      updateBalance();
      saveState();

      hapticImpact("light");
      playSound("snd-spin");

      setTimeout(()=>{
        const basePool = NFTS;
        let pool = basePool;
        if (state.eventFireWeek) {
          pool = [];
          basePool.forEach(n=>{
            pool.push(n);
            if (["RARE","EPIC","LEGEND"].includes(n.rarity)) pool.push(n);
          });
        }
        const drop = pool[Math.floor(Math.random()*pool.length)];
        pendingDrop = drop;
        showDropModal(drop);
        hapticImpact("medium");
        playSound("snd-drop");
      }, 1000);
    }

    function showDropModal(drop) {
      const m = document.getElementById("drop-modal");
      document.getElementById("drop-name").textContent = drop.name;
      document.getElementById("drop-desc").textContent = drop.desc;
      const pill = document.getElementById("drop-rarity-pill");
      pill.textContent = drop.rarity;
      const r = RARITY.find(x=>x.code===drop.rarity);
      pill.style.color = r ? r.color : "#fff";
      pill.style.borderColor = r ? r.color : "rgba(255,255,255,0.6)";
      pill.style.backgroundColor = r ? r.color+"33" : "rgba(255,255,255,0.1)";
      m.style.display = "flex";
    }

    function acceptDrop() {
      if (!pendingDrop) return closeDropModal();
      state.inv.push(pendingDrop);
      if (!state.bestDropRarity || rarityWeight(pendingDrop.rarity) > rarityWeight(state.bestDropRarity)) {
        state.bestDropRarity = pendingDrop.rarity;
        state.bestDropName = pendingDrop.name;
      }
      pendingDrop = null;
      saveState();
      renderInventory();
      updateProfile();
      closeDropModal();
      hapticImpact("light");
    }

    function rejectDrop() {
      pendingDrop = null;
      closeDropModal();
      hapticImpact("medium");
    }

    function closeDropModal() {
      document.getElementById("drop-modal").style.display = "none";
    }

    function rarityWeight(code) {
      switch(code) {
        case "COMMON": return 1;
        case "RARE": return 2;
        case "EPIC": return 3;
        case "LEGEND": return 4;
        case "MYTH": return 5;
        default: return 0;
      }
    }

    function renderInventory() {
      const grid = document.getElementById("inventory-grid");
      const empty = document.getElementById("inventory-empty");
      if (!state.inv.length) {
        grid.innerHTML = "";
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";
      grid.innerHTML = "";
      state.inv.forEach((nft,i)=>{
        grid.innerHTML += `
        <div class="nft-card" data-rarity="${nft.rarity}" onclick="inspectNFT(${i})">
          <div class="nft-inner">
            <div class="nft-bg-shape"></div>
            <div class="nft-figure">
              <div class="nft-stripe"></div>
              <div class="nft-stripe"></div>
              <div class="nft-stripe"></div>
            </div>
            <div class="nft-name">${nft.name}</div>
            <div class="nft-meta">${nft.rarity}</div>
          </div>
        </div>`;
      });
    }

    function inspectNFT(idx) {
      const nft = state.inv[idx];
      if (!nft) return;
      pendingDrop = nft;
      showDropModal(nft);
    }

    function craftItems() {
      if (state.inv.length < 3) {
        alert("–ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã 3 NFT –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞.");
        return;
      }
      const first = state.inv[0];
      const better = {
        id:Date.now(),
        name:first.name + " +",
        rarity:"EPIC",
        desc:"–£—Å–∏–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —á–µ—Ä–µ–∑ –∫—Ä–∞—Ñ—Ç."
      };
      state.inv.splice(0,3);
      state.inv.push(better);
      pendingDrop = better;
      showDropModal(better);
      renderInventory();
      saveState();
    }

    function claimDaily() {
      const today = new Date().toDateString();
      if (state.lastDaily === today) {
        alert("–ë–æ–Ω—É—Å —É–∂–µ –∑–∞–±—Ä–∞–Ω —Å–µ–≥–æ–¥–Ω—è.");
        return;
      }
      const base = 3000;
      const bonus = state.eventFireWeek ? 2500 : 1500;
      const reward = base + Math.floor(Math.random()*bonus);
      state.lastDaily = today;
      state.bal += reward;
      updateBalance();
      saveState();
      updateDailyUI();
      alert("–¢—ã –∑–∞–±—Ä–∞–ª " + reward.toLocaleString("ru-RU") + " ü™ô");
      hapticImpact("light");
    }

    function updateDailyUI() {
      const pill = document.getElementById("daily-pill");
      const today = new Date().toDateString();
      if (state.lastDaily === today) {
        pill.textContent = "–ó–∞–±—Ä–∞–Ω";
        pill.style.background = "rgba(255,255,255,0.1)";
        pill.style.color = "#c0cad8";
      } else {
        pill.textContent = "–î–æ—Å—Ç—É–ø–µ–Ω";
        pill.style.background = "rgba(0,242,255,0.15)";
        pill.style.color = "#00f2ff";
      }
    }

    function updateBalance() {
      document.getElementById("balance").textContent = formatCoins(state.bal);
    }

    function updateProfile() {
      const user = tg?.initDataUnsafe?.user;
      document.getElementById("prof-name").textContent = user?.first_name || "–ò–≥—Ä–æ–∫";
      const uname = user?.username ? "@"+user.username : "@unknown";
      document.getElementById("prof-username").textContent = uname;
      document.getElementById("prof-initial").textContent = (user?.first_name || "M")[0].toUpperCase();
      document.getElementById("prof-cases").textContent = state.totalCases;
      document.getElementById("prof-best").textContent = state.bestDropName || "‚Äì";

      const isAdmin = user?.username === ADMIN_USERNAME;
      document.getElementById("admin-panel").style.display = isAdmin ? "block" : "none";

      const rarity = state.bestDropRarity;
      let title = "–ù–æ–≤–∏—á–æ–∫";
      if (rarity === "RARE") title = "–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä";
      if (rarity === "EPIC") title = "–û—Ö–æ—Ç–Ω–∏–∫ –∑–∞ –¥—Ä–æ–ø–æ–º";
      if (rarity === "LEGEND") title = "–õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Å–∏–∫–∞";
      if (rarity === "MYTH") title = "–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π –±–æ—Å—Å";
      document.getElementById("prof-title").textContent = title;
    }

    function updateEventLabel() {
      document.getElementById("event-label").textContent = state.eventFireWeek ? "üî• –û–≥–Ω–µ–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è" : "üé≤ –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º";
    }

    function openTab(id, el) {
      document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      document.querySelectorAll(".nav-i").forEach(i=>i.classList.remove("active"));
      el.classList.add("active");
      hapticImpact("light");
    }

    function adminAddBalance() {
      state.bal += 100000;
      updateBalance();
      saveState();
      hapticImpact("medium");
    }
    function adminSetRich() {
      state.bal = 10_000_000;
      updateBalance();
      saveState();
      hapticImpact("medium");
    }
    function toggleEvent() {
      state.eventFireWeek = !state.eventFireWeek;
      updateEventLabel();
      saveState();
      hapticImpact("medium");
    }

    let selectedPack = null;
    function openTopupModal() {
      document.getElementById("topup-modal").style.display = "flex";
      selectedPack = null;
      document.getElementById("topup-selected").textContent = "–ü–∞–∫–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω.";
    }
    function closeTopupModal() {
      document.getElementById("topup-modal").style.display = "none";
    }
    function selectPack(amount) {
      selectedPack = amount;
      document.getElementById("topup-selected").textContent = "–í—ã–±—Ä–∞–Ω –ø–∞–∫–µ—Ç: " + amount.toLocaleString("ru-RU") + " ü™ô";
      hapticImpact("light");
    }
    function applyTopup() {
      if (!selectedPack) {
        alert("–í—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç –¥–ª—è –¥–æ–¥–µ–ø–∞.");
        return;
      }
      state.bal += selectedPack;
      updateBalance();
      saveState();
      closeTopupModal();
      hapticImpact("medium");
      alert("–î–æ–¥–µ–ø –∑–∞–ª–µ—Ç–µ–ª: +" + selectedPack.toLocaleString("ru-RU") + " ü™ô (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ).");
    }

    drawCases();
    updateBalance();
    renderInventory();
    updateProfile();
    updateDailyUI();
    updateEventLabel();

  </script>
</body>
        </html>
