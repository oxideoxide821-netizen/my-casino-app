<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON CODER PRO | VISION</title>
    
    <script src="https://telegram.org"></script>
    <link href="https://cdnjs.cloudflare.com" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com"></script>
    <script src="https://cdnjs.cloudflare.com"></script>

    <style>
        :root { --neon: #00ff88; --bg: #020502; --glass: rgba(0, 255, 136, 0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: #e0f2e9; font-family: sans-serif; overflow: hidden; }
        #canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .app { display: flex; flex-direction: column; width: 100vw; height: 100vh; }
        
        .header { padding: 15px; background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--neon); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 0 15px var(--neon); z-index: 10; }
        .header b { color: var(--neon); letter-spacing: 1px; font-size: 16px; }
        .energy { background: var(--neon); color: #000; padding: 4px 10px; border-radius: 20px; font-weight: 900; font-size: 11px; }

        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 15px; font-size: 14px; line-height: 1.5; animation: fadeIn 0.3s; position: relative; }
        .user { background: var(--neon); color: #000; align-self: flex-end; font-weight: bold; border-bottom-right-radius: 2px; }
        .ai { background: rgba(255,255,255,0.05); border: 1px solid var(--glass); align-self: flex-start; border-bottom-left-radius: 2px; }
        .preview-img { max-width: 100%; border-radius: 10px; margin-top: 5px; border: 1px solid var(--neon); }

        .footer { padding: 10px 15px 30px; background: #000; display: flex; gap: 8px; align-items: center; border-top: 1px solid #222; }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .tool-btn { background: transparent; border: 1px solid var(--neon); border-radius: 12px; width: 42px; height: 42px; color: var(--neon); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .tool-btn:active { background: var(--neon); color: #000; }
        
        textarea { flex: 1; background: #111; border: 1px solid #333; border-radius: 12px; color: #fff; padding: 12px; height: 42px; outline: none; resize: none; font-size: 14px; border-color: var(--neon); }
        
        .send-btn { background: var(--neon); border: none; border-radius: 12px; width: 48px; height: 42px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 10px var(--neon); }
        .send-btn svg { width: 22px; height: 22px; stroke: #000; fill: none; stroke-width: 2.5; }

        pre { background: #000 !important; border-radius: 10px; padding: 10px; overflow-x: auto; border: 1px solid #333; position: relative; }
        .copy-btn { position: absolute; right: 5px; top: 5px; background: var(--neon); border: none; padding: 4px 8px; font-size: 10px; font-weight: bold; border-radius: 4px; color: #000; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div class="app">
    <div class="header">
        <b>‚ö°Ô∏è NEON VISION PRO</b>
        <div class="energy" id="energy">ROOT ACCESS</div>
    </div>
    <div id="chat">
        <div class="msg ai">–°–∏—Å—Ç–µ–º–∞ VISION –æ–Ω–ª–∞–π–Ω. üëÅÔ∏è <br>–Ø –≤–∏–∂—É –≤—Å—ë: –∫–æ–¥, –ø—Ä–∏–º–µ—Ä—ã, —Å—Ö–µ–º—ã. –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É!</div>
    </div>
    <div class="footer">
        <!-- –ö–Ω–æ–ø–∫–∞ —Ñ–æ—Ç–æ -->
        <label class="tool-btn">
            <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
            <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleImage(this)">
        </label>
        <button class="tool-btn" onclick="showRef()">üîó</button>
        <textarea id="userInput" placeholder="–¢–µ–∫—Å—Ç –∏–ª–∏ —Ñ–æ—Ç–æ..."></textarea>
        <button class="send-btn" onclick="handleSend()">
            <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        </button>
    </div>
</div>

<script>
    const ADMIN_ID = 8371345434;
    let energy = localStorage.getItem('energy') ? parseInt(localStorage.getItem('energy')) : 3;
    let currentImageData = null;
    const tg = window.Telegram.WebApp;
    tg.expand();

    if (tg.initDataUnsafe?.user?.id === ADMIN_ID) { energy = 9999; document.getElementById('energy').innerText = "OWNER"; }
    else { updateUI(); }

    function updateUI() { document.getElementById('energy').innerText = energy > 1000 ? "OWNER" : `–õ–ò–ú–ò–¢: ${energy}`; localStorage.setItem('energy', energy); }

    // –ê–ù–ò–ú–ê–¶–ò–Ø –ü–´–õ–ò
    const c = document.getElementById('canvas'), x = c.getContext('2d');
    let ps = [];
    function rs() { c.width = innerWidth; c.height = innerHeight; }
    window.onresize = rs; rs();
    class Dust { constructor() { this.init(); } init() { this.x = Math.random() * c.width; this.y = Math.random() * -c.height; this.size = Math.random() * 1.5; this.speed = Math.random() * 1.5 + 0.5; this.opacity = Math.random() * 0.6; } update() { this.y += this.speed; if (this.y > c.height) this.init(); } draw() { x.fillStyle = `rgba(0, 255, 136, ${this.opacity})`; x.beginPath(); x.arc(this.x, this.y, this.size, 0, 7); x.fill(); } }
    for(let i=0; i<60; i++) ps.push(new Dust());
    function loop() { x.clearRect(0,0,c.width,c.height); ps.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(loop); }
    loop();

    // –û–ë–†–ê–ë–û–¢–ö–ê –§–û–¢–û
    function handleImage(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            currentImageData = e.target.result;
            const chat = document.getElementById('chat');
            chat.innerHTML += `<div class="msg user">üì∑ –§–æ—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–æ<br><img src="${currentImageData}" class="preview-img"></div>`;
            chat.scrollTop = chat.scrollHeight;
        };
        reader.readAsDataURL(file);
    }

    function showRef() {
        const refLink = `https://t.me{tg.initDataUnsafe?.user?.id || '8371345434'}`;
        document.getElementById('chat').innerHTML += `<div class="msg ai" style="border:1px dashed var(--neon)"><b>–†–ï–§–ï–†–ê–õ–ö–ê:</b><br><code style="font-size:10px">${refLink}</code></div>`;
    }

    // –û–¢–ü–†–ê–í–ö–ê –° –§–û–¢–û –ò –¢–ï–ö–°–¢–û–ú
    async function handleSend() {
        const input = document.getElementById('userInput');
        const box = document.getElementById('chat');
        const text = input.value.trim();
        
        if (!text && !currentImageData) return;
        if (energy <= 0) { alert("–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω!"); return; }

        if (text) box.innerHTML += `<div class="msg user">${text}</div>`;
        input.value = "";
        if (tg.initDataUnsafe?.user?.id !== ADMIN_ID) energy--;
        updateUI();

        const load = document.createElement('div');
        load.className = "msg ai"; load.innerText = "üëÅÔ∏è –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —á–µ—Ä–µ–∑ VISION...";
        box.appendChild(load);
        box.scrollTop = box.scrollHeight;

        try {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å (P.S. Pollinations –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —á–µ—Ä–µ–∑ openai)
            const payload = {
                messages: : text}
                ],
                model: "openai"
            };

            const response = await fetch("https://text.pollinations.ai", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const resText = await response.text();
            load.remove();
            currentImageData = null; // –û—á–∏—â–∞–µ–º —Ñ–æ—Ç–æ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

            const formatted = resText.replace(/```(\w+)?([\s\S]*?)```/g, (m, l, code) => {
                return `<pre><button class="copy-btn" onclick="copy(this)">COPY</button><code class="language-${l || 'python'}">${code.trim()}</code></pre>`;
            });

            box.innerHTML += `<div class="msg ai">${formatted}</div>`;
            if (window.Prism) Prism.highlightAll();
            box.scrollTop = box.scrollHeight;

        } catch (e) { load.innerText = "‚ùå –û—à–∏–±–∫–∞ Vision-–º–æ–¥—É–ª—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑."; }
    }

    function copy(btn) {
        const code = btn.nextElementSibling.innerText;
        navigator.clipboard.writeText(code).then(() => { btn.innerText = "OK!"; setTimeout(()=>btn.innerText="COPY",2000); });
    }
</script>
</body>
</html>
