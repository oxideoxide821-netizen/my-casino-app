<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>ELITE DEB CASINO ‚Ä¢ NFT BATTLE</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    :root {
      --bg-dark: #0a0b0e;
      --bg-card: #14151c;
      --gold: #f0b90b;
      --gold-light: #fcd535;
      --silver: #a0a0a0;
      --bronze: #cd7f32;
      --common: #9ca3af;
      --rare: #4ade80;
      --epic: #a78bfa;
      --legend: #fbbf24;
      --myth: #f87171;
      --text: #ffffff;
      --text-secondary: #9ca3af;
    }

    body {
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 30% 30%, rgba(240, 185, 11, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 70% 80%, rgba(100, 100, 255, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    /* –•–µ–¥–µ—Ä */
    .header {
      background: rgba(20, 21, 28, 0.95);
      backdrop-filter: blur(10px);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      font-size: 20px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--gold), var(--gold-light));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
    }

    .balance {
      background: linear-gradient(135deg, #2a2b35, #1e1f28);
      padding: 8px 16px;
      border-radius: 30px;
      border: 1px solid var(--gold);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .balance span {
      color: var(--gold);
      font-size: 18px;
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(20, 21, 28, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-around;
      padding: 12px 16px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 100;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: var(--text-secondary);
      font-size: 12px;
      transition: 0.3s;
      cursor: pointer;
    }

    .nav-item.active {
      color: var(--gold);
      transform: translateY(-5px);
    }

    .nav-item i {
      font-size: 24px;
    }

    /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
    .page {
      height: calc(100vh - 140px);
      overflow-y: auto;
      padding: 20px;
      display: none;
      scrollbar-width: none;
    }

    .page::-webkit-scrollbar {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* –ö–µ–π—Å—ã –ø–æ —Ä–µ–¥–∫–æ—Å—Ç—è–º */
    .rarity-tabs {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 4px 0 12px;
      scrollbar-width: none;
    }

    .rarity-tab {
      padding: 8px 16px;
      border-radius: 30px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid transparent;
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      transition: 0.3s;
      cursor: pointer;
    }

    .rarity-tab.active {
      background: rgba(240, 185, 11, 0.15);
      border-color: var(--gold);
      color: var(--gold);
    }

    .cases-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–µ–π—Å–∞ */
    .case-card {
      background: linear-gradient(145deg, var(--bg-card), #1a1b24);
      border-radius: 20px;
      padding: 16px;
      border: 2px solid transparent;
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .case-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(transparent, var(--card-color), transparent 30%);
      animation: rotate 4s linear infinite;
      opacity: 0;
      transition: 0.3s;
    }

    .case-card:hover::before {
      opacity: 0.3;
    }

    .case-card[data-rarity="COMMON"] { --card-color: var(--common); }
    .case-card[data-rarity="RARE"] { --card-color: var(--rare); }
    .case-card[data-rarity="EPIC"] { --card-color: var(--epic); }
    .case-card[data-rarity="LEGEND"] { --card-color: var(--legend); }
    .case-card[data-rarity="MYTH"] { --card-color: var(--myth); }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .case-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      border: 2px solid var(--card-color);
      box-shadow: 0 0 20px var(--card-color);
    }

    .case-name {
      font-weight: 700;
      margin-bottom: 4px;
    }

    .case-price {
      color: var(--gold);
      font-weight: 700;
      font-size: 18px;
    }

    /* NFT –∫–∞—Ä—Ç–æ—á–∫–∞ */
    .nft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 12px;
    }

    .nft-card {
      background: linear-gradient(145deg, var(--bg-card), #1a1b24);
      border-radius: 16px;
      padding: 12px;
      border: 2px solid transparent;
      transition: 0.3s;
      cursor: pointer;
      position: relative;
    }

    .nft-card[data-rarity="COMMON"] { border-color: var(--common); }
    .nft-card[data-rarity="RARE"] { border-color: var(--rare); }
    .nft-card[data-rarity="EPIC"] { border-color: var(--epic); }
    .nft-card[data-rarity="LEGEND"] { border-color: var(--legend); }
    .nft-card[data-rarity="MYTH"] { border-color: var(--myth); }

    .nft-icon {
      width: 100%;
      aspect-ratio: 1;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }

    .nft-name {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .nft-level {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .upgrade-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--gold);
      color: #000;
      padding: 4px 8px;
      border-radius: 20px;
      font-size: 10px;
      font-weight: 700;
    }

    /* –ú–æ–¥–∞–ª–∫–∏ */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--bg-card);
      border-radius: 24px;
      padding: 24px;
      max-width: 90%;
      width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* –£–ª—É—á—à–∞—Ç–µ–ª—å */
    .upgrader-circle {
      width: 180px;
      height: 180px;
      margin: 20px auto;
      position: relative;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring__circle {
      transition: stroke-dashoffset 0.3s;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }

    .upgrade-percent {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      font-weight: 800;
      color: var(--gold);
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    .btn {
      padding: 12px 24px;
      border-radius: 30px;
      border: none;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
      background: linear-gradient(135deg, var(--gold), var(--gold-light));
      color: #000;
      width: 100%;
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--gold);
      color: var(--gold);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è */
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(720deg); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .opening-animation {
      animation: spin 1s ease-in-out, pulse 0.5s ease-in-out 3;
    }

    /* –¢–æ–ø –ª–∏–¥–µ—Ä–æ–≤ */
    .leader-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      margin-bottom: 8px;
    }

    .leader-rank {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: var(--gold);
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
    }

    .leader-rank.gold { background: var(--gold); }
    .leader-rank.silver { background: var(--silver); }
    .leader-rank.bronze { background: var(--bronze); }

    /* –û–±–º–µ–Ω */
    .trade-input {
      width: 100%;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      margin: 12px 0;
    }

    .nft-select {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin: 12px 0;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">‚ö° ELITE DEB</div>
    <div class="balance">
      <span>ü™ô</span>
      <span id="balance">15000</span>
    </div>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="page active" id="shop">
    <div class="rarity-tabs">
      <div class="rarity-tab active" data-rarity="ALL">–í—Å–µ</div>
      <div class="rarity-tab" data-rarity="COMMON">–û–±—ã—á–Ω—ã–µ</div>
      <div class="rarity-tab" data-rarity="RARE">–†–µ–¥–∫–∏–µ</div>
      <div class="rarity-tab" data-rarity="EPIC">–≠–ø–∏—á–µ—Å–∫–∏–µ</div>
      <div class="rarity-tab" data-rarity="LEGEND">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ</div>
      <div class="rarity-tab" data-rarity="MYTH">–ú–∏—Ñ–∏—á–µ—Å–∫–∏–µ</div>
    </div>
    <div class="cases-grid" id="casesGrid"></div>
  </div>

  <div class="page" id="inventory">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
      <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
      <button class="btn" style="width: auto; padding: 8px 16px;" onclick="craftItems()">üî® –ö—Ä–∞—Ñ—Ç 3‚Üí1</button>
    </div>
    <div class="nft-grid" id="inventoryGrid"></div>
  </div>

  <div class="page" id="profile">
    <div style="background: var(--bg-card); border-radius: 20px; padding: 20px; margin-bottom: 16px;">
      <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
        <div style="width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, var(--gold), var(--gold-light)); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 800; color: #000;">
          <span id="profileInitial">M</span>
        </div>
        <div>
          <div style="font-weight: 700; font-size: 18px;" id="profileName">–ò–≥—Ä–æ–∫</div>
          <div style="color: var(--text-secondary);" id="profileUsername">@user</div>
        </div>
      </div>
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; text-align: center;">
        <div>
          <div style="color: var(--gold); font-weight: 700; font-size: 20px;" id="profileCases">0</div>
          <div style="color: var(--text-secondary); font-size: 12px;">–ö–µ–π—Å–æ–≤</div>
        </div>
        <div>
          <div style="color: var(--gold); font-weight: 700; font-size: 20px;" id="profileNFTs">0</div>
          <div style="color: var(--text-secondary); font-size: 12px;">NFT</div>
        </div>
        <div>
          <div style="color: var(--gold); font-weight: 700; font-size: 20px;" id="profileBest">-</div>
          <div style="color: var(--text-secondary); font-size: 12px;">–õ—É—á—à–∏–π</div>
        </div>
      </div>
    </div>

    <div style="background: var(--bg-card); border-radius: 20px; padding: 20px;">
      <h3 style="margin-bottom: 16px;">üèÜ –¢–æ–ø –ª–∏–¥–µ—Ä–æ–≤</h3>
      <div id="leaderboard"></div>
    </div>
  </div>

  <div class="page" id="trade">
    <div style="background: var(--bg-card); border-radius: 20px; padding: 20px;">
      <h3 style="margin-bottom: 16px;">ü§ù –û–±–º–µ–Ω —Å –∏–≥—Ä–æ–∫–∞–º–∏</h3>
      <input type="text" class="trade-input" id="tradeUsername" placeholder="Username –∏–≥—Ä–æ–∫–∞">
      <div style="margin: 16px 0;">
        <h4>–í—ã–±–µ—Ä–∏—Ç–µ NFT –¥–ª—è –æ–±–º–µ–Ω–∞:</h4>
        <div class="nft-select" id="tradeNFTs"></div>
      </div>
      <button class="btn" onclick="sendTrade()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
    </div>
  </div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="nav">
    <div class="nav-item active" onclick="switchPage('shop', this)">
      <i>üì¶</i>
      <span>–ö–µ–π—Å—ã</span>
    </div>
    <div class="nav-item" onclick="switchPage('inventory', this)">
      <i>üéí</i>
      <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
    </div>
    <div class="nav-item" onclick="switchPage('profile', this)">
      <i>üëë</i>
      <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </div>
    <div class="nav-item" onclick="switchPage('trade', this)">
      <i>ü§ù</i>
      <span>–û–±–º–µ–Ω</span>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –¥—Ä–æ–ø–∞ NFT -->
  <div class="modal" id="dropModal">
    <div class="modal-content">
      <h2 style="text-align: center; margin-bottom: 20px;">‚ú® –ù–æ–≤—ã–π NFT!</h2>
      <div style="text-align: center;">
        <div style="font-size: 80px; margin-bottom: 16px;" id="dropIcon">üé®</div>
        <div style="font-weight: 700; font-size: 20px; margin-bottom: 8px;" id="dropName"></div>
        <div style="color: var(--text-secondary); margin-bottom: 16px;" id="dropDesc"></div>
        <div style="padding: 8px; border-radius: 20px; display: inline-block; background: rgba(240, 185, 11, 0.1); margin-bottom: 20px;" id="dropRarity">–†–µ–¥–∫–æ—Å—Ç—å</div>
      </div>
      <button class="btn" onclick="acceptDrop()">–ó–∞–±—Ä–∞—Ç—å</button>
      <button class="btn btn-secondary" style="margin-top: 8px;" onclick="closeDropModal()">–û—Ç–∫–∞–∑–∞—Ç—å—Å—è</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è -->
  <div class="modal" id="upgradeModal">
    <div class="modal-content">
      <h2 style="text-align: center; margin-bottom: 20px;">‚ö° –£–ª—É—á—à–µ–Ω–∏–µ NFT</h2>
      
      <div class="upgrader-circle">
        <svg class="progress-ring" width="180" height="180">
          <circle class="progress-ring__circle" stroke="var(--gold)" stroke-width="8" fill="transparent" r="70" cx="90" cy="90"/>
        </svg>
        <div class="upgrade-percent" id="upgradePercent">0%</div>
      </div>

      <div style="text-align: center; margin: 20px 0;" id="upgradeNFTInfo"></div>
      
      <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 16px; margin: 16px 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span>–°—Ç–æ–∏–º–æ—Å—Ç—å:</span>
          <span style="color: var(--gold); font-weight: 700;" id="upgradeCost">5000 ü™ô</span>
        </div>
        <div style="display: flex; justify-content: space-between;">
          <span>–†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏:</span>
          <span style="color: #f87171; font-weight: 700;" id="upgradeRisk">15%</span>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 16px;" id="nftSelection"></div>

      <button class="btn" onclick="performUpgrade()">üöÄ –£–ª—É—á—à–∏—Ç—å</button>
      <button class="btn btn-secondary" style="margin-top: 8px;" onclick="closeUpgradeModal()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    tg?.expand();
    tg?.ready();

    // NFT –±–∞–∑–∞ —Å –∏–∫–æ–Ω–∫–∞–º–∏
    const NFT_TEMPLATES = [
      { id: 'n1', name: 'Cyber Dragon', icon: 'üêâ', rarity: 'MYTH', baseChance: 1 },
      { id: 'n2', name: 'Neon Samurai', icon: '‚öîÔ∏è', rarity: 'LEGEND', baseChance: 3 },
      { id: 'n3', name: 'Quantum Core', icon: 'üíé', rarity: 'EPIC', baseChance: 8 },
      { id: 'n4', name: 'Hologram Wolf', icon: 'üê∫', rarity: 'RARE', baseChance: 15 },
      { id: 'n5', name: 'Digital Ghost', icon: 'üëª', rarity: 'COMMON', baseChance: 30 },
      { id: 'n6', name: 'Plasma Sword', icon: '‚ö°', rarity: 'EPIC', baseChance: 8 },
      { id: 'n7', name: 'Crystal Skull', icon: 'üíÄ', rarity: 'LEGEND', baseChance: 3 },
      { id: 'n8', name: 'Neon Mask', icon: 'üé≠', rarity: 'RARE', baseChance: 15 },
      { id: 'n9', name: 'Golden Eye', icon: 'üëÅÔ∏è', rarity: 'MYTH', baseChance: 1 },
      { id: 'n10', name: 'Matrix Glitch', icon: 'üìü', rarity: 'COMMON', baseChance: 30 }
    ];

    // –ö–µ–π—Å—ã –ø–æ —Ä–µ–¥–∫–æ—Å—Ç—è–º
    const CASES = [
      { id: 'c1', name: '–û–±—ã—á–Ω—ã–π –∫–µ–π—Å', rarity: 'COMMON', price: 1000, icon: 'üì¶', color: '#9ca3af' },
      { id: 'c2', name: '–†–µ–¥–∫–∏–π –∫–µ–π—Å', rarity: 'RARE', price: 5000, icon: 'üîÆ', color: '#4ade80' },
      { id: 'c3', name: '–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å', rarity: 'EPIC', price: 15000, icon: 'üí´', color: '#a78bfa' },
      { id: 'c4', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å', rarity: 'LEGEND', price: 50000, icon: 'üëë', color: '#fbbf24' },
      { id: 'c5', name: '–ú–∏—Ñ–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å', rarity: 'MYTH', price: 150000, icon: 'üî•', color: '#f87171' }
    ];

    let state = {
      balance: 15000,
      inventory: [],
      casesOpened: 0,
      bestDrop: null,
      lastDaily: null,
      eventActive: true
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    function loadState() {
      const saved = localStorage.getItem('eliteDebState');
      if (saved) {
        try {
          state = JSON.parse(saved);
        } catch (e) {}
      }
    }
    loadState();

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    function saveState() {
      localStorage.setItem('eliteDebState', JSON.stringify(state));
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
    function updateBalance() {
      document.getElementById('balance').textContent = state.balance.toLocaleString();
    }

    // –†–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤
    function renderCases(filter = 'ALL') {
      const grid = document.getElementById('casesGrid');
      grid.innerHTML = '';
      
      CASES.filter(c => filter === 'ALL' || c.rarity === filter).forEach(c => {
        const card = document.createElement('div');
        card.className = 'case-card';
        card.setAttribute('data-rarity', c.rarity);
        card.innerHTML = `
          <div class="case-icon" style="border-color: ${c.color}">${c.icon}</div>
          <div class="case-name">${c.name}</div>
          <div class="case-price">${c.price.toLocaleString()} ü™ô</div>
        `;
        card.onclick = () => openCase(c);
        grid.appendChild(card);
      });
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
    function openCase(caseItem) {
      if (state.balance < caseItem.price) {
        alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        tg?.HapticFeedback?.notificationOccurred('error');
        return;
      }

      state.balance -= caseItem.price;
      state.casesOpened++;
      updateBalance();
      saveState();

      tg?.HapticFeedback?.impactOccurred('medium');

      // –ê–Ω–∏–º–∞—Ü–∏—è
      const caseIcon = event.currentTarget.querySelector('.case-icon');
      caseIcon.style.animation = 'spin 1s ease-in-out';

      setTimeout(() => {
        caseIcon.style.animation = '';
        
        // –®–∞–Ω—Å—ã –Ω–∞ –¥—Ä–æ–ø
        let pool = NFT_TEMPLATES;
        if (state.eventActive) {
          // –ò–≤–µ–Ω—Ç - —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —à–∞–Ω—Å—ã –Ω–∞ —Ä–µ–¥–∫–∏–µ
          pool = NFT_TEMPLATES.flatMap(n => 
            Array(n.rarity === 'MYTH' ? 3 : n.rarity === 'LEGEND' ? 5 : 1).fill(n)
          );
        }

        const rolled = Math.random() * 100;
        let chanceSum = 0;
        let dropped = pool[Math.floor(Math.random() * pool.length)];

        // –ö–æ–ø–∏—Ä—É–µ–º NFT —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID
        const newNFT = {
          ...dropped,
          uid: Date.now() + Math.random(),
          level: 0
        };

        showDropModal(newNFT);
        tg?.HapticFeedback?.notificationOccurred('success');
      }, 1000);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –¥—Ä–æ–ø
    function showDropModal(nft) {
      const modal = document.getElementById('dropModal');
      document.getElementById('dropIcon').textContent = nft.icon;
      document.getElementById('dropName').textContent = nft.name;
      document.getElementById('dropDesc').textContent = `–£—Ä–æ–≤–µ–Ω—å ${nft.level}`;
      document.getElementById('dropRarity').textContent = nft.rarity;
      document.getElementById('dropRarity').style.color = getRarityColor(nft.rarity);
      
      modal.classList.add('active');
      window.currentDrop = nft;
    }

    // –ü—Ä–∏–Ω—è—Ç—å –¥—Ä–æ–ø
    function acceptDrop() {
      if (window.currentDrop) {
        state.inventory.push(window.currentDrop);
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª—É—á—à–µ–≥–æ –¥—Ä–æ–ø–∞
        const rarityWeight = { 'COMMON': 1, 'RARE': 2, 'EPIC': 3, 'LEGEND': 4, 'MYTH': 5 };
        if (!state.bestDrop || rarityWeight[window.currentDrop.rarity] > rarityWeight[state.bestDrop]) {
          state.bestDrop = window.currentDrop.rarity;
        }
        
        saveState();
        renderInventory();
        updateProfile();
        closeDropModal();
        tg?.HapticFeedback?.impactOccurred('light');
      }
    }

    function closeDropModal() {
      document.getElementById('dropModal').classList.remove('active');
      window.currentDrop = null;
    }

    // –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
    function renderInventory() {
      const grid = document.getElementById('inventoryGrid');
      const empty = document.getElementById('inventory-empty');
      
      if (state.inventory.length === 0) {
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
        return;
      }

      grid.innerHTML = state.inventory.map((nft, index) => `
        <div class="nft-card" data-rarity="${nft.rarity}" onclick="openUpgradeModal(${index})">
          <div class="nft-icon">${nft.icon}</div>
          <div class="nft-name">${nft.name}</div>
          <div class="nft-level">–£—Ä. ${nft.level}</div>
          ${nft.level < 5 ? '<div class="upgrade-badge">‚ö°</div>' : ''}
        </div>
      `).join('');
    }

    // –£–ª—É—á—à–µ–Ω–∏–µ NFT
    let selectedUpgradeNFT = null;

    function openUpgradeModal(index) {
      selectedUpgradeNFT = state.inventory[index];
      if (!selectedUpgradeNFT) return;

      const modal = document.getElementById('upgradeModal');
      const percent = (selectedUpgradeNFT.level / 5) * 100;
      
      // –†–∏—Å—É–µ–º –∫—Ä—É–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
      const circle = document.querySelector('.progress-ring__circle');
      const radius = circle.r.baseVal.value;
      const circumference = radius * 2 * Math.PI;
      circle.style.strokeDasharray = `${circumference} ${circumference}`;
      circle.style.strokeDashoffset = circumference - (percent / 100) * circumference;
      
      document.getElementById('upgradePercent').textContent = Math.round(percent) + '%';
      document.getElementById('upgradeNFTInfo').innerHTML = `
        <div style="font-size: 40px;">${selectedUpgradeNFT.icon}</div>
        <div style="font-weight: 700;">${selectedUpgradeNFT.name}</div>
        <div style="color: var(--text-secondary);">–£—Ä–æ–≤–µ–Ω—å ${selectedUpgradeNFT.level}/5</div>
      `;

      const cost = 5000 * (selectedUpgradeNFT.level + 1);
      const risk = 15 + (selectedUpgradeNFT.level * 5);

      document.getElementById('upgradeCost').innerHTML = `${cost.toLocaleString()} ü™ô`;
      document.getElementById('upgradeRisk').textContent = risk + '%';

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ NFT –¥–ª—è –≤—ã–±–æ—Ä–∞
      const selection = document.getElementById('nftSelection');
      selection.innerHTML = state.inventory
        .filter((_, i) => i !== index)
        .slice(0, 3)
        .map(nft => `
          <div class="nft-card" style="cursor: pointer;" onclick="selectUpgradeNFT('${nft.uid}')">
            <div class="nft-icon">${nft.icon}</div>
            <div style="font-size: 10px;">${nft.name}</div>
          </div>
        `).join('') || '<div style="grid-column: 1/-1; text-align: center;">–ù–µ—Ç –¥—Ä—É–≥–∏—Ö NFT</div>';

      modal.classList.add('active');
    }

    function selectUpgradeNFT(uid) {
      const nft = state.inventory.find(n => n.uid === uid);
      if (nft) {
        alert(`–í—ã–±—Ä–∞–Ω–æ: ${nft.name} –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è`);
        // –õ–æ–≥–∏–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
      }
    }

    function closeUpgradeModal() {
      document.getElementById('upgradeModal').classList.remove('active');
      selectedUpgradeNFT = null;
    }

    function performUpgrade() {
      if (!selectedUpgradeNFT) return;
      
      const cost = 5000 * (selectedUpgradeNFT.level + 1);
      const risk = 15 + (selectedUpgradeNFT.level * 5);

      if (state.balance < cost) {
        alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        return;
      }

      state.balance -= cost;

      if (Math.random() * 100 < risk) {
        // –ù–µ—É–¥–∞—á–∞
        const index = state.inventory.findIndex(n => n.uid === selectedUpgradeNFT.uid);
        if (index > -1) state.inventory.splice(index, 1);
        alert('üí• NFT —É–Ω–∏—á—Ç–æ–∂–µ–Ω!');
        tg?.HapticFeedback?.notificationOccurred('error');
      } else {
        // –£—Å–ø–µ—Ö
        selectedUpgradeNFT.level++;
        if (selectedUpgradeNFT.level >= 5) {
          // –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ä–µ–¥–∫–æ—Å—Ç–∏
          const rarities = ['COMMON', 'RARE', 'EPIC', 'LEGEND', 'MYTH'];
          const currentIndex = rarities.indexOf(selectedUpgradeNFT.rarity);
          if (currentIndex < rarities.length - 1) {
            selectedUpgradeNFT.rarity = rarities[currentIndex + 1];
          }
        }
        alert('üöÄ –£–ª—É—á—à–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!');
        tg?.HapticFeedback?.notificationOccurred('success');
      }

      updateBalance();
      saveState();
      renderInventory();
      closeUpgradeModal();
    }

    // –ö—Ä–∞—Ñ—Ç
    function craftItems() {
      if (state.inventory.length < 3) {
        alert('‚ùå –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 NFT');
        return;
      }

      const first = state.inventory[0];
      const rarities = ['COMMON', 'RARE', 'EPIC', 'LEGEND', 'MYTH'];
      const currentIndex = rarities.indexOf(first.rarity);
      const newRarity = rar
