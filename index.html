<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --gold: #f3ba2f; --bg: #050608; --card: #111418; --accent: #00f2ff; --red: #ff4757; }
        body { background: var(--bg); color: #fff; font-family: 'Unbounded', sans-serif; margin: 0; overflow: hidden; height: 100vh; user-select: none; }

        .header { padding: 15px 20px; background: rgba(17,20,24,0.9); backdrop-filter: blur(10px); border-bottom: 1px solid #222; display: flex; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
        .bal { color: var(--gold); font-weight: 900; font-size: 18px; }

        .page { height: 82vh; overflow-y: auto; padding: 15px; display: none; padding-bottom: 120px; }
        .page.active { display: block; animation: fadeIn 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .case { background: var(--card); border-radius: 20px; padding: 15px; text-align: center; border: 1px solid #222; position: relative; }
        .case:active { transform: scale(0.95); border-color: var(--accent); }
        .case-icon { font-size: 45px; display: block; margin-bottom: 10px; filter: drop-shadow(0 0 10px var(--accent)); }

        .inv-item { background: #161a1f; border-radius: 15px; padding: 10px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; border: 1px solid #222; }
        .sell-btn { background: var(--red); color: white; border: none; padding: 8px 12px; border-radius: 8px; font-size: 10px; font-weight: bold; }

        .lead-row { display: flex; justify-content: space-between; padding: 12px; background: #111418; border-radius: 12px; margin-bottom: 6px; border-left: 3px solid var(--accent); }

        #roulette { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .view-port { width: 100%; height: 140px; position: relative; overflow: hidden; background: #080808; border-top: 2px solid #222; border-bottom: 2px solid #222; }
        .reel { display: flex; position: absolute; left: 50%; align-items: center; height: 100%; will-change: transform; }
        .slot { min-width: 110px; height: 120px; display: flex; align-items: center; justify-content: center; font-size: 50px; opacity: 0.3; transition: 0.5s; }
        .slot.win { opacity: 1; transform: scale(1.3); filter: drop-shadow(0 0 15px var(--gold)); }
        .center-line { position: absolute; left: 50%; width: 3px; height: 100%; background: var(--gold); z-index: 100; transform: translateX(-50%); box-shadow: 0 0 20px var(--gold); }

        .nav { position: fixed; bottom: 20px; left: 15px; right: 15px; background: #111418; display: flex; justify-content: space-around; padding: 12px; border-radius: 20px; border: 1px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .nav-i { font-size: 20px; opacity: 0.3; transition: 0.2s; }
        .nav-i.active { opacity: 1; color: var(--gold); transform: scale(1.2); }

        .btn-action { background: var(--gold); color: #000; border: none; padding: 15px 40px; border-radius: 15px; font-weight: 900; margin-top: 20px; width: 100%; }

        .top-tools { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
        .top-tools button { flex:1 1 30%; padding:8px; border-radius:10px; border:1px solid #333; background:#111418; color:#fff; font-size:10px; }

        .badge { font-size:10px; padding:2px 6px; border-radius:999px; background:rgba(243,186,47,0.09); border:1px solid rgba(243,186,47,0.4); margin-left:5px; }
    </style>
</head>
<body>

    <div class="header">
        <div class="bal">ü™ô <span id="balance">15,000</span></div>
        <div style="font-size:10px; color:var(--accent)">
            ELITE DEB
            <span id="event-badge" class="badge">üî• –û–≥–Ω–µ–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è</span>
        </div>
    </div>

    <!-- –ú–ê–ì–ê–ó–ò–ù / –†–ï–ñ–ò–ú–´ -->
    <div id="p-shop" class="page active">
        <div class="top-tools">
            <button onclick="playCoinflip()">ü™ô –ú–û–ù–ï–¢–ö–ê x2</button>
            <button onclick="playMiniCrash()">üìà –ö–†–≠–® –ú–ò–ù–ò</button>
            <button onclick="openDaily()">üìÜ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°</button>
        </div>

        <h3 style="margin-top:10px;">üì¶ –ö–ï–ô–°–´</h3>
        <div class="grid" id="case-container"></div>
    </div>
    
    <!-- –ò–ù–í–ï–ù–¢–ê–†–¨ -->
    <div id="p-inv" class="page">
        <h3>üéí –ú–û–ô –ò–ù–í–ï–ù–¢–ê–†–¨</h3>
        <button class="btn-action" style="margin-top:5px;" onclick="craftItems()">‚öóÔ∏è –ö–†–ê–§–¢ (3‚Üí1)</button>
        <div id="inventory-list" style="margin-top:10px;"></div>
    </div>

    <!-- –õ–ò–î–ï–†–´ -->
    <div id="p-top" class="page">
        <h3>üèÜ –¢–û–ü –õ–ò–î–ï–†–û–í</h3>
        <div id="leaderboard"></div>
    </div>

    <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
    <div id="p-set" class="page">
        <h3>‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</h3>
        <div class="inv-item"><span>–í–∏–±—Ä–∞—Ü–∏—è</span><input type="checkbox" id="set-vibrate" checked></div>
        <button class="btn-action" style="background:var(--red); color:white; margin-top:30px;" onclick="tg.close()">–í–´–ô–¢–ò</button>
    </div>

    <!-- –†–£–õ–ï–¢–ö–ê -->
    <div id="roulette">
        <h2 id="r-status" style="letter-spacing:3px;">–í–†–ê–©–ï–ù–ò–ï...</h2>
        <div class="view-port">
            <div class="center-line"></div>
            <div id="reel" class="reel"></div>
        </div>
        <button id="r-close" class="btn-action" style="display:none;" onclick="closeR()">–ó–ê–ë–†–ê–¢–¨ –î–†–û–ü</button>
    </div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <div class="nav">
        <div class="nav-i active" onclick="tab('p-shop', this)">üì¶</div>
        <div class="nav-i" onclick="tab('p-inv', this)">üéí</div>
        <div class="nav-i" onclick="tab('p-top', this)">üèÜ</div>
        <div class="nav-i" onclick="tab('p-set', this)">‚öôÔ∏è</div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) tg.expand();

        // –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ—Ç–æ–º –º–æ–∂–µ—à—å –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ CloudStorage TG)
        let state = {
            bal: 15000,
            inv: [],
            lastDaily: null,
            eventFireWeek: true // —Ñ–ª–∞–≥ –∏–≤–µ–Ω—Ç–∞
        };

        const STORAGE_KEY = "elite_deb_state_v1";

        function saveState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            } catch(e) {}
        }
        function loadState() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                if (!raw) return;
                const parsed = JSON.parse(raw);
                state = Object.assign(state, parsed);
            } catch(e) {}
        }
        loadState();

        const ITEMS = [
            {img:'üçï',n:'–ú—É—Å–æ—Ä',p:100}, 
            {img:'üíä',n:'–í–∏—Ä—É—Å',p:500}, 
            {img:'üß™',n:'–î–ù–ö',p:1500}, 
            {img:'üëæ',n:'–ú—É—Ç–∞–Ω—Ç',p:4500}, 
            {img:'üíé',n:'–ê–ª–º–∞–∑',p:12000}, 
            {img:'üëë',n:'–ö–æ—Ä–æ–Ω–∞',p:60000}
        ];

        // —É—Å–∏–ª–µ–Ω–Ω—ã–µ —à–∞–Ω—Å—ã –ø—Ä–∏ –∏–≤–µ–Ω—Ç–µ
        function randomItem() {
            if (!state.eventFireWeek) {
                return ITEMS[Math.floor(Math.random()*ITEMS.length)];
            }
            const pool = [
                ITEMS[0], ITEMS[0], ITEMS[1], ITEMS[1],
                ITEMS[2], ITEMS[2], ITEMS[3], ITEMS[3],
                ITEMS[4], ITEMS[4], ITEMS[5] // –Ω–µ–º–Ω–æ–≥–æ –±—É—Å—Ç–∏–º —Ç–æ–ø
            ];
            return pool[Math.floor(Math.random()*pool.length)];
        }

        const container = document.getElementById('case-container');
        for(let i=1; i<=52; i++) {
            let p = i * 1350;
            container.innerHTML += `
                <div class="case" onclick="buyCase(${p})">
                    <span class="case-icon">${ITEMS[i % ITEMS.length].img}</span>
                    <div style="font-size:10px; font-weight:bold;">–ö–ï–ô–° ‚Ññ${i}</div>
                    <div style="color:var(--gold); font-size:12px;">${p.toLocaleString()} ü™ô</div>
                </div>`;
        }

        function buyCase(price) {
            if(state.bal < price) {
                alert("‚ùå –ù–ï–¢ –î–ï–ù–ï–ì!");
                return;
            }
            state.bal -= price; 
            updateUI(); 
            startRoulette(price);
        }

        // —Ä—É–ª–µ—Ç–∫–∞ —Å –æ—Ç—Å–∫–æ–∫–æ–º
        function startRoulette(price) {
            const r = document.getElementById('roulette');
            const reel = document.getElementById('reel');
            r.style.display = 'flex'; 
            document.getElementById('r-close').style.display = 'none';
            document.getElementById('r-status').innerText = "–£–î–ê–ß–ê...";

            let html = ''; 
            for(let i=0; i<100; i++) html += `<div class="slot">${randomItem().img}</div>`;
            reel.innerHTML = html;

            reel.style.transition = 'none';
            reel.style.transform = 'translateX(-55px)';

            setTimeout(() => {
                const slotW = 110;
                const winIdx = 80;

                const prize = randomItem();
                const slots = document.querySelectorAll('.slot');
                if (slots[winIdx]) slots[winIdx].textContent = prize.img;

                const perfectShift = winIdx * slotW + 55;
                const overshoot = 40;
                const targetShift = perfectShift + overshoot;

                reel.style.transition = 'transform 7.2s cubic-bezier(0.15, 0, 0.05, 1)';
                reel.style.transform = `translateX(-${targetShift}px)`;

                let ticks = 0;
                const tInt = setInterval(() => {
                    ticks++;
                    if (document.getElementById('set-vibrate').checked && tg?.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('light');
                    }
                    if (ticks > 60) clearInterval(tInt);
                }, 120);

                setTimeout(() => {
                    reel.style.transition = 'transform 0.35s cubic-bezier(0.3, 0.8, 0.3, 1.5)';
                    reel.style.transform = `translateX(-${perfectShift}px)`;

                    if (slots[winIdx]) slots[winIdx].classList.add('win');
                    if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');

                    state.inv.push(prize);
                    updateUI();
                    renderInv();
                    document.getElementById('r-status').innerText = "–í–´–ü–ê–õ–û: " + prize.n;
                    document.getElementById('r-close').style.display = 'block';
                    saveState();
                }, 7200);
            }, 100);
        }

        function closeR() { document.getElementById('roulette').style.display = 'none'; }

        // –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        function renderInv() {
            document.getElementById('inventory-list').innerHTML = state.inv.map((item, i) => `
                <div class="inv-item">
                    <span>${item.img} ${item.n}</span>
                    <button class="sell-btn" onclick="sell(${i}, ${item.p})">–ü–†–û–î–ê–¢–¨ –ó–ê ${Math.floor(item.p/2)}</button>
                </div>`).join('');
        }

        function sell(i, p) { 
            state.bal += Math.floor(p/2); 
            state.inv.splice(i, 1); 
            updateUI(); 
            renderInv(); 
            saveState();
            if(tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        // –∫—Ä–∞—Ñ—Ç 3‚Üí1
        function craftItems() {
            if (state.inv.length < 3) {
                alert("–ú–∞–ª–æ –ª—É—Ç–∞ –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞. –ù—É–∂–Ω—ã —Ö–æ—Ç—è –±—ã 3 –ø—Ä–µ–¥–º–µ—Ç–∞.");
                return;
            }
            const groups = {};
            state.inv.forEach((it, idx) => {
                if (!groups[it.n]) groups[it.n] = [];
                groups[it.n].push({item: it, index: idx});
            });

            let chosenName = null;
            for (const name in groups) {
                if (groups[name].length >= 3) {
                    chosenName = name;
                    break;
                }
            }
            if (!chosenName) {
                alert("–ù–µ—Ç —Ç—Ä–æ–π–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –∫—Ä–∞—Ñ—Ç–∞.");
                return;
            }

            const group = groups[chosenName].slice(0, 3);
            const base = group[0].item;

            const indexes = group.map(g => g.index).sort((a,b) => b-a);
            indexes.forEach(i => state.inv.splice(i,1));

            const upgraded = {
                img: base.img,
                n: base.n + " +",
                p: Math.floor(base.p * 3.2)
            };
            state.inv.push(upgraded);
            renderInv();
            saveState();

            alert("‚öóÔ∏è –ú–∞–∫—Å —Å–≤–∞—Ä–∏–ª –∞–ø–≥—Ä–µ–π–¥: " + upgraded.n + " (" + upgraded.p + " ü™ô)");
        }

        // –†–ï–ñ–ò–ú: –º–æ–Ω–µ—Ç–∫–∞
        function playCoinflip() {
            const bet = 1000;
            if (state.bal < bet) {
                alert("–ù—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º 1000 ü™ô –¥–ª—è –º–æ–Ω–µ—Ç–∫–∏");
                return;
            }
            if (!confirm("–°—ã–≥—Ä–∞—Ç—å –º–æ–Ω–µ—Ç–∫—É –Ω–∞ 1000 ü™ô?")) return;
            state.bal -= bet;
            updateUI();

            const win = Math.random() < 0.48;
            setTimeout(() => {
                if (win) {
                    const gain = bet * 2;
                    state.bal += gain;
                    updateUI();
                    alert("ü™ô –û—Ä—ë–ª! –¢—ã —É–¥–≤–æ–∏–ª —Å—Ç–∞–≤–∫—É: +" + gain + " ü™ô");
                } else {
                    alert("ü™ô –†–µ—à–∫–∞! –ú–∞–∫—Å –∑–∞–±—Ä–∞–ª —Ç–≤–æ—é —Ç—ã—Å—è—á—É.");
                }
                saveState();
            }, 400);
        }

        // –†–ï–ñ–ò–ú: –º–∏–Ω–∏-–∫—Ä—ç—à
        function playMiniCrash() {
            const bet = 2000;
            if (state.bal < bet) {
                alert("–ù—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º 2000 ü™ô –¥–ª—è –∫—Ä—ç—à–∞");
                return;
            }
            if (!confirm("–ö—Ä—ç—à –Ω–∞ 2000 ü™ô? –£—Å–ø–µ–π –Ω–∞–∂–∞—Ç—å –û–ö –¥–æ –∫—Ä–∞—à–∞.")) return;

            state.bal -= bet;
            updateUI();

            let multiplier = 1.00;
            const step = 0.05 + Math.random() * 0.05;
            let crashed = false;
            let cashedOut = false;

            const crashPoint = 1.5 + Math.random() * 3;

            const interval = setInterval(() => {
                multiplier += step;
                if (multiplier >= crashPoint && !crashed && !cashedOut) {
                    crashed = true;
                    clearInterval(interval);
                    alert("üí• –ö—Ä—ç—à –Ω–∞ x" + multiplier.toFixed(2) + "! –¢—ã –Ω–µ —É—Å–ø–µ–ª.");
                    saveState();
                    return;
                }
            }, 300);

            setTimeout(() => {
                if (crashed) return;
                if (confirm("–°–µ–π—á–∞—Å x" + multiplier.toFixed(2) + ". –ó–∞–±—Ä–∞—Ç—å?")) {
                    cashedOut = true;
                    clearInterval(interval);
                    const gain = Math.floor(bet * multiplier);
                    state.bal += gain;
                    updateUI();
                    alert("üìà –ó–∞–±—Ä–∞–ª –Ω–∞ x" + multiplier.toFixed(2) + ": +" + gain + " ü™ô");
                    saveState();
                }
            }, 2000);
        }

        // –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
        function openDaily() {
            const today = new Date().toDateString();
            if (state.lastDaily === today) {
                alert("üìÜ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å —É–∂–µ –∑–∞–±—Ä–∞–Ω.");
                return;
            }
            const reward = 2000 + Math.floor(Math.random()*3000);
            state.lastDaily = today;
            state.bal += reward;
            updateUI();
            saveState();
            alert("üìÜ DAILY: +" + reward.toLocaleString() + " ü™ô");
        }

        function tab(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-i').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        function updateUI() {
            document.getElementById('balance').innerText = state.bal.toLocaleString();
            document.getElementById('leaderboard').innerHTML = `
                <div class="lead-row"><span>1. Boss_Crypto</span><span>2.5M</span></div>
                <div class="lead-row" style="background:rgba(0,242,255,0.1)"><span>3. –¢–´</span><span>${state.bal.toLocaleString()}</span></div>`;
            document.getElementById('event-badge').style.display = state.eventFireWeek ? 'inline-block' : 'none';
        }

        updateUI();
        renderInv();
    </script>
</body>
</html>
