<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON CODER PRO | VISION</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { 
            --neon: #00ff88; 
            --neon-dim: rgba(0, 255, 136, 0.3);
            --bg: #020502; 
            --glass: rgba(0, 255, 136, 0.08);
            --danger: #ff4444;
            --surface: #0a0f0a;
        }
        
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body, html { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--bg); 
            color: #e8f5e9; 
            overflow: hidden; 
            line-height: 1.6;
        }
        
        #canvas { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: -1; 
            pointer-events: none; 
        }
        
        .app { 
            display: flex; 
            flex-direction: column; 
            width: 100vw; 
            height: 100vh; 
        }
        
        .header { 
            padding: 16px 20px; 
            background: linear-gradient(180deg, rgba(0,0,0,0.95) 0%, rgba(0,20,10,0.9) 100%);
            border-bottom: 1px solid var(--neon-dim); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.15);
            z-index: 10; 
            backdrop-filter: blur(10px);
        }
        
        .header b { 
            color: var(--neon); 
            letter-spacing: 2px; 
            font-size: 15px;
            font-weight: 700;
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--neon-dim);
            animation: neonPulse 2s ease-in-out infinite;
        }
        
        @keyframes neonPulse {
            0%, 100% { text-shadow: 0 0 10px var(--neon-dim), 0 0 20px var(--neon-dim); }
            50% { text-shadow: 0 0 20px var(--neon), 0 0 30px var(--neon); }
        }
        
        .energy { 
            background: linear-gradient(135deg, var(--neon) 0%, #00cc6a 100%);
            color: #000; 
            padding: 6px 14px; 
            border-radius: 20px; 
            font-weight: 800; 
            font-size: 11px;
            letter-spacing: 0.5px;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            animation: energyGlow 3s ease-in-out infinite;
        }
        
        @keyframes energyGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(0, 255, 136, 0.4); }
            50% { box-shadow: 0 0 25px rgba(0, 255, 136, 0.8), 0 0 35px rgba(0, 255, 136, 0.4); }
        }
        
        .energy.creator { 
            background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            animation: creatorGlow 2s ease-in-out infinite;
        }
        
        @keyframes creatorGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.9), 0 0 45px rgba(255, 215, 0, 0.5); }
        }

        #chat { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 16px; 
            scroll-behavior: smooth;
            background: linear-gradient(180deg, var(--bg) 0%, var(--surface) 100%);
        }
        
        .msg { 
            max-width: 82%; 
            padding: 14px 18px; 
            border-radius: 18px; 
            font-size: 14.5px; 
            line-height: 1.6; 
            animation: messageAppear 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .msg:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        }
        
        @keyframes messageAppear {
            0% { 
                opacity: 0; 
                transform: translateY(30px) scale(0.8) rotateX(-15deg); 
            }
            70% {
                transform: translateY(-5px) scale(1.02) rotateX(5deg);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1) rotateX(0); 
            }
        }
        
        .user { 
            background: linear-gradient(135deg, var(--neon) 0%, #00cc6a 100%);
            color: #001a0d; 
            align-self: flex-end; 
            font-weight: 600;
            border-bottom-right-radius: 4px;
            margin-left: 40px;
            animation: userSlide 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes userSlide {
            0% { opacity: 0; transform: translateX(50px) scale(0.9); }
            70% { transform: translateX(-10px) scale(1.02); }
            100% { opacity: 1; transform: translateX(0) scale(1); }
        }
        
        .ai { 
            background: var(--surface);
            border: 1px solid var(--glass);
            align-self: flex-start; 
            border-bottom-left-radius: 4px;
            color: #e0f2e9;
            margin-right: 40px;
            backdrop-filter: blur(10px);
            animation: aiSlide 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes aiSlide {
            0% { opacity: 0; transform: translateX(-50px) scale(0.9); }
            70% { transform: translateX(10px) scale(1.02); }
            100% { opacity: 1; transform: translateX(0) scale(1); }
        }
        
        .system { 
            background: rgba(255,68,68,0.08);
            border: 1px solid rgba(255,68,68,0.3);
            color: #ff8888; 
            align-self: center; 
            text-align: center;
            max-width: 90%;
            font-size: 13px;
            animation: pulseWarning 2s ease-in-out infinite;
        }
        
        @keyframes pulseWarning {
            0%, 100% { box-shadow: 0 0 0 rgba(255,68,68,0); }
            50% { box-shadow: 0 0 20px rgba(255,68,68,0.3); }
        }
        
        .preview-img { 
            max-width: 100%; 
            border-radius: 12px; 
            margin-top: 8px; 
            border: 1px solid var(--neon-dim);
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            animation: imageAppear 0.6s ease-out;
        }
        
        @keyframes imageAppear {
            0% { opacity: 0; transform: scale(0.8) rotate(-3deg); }
            100% { opacity: 1; transform: scale(1) rotate(0); }
        }
        
        .msg-actions { 
            position: absolute; 
            top: -24px; 
            right: 0; 
            display: none; 
            gap: 6px;
            animation: fadeIn 0.2s;
        }
        
        .msg:hover .msg-actions { display: flex; }
        
        .edit-btn, .delete-btn { 
            background: rgba(0,0,0,0.8);
            border: 1px solid var(--neon); 
            color: var(--neon); 
            padding: 4px 10px; 
            font-size: 11px; 
            border-radius: 6px; 
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
        }
        
        .edit-btn:hover, .delete-btn:hover {
            background: var(--neon);
            color: #000;
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--neon);
        }

        .photo-preview { 
            background: rgba(0,255,136,0.05); 
            border: 1px dashed var(--neon-dim); 
            border-radius: 12px; 
            padding: 12px; 
            margin-bottom: 12px; 
            position: relative;
            animation: slideDown 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes slideDown {
            0% { opacity: 0; transform: translateY(-20px) scale(0.9); }
            70% { transform: translateY(5px) scale(1.01); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .photo-preview img { 
            max-width: 100%; 
            border-radius: 10px; 
            display: block;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        .remove-photo { 
            position: absolute; 
            top: 8px; 
            right: 8px; 
            background: var(--danger); 
            color: white; 
            border: none; 
            width: 28px; 
            height: 28px; 
            border-radius: 50%; 
            cursor: pointer; 
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(255,68,68,0.4);
        }
        
        .remove-photo:hover { 
            transform: scale(1.15) rotate(90deg); 
            box-shadow: 0 4px 15px rgba(255,68,68,0.6);
        }

        .footer { 
            padding: 12px 16px 25px; 
            background: linear-gradient(0deg, rgba(0,0,0,0.98) 0%, rgba(0,10,5,0.95) 100%);
            border-top: 1px solid rgba(0,255,136,0.1);
            backdrop-filter: blur(20px);
        }
        
        .input-area { 
            display: flex; 
            gap: 10px; 
            align-items: flex-end; 
        }
        
        .tool-btn { 
            background: transparent; 
            border: 1.5px solid var(--neon-dim); 
            border-radius: 14px; 
            width: 44px; 
            height: 44px; 
            color: var(--neon); 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            flex-shrink: 0;
        }
        
        .tool-btn:hover {
            border-color: var(--neon);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            transform: translateY(-3px) scale(1.05);
        }
        
        .tool-btn:active { 
            background: var(--neon); 
            color: #000;
            transform: scale(0.95);
        }
        
        textarea { 
            flex: 1; 
            background: rgba(255,255,255,0.03);
            border: 1.5px solid rgba(0,255,136,0.2);
            border-radius: 14px; 
            color: #fff; 
            padding: 12px 16px; 
            min-height: 44px; 
            max-height: 120px; 
            outline: none; 
            resize: none; 
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
            transition: all 0.3s;
        }
        
        textarea:focus {
            border-color: var(--neon);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1), 0 0 20px rgba(0,255,136,0.2);
            background: rgba(255,255,255,0.05);
            transform: translateY(-2px);
        }
        
        textarea::placeholder {
            color: rgba(255,255,255,0.3);
        }
        
        .send-btn { 
            background: linear-gradient(135deg, var(--neon) 0%, #00cc6a 100%);
            border: none; 
            border-radius: 14px; 
            width: 44px; 
            height: 44px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
            flex-shrink: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .send-btn:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.5);
        }
        
        .send-btn:active { transform: scale(0.9); }
        
        .send-btn svg { 
            width: 20px; 
            height: 20px; 
            stroke: #000; 
            fill: none; 
            stroke-width: 2.5; 
        }
        
        .send-btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed;
            transform: none;
            animation: none;
        }

        pre { 
            background: #0d1117 !important; 
            border-radius: 12px; 
            padding: 16px; 
            overflow-x: auto; 
            border: 1px solid rgba(0,255,136,0.15);
            position: relative; 
            margin: 12px 0;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            padding-top: 50px;
        }
        
        code {
            font-family: 'JetBrains Mono', monospace !important;
        }
        
        .code-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        
        .copy-btn { 
            background: rgba(0,255,136,0.1);
            border: 1px solid var(--neon-dim);
            color: var(--neon);
            padding: 6px 12px; 
            font-size: 11px; 
            font-weight: 700;
            border-radius: 6px; 
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .copy-btn:hover {
            background: var(--neon);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,255,136,0.4);
        }

        .copy-full-btn {
            background: linear-gradient(135deg, var(--neon) 0%, #00cc6a 100%);
            border: none;
            color: #000;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .copy-full-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,255,136,0.5);
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 13px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--neon-dim);
        }
        
        th {
            background: rgba(0,255,136,0.1);
            color: var(--neon);
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(0,255,136,0.05);
        }

        .scroll-down-btn { 
            position: fixed; 
            bottom: 100px; 
            right: 20px; 
            width: 48px; 
            height: 48px; 
            background: linear-gradient(135deg, var(--neon) 0%, #00cc6a 100%);
            border: none; 
            border-radius: 50%; 
            color: #000; 
            cursor: pointer; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
            z-index: 100; 
            animation: float 3s ease-in-out infinite, pulseGlow 2s ease-in-out infinite;
            transition: all 0.3s;
        }
        
        .scroll-down-btn.visible { display: flex; }
        
        .scroll-down-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 30px rgba(0, 255, 136, 0.6);
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4); }
            50% { box-shadow: 0 6px 30px rgba(0, 255, 136, 0.7), 0 0 40px rgba(0,255,136,0.3); }
        }
        
        .scroll-down-btn svg { 
            width: 24px; 
            height: 24px; 
            stroke: currentColor; 
            fill: none; 
            stroke-width: 2.5; 
            animation: bounceArrow 2s infinite;
        }
        
        @keyframes bounceArrow {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-6px); }
            60% { transform: translateY(-3px); }
        }

        .photo-menu-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 1000; 
            display: none; 
            align-items: flex-end; 
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .photo-menu { 
            background: linear-gradient(180deg, #0a0f0a 0%, #050805 100%);
            border-top: 2px solid var(--neon); 
            width: 100%; 
            padding: 24px 20px 30px; 
            border-radius: 24px 24px 0 0; 
            animation: slideUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        
        @keyframes slideUp { 
            0% { transform: translateY(100%) scale(0.9); opacity: 0; } 
            70% { transform: translateY(-10px) scale(1.01); }
            100% { transform: translateY(0) scale(1); opacity: 1; } 
        }
        
        .photo-menu-title { 
            color: var(--neon); 
            text-align: center; 
            margin-bottom: 24px; 
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
            animation: textGlow 2s ease-in-out infinite;
        }
        
        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 5px var(--neon-dim); }
            50% { text-shadow: 0 0 20px var(--neon), 0 0 30px var(--neon); }
        }
        
        .photo-menu-btn { 
            width: 100%; 
            padding: 16px; 
            margin: 8px 0; 
            background: rgba(0,255,136,0.05);
            border: 1.5px solid var(--neon-dim); 
            color: var(--neon); 
            border-radius: 14px; 
            font-size: 15px; 
            font-weight: 600;
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px;
            transition: all 0.3s;
        }
        
        .photo-menu-btn:hover {
            background: rgba(0,255,136,0.15);
            border-color: var(--neon);
            transform: translateX(10px);
            box-shadow: 0 0 20px rgba(0,255,136,0.2);
        }
        
        .photo-menu-btn:active { 
            background: var(--neon); 
            color: #000;
            transform: scale(0.98);
        }
        
        .photo-menu-close { 
            width: 100%; 
            padding: 16px; 
            margin-top: 16px; 
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.6); 
            border-radius: 14px; 
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .photo-menu-close:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
            transform: translateY(-2px);
        }

        .history-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 350px;
            height: 100%;
            background: linear-gradient(180deg, #0a0f0a 0%, #050805 100%);
            border-left: 2px solid var(--neon);
            z-index: 2000;
            transition: right 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex;
            flex-direction: column;
            box-shadow: -10px 0 40px rgba(0,0,0,0.5);
        }
        
        .history-panel.open {
            right: 0;
        }
        
        .history-header {
            padding: 20px;
            border-bottom: 1px solid var(--neon-dim);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-title {
            color: var(--neon);
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: textGlow 2s ease-in-out infinite;
        }
        
        .history-close {
            background: none;
            border: none;
            color: var(--neon);
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .history-close:hover {
            background: rgba(0,255,136,0.1);
            transform: rotate(90deg);
        }
        
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .history-item {
            background: rgba(0,255,136,0.05);
            border: 1px solid var(--neon-dim);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
            animation: itemAppear 0.4s ease-out;
        }
        
        @keyframes itemAppear {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .history-item:hover {
            background: rgba(0,255,136,0.12);
            border-color: var(--neon);
            transform: translateX(-8px) scale(1.02);
            box-shadow: 0 4px 15px rgba(0,255,136,0.2);
        }
        
        .history-item-text {
            font-size: 13px;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 6px;
        }
        
        .history-item-date {
            font-size: 11px;
            color: rgba(255,255,255,0.5);
        }
        
        .history-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .history-overlay.show {
            display: block;
            opacity: 1;
        }
        
        .clear-history-btn {
            margin: 16px;
            padding: 14px;
            background: rgba(255,68,68,0.1);
            border: 1px solid rgba(255,68,68,0.3);
            color: #ff8888;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .clear-history-btn:hover {
            background: rgba(255,68,68,0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255,68,68,0.3);
        }

        ::selection {
            background: rgba(0, 255, 136, 0.3);
            color: #fff;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>

<div class="history-overlay" id="historyOverlay" onclick="closeHistory()"></div>

<div class="history-panel" id="historyPanel">
    <div class="history-header">
        <div class="history-title">üìú –ò–°–¢–û–†–ò–Ø</div>
        <button class="history-close" onclick="closeHistory()">√ó</button>
    </div>
    <div class="history-list" id="historyList"></div>
    <button class="clear-history-btn" onclick="clearHistory()">–û–ß–ò–°–¢–ò–¢–¨ –ò–°–¢–û–†–ò–Æ</button>
</div>

<div class="photo-menu-overlay" id="photoMenu" onclick="closePhotoMenu(event)">
    <div class="photo-menu">
        <div class="photo-menu-title">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫</div>
        <button class="photo-menu-btn" onclick="selectCamera()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
            –ö–∞–º–µ—Ä–∞
        </button>
        <button class="photo-menu-btn" onclick="selectGallery()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
            –ì–∞–ª–µ—Ä–µ—è
        </button>
        <button class="photo-menu-close" onclick="closePhotoMenu()">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<button class="scroll-down-btn" id="scrollDownBtn" onclick="scrollToBottom()">
    <svg viewBox="0 0 24 24"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
</button>

<input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none" onchange="handleImage(this)">
<input type="file" id="galleryInput" accept="image/*" style="display:none" onchange="handleImage(this)">

<div class="app">
    <div class="header">
        <b>‚ö°Ô∏è NEON VISION PRO</b>
        <div style="display:flex;gap:10px;align-items:center;">
            <button class="tool-btn" onclick="openHistory()" style="width:36px;height:36px;" title="–ò—Å—Ç–æ—Ä–∏—è">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a10 10 0 1 0 10 10H12V2z"></path><path d="M12 2a10 10 0 0 1 10 10"></path><path d="M12 12L2.5 8.5"></path></svg>
            </button>
            <div class="energy" id="energy">–ó–ê–ì–†–£–ó–ö–ê...</div>
        </div>
    </div>
    <div id="chat">
        <div class="msg ai">–°–∏—Å—Ç–µ–º–∞ VISION –æ–Ω–ª–∞–π–Ω. üëÅÔ∏è<br><br>–Ø –≤–∏–∂—É –≤—Å—ë: –∫–æ–¥, –ø—Ä–∏–º–µ—Ä—ã, —Å—Ö–µ–º—ã. –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏ —Ñ–æ—Ç–æ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ –∑–∞–¥–∞—á—É!<br><br>üí° <b>–°–æ–≤–µ—Ç:</b> –ü—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–æ—Ç–æ –∏ –Ω–∞–ø–∏—à–∏ –∫ –Ω–µ–º—É —Ç–µ–∫—Å—Ç ‚Äî —è –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –≤—Å—ë –≤–º–µ—Å—Ç–µ.</div>
    </div>
    <div class="footer">
        <div id="photoPreview" class="photo-preview" style="display:none;">
            <button class="remove-photo" onclick="removePhoto()">√ó</button>
            <img id="previewImg" src="" alt="Preview">
        </div>
        
        <div class="input-area">
            <button class="tool-btn" onclick="openPhotoMenu()" type="button" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–æ—Ç–æ">
                <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" fill="none" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
            </button>
            
            <button class="tool-btn" onclick="showRef()" type="button" title="–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞">
                <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
            </button>
            
            <textarea id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1" oninput="autoResize(this)" onkeydown="handleKey(event)"></textarea>
            
            <button class="send-btn" id="sendBtn" onclick="handleSend()" type="button" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                <svg viewBox="0 0 24 24"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"></path></svg>
            </button>
        </div>
    </div>
</div>

<script>
    const ADMIN_ID = 8371345434;
    let energy = localStorage.getItem('energy') ? parseInt(localStorage.getItem('energy')) : 8;
    let currentImageData = null;
    let editingMsgId = null;
    let isCreator = false;
    let currentUserId = null;
    
    let messageHistory = JSON.parse(localStorage.getItem('vision_history') || '[]');
    const MAX_HISTORY = 20;
    
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    function init() {
        currentUserId = tg.initDataUnsafe?.user?.id || tg.initDataUnsafe?.user_id;
        if (!currentUserId) {
            currentUserId = parseInt(localStorage.getItem('test_user_id')) || null;
        }
        
        isCreator = (currentUserId === ADMIN_ID);
        
        if (isCreator) { 
            energy = 9999; 
            document.getElementById('energy').innerText = "CREATOR";
            document.getElementById('energy').classList.add('creator');
        } else { 
            updateUI(); 
        }
        
        renderHistory();
    }

    setTimeout(init, 100);

    function updateUI() { 
        const el = document.getElementById('energy');
        if (isCreator) {
            el.innerText = "CREATOR";
            el.classList.add('creator');
        } else {
            el.innerText = `‚ö° ${energy}`;
        }
        localStorage.setItem('energy', energy); 
    }

    // –ò–°–¢–û–†–ò–Ø
    function openHistory() {
        document.getElementById('historyPanel').classList.add('open');
        document.getElementById('historyOverlay').classList.add('show');
        renderHistory();
    }

    function closeHistory() {
        document.getElementById('historyPanel').classList.remove('open');
        document.getElementById('historyOverlay').classList.remove('show');
    }

    function renderHistory() {
        const list = document.getElementById('historyList');
        if (messageHistory.length === 0) {
            list.innerHTML = '<div style="text-align:center;padding:40px 20px;color:rgba(255,255,255,0.4);font-size:13px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞<br><br>–í–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</div>';
            return;
        }
        
        list.innerHTML = messageHistory.slice().reverse().map((item, idx) => `
            <div class="history-item" onclick="loadFromHistory(${messageHistory.length - 1 - idx})">
                <div class="history-item-text">${escapeHtml(item.text || '(–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)')}</div>
                <div class="history-item-date">${new Date(item.time).toLocaleString('ru-RU')}</div>
            </div>
        `).join('');
    }

    function loadFromHistory(index) {
        const item = messageHistory[index];
        if (item) {
            document.getElementById('userInput').value = item.text || '';
            autoResize(document.getElementById('userInput'));
            document.getElementById('userInput').focus();
        }
        closeHistory();
    }

    function addToHistory(text, isUser = true) {
        messageHistory.push({
            text: text,
            isUser: isUser,
            time: Date.now()
        });
        
        if (messageHistory.length > MAX_HISTORY) {
            messageHistory = messageHistory.slice(-MAX_HISTORY);
        }
        
        localStorage.setItem('vision_history', JSON.stringify(messageHistory));
    }

    function clearHistory() {
        if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é?')) {
            messageHistory = [];
            localStorage.removeItem('vision_history');
            renderHistory();
        }
    }

    // –ü–´–õ–¨
    const c = document.getElementById('canvas'), x = c.getContext('2d');
    let ps = [];
    function rs() { c.width = innerWidth; c.height = innerHeight; }
    window.onresize = rs; rs();
    
    class Dust { 
        constructor() { this.init(); } 
        init() { 
            this.x = Math.random() * c.width; 
            this.y = Math.random() * -c.height; 
            this.size = Math.random() * 1.5; 
            this.speed = Math.random() * 1.5 + 0.5; 
            this.opacity = Math.random() * 0.6; 
        } 
        update() { 
            this.y += this.speed; 
            if (this.y > c.height) this.init(); 
        } 
        draw() { 
            x.fillStyle = `rgba(0, 255, 136, ${this.opacity})`; 
            x.beginPath(); 
            x.arc(this.x, this.y, this.size, 0, 7); 
            x.fill(); 
        } 
    }
    
    for(let i=0; i<60; i++) ps.push(new Dust());
    
    function loop() { 
        x.clearRect(0,0,c.width,c.height); 
        ps.forEach(p=>{p.update();p.draw();}); 
        requestAnimationFrame(loop); 
    }
    loop();

    // Photo Menu
    function openPhotoMenu() {
        document.getElementById('photoMenu').style.display = 'flex';
    }

    function closePhotoMenu(e) {
        if (!e || e.target === document.getElementById('photoMenu')) {
            document.getElementById('photoMenu').style.display = 'none';
        }
    }

    function selectCamera() {
        closePhotoMenu();
        document.getElementById('cameraInput').click();
    }

    function selectGallery() {
        closePhotoMenu();
        document.getElementById('galleryInput').click();
    }

    // Scroll
    const chat = document.getElementById('chat');
    const scrollDownBtn = document.getElementById('scrollDownBtn');
    
    chat.addEventListener('scroll', () => {
        const isNearBottom = chat.scrollHeight - chat.scrollTop - chat.clientHeight < 150;
        scrollDownBtn.classList.toggle('visible', !isNearBottom);
    });

    function scrollToBottom() {
        chat.scrollTop = chat.scrollHeight;
    }

    function checkScroll() {
        const isNearBottom = chat.scrollHeight - chat.scrollTop - chat.clientHeight < 150;
        if (!isNearBottom) scrollDownBtn.classList.add('visible');
    }

    // Image
    function handleImage(input) {
        const file = input.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
            currentImageData = e.target.result;
            document.getElementById('previewImg').src = currentImageData;
            document.getElementById('photoPreview').style.display = 'block';
            document.getElementById('userInput').focus();
        };
        reader.readAsDataURL(file);
        input.value = '';
    }

    function removePhoto() {
        currentImageData = null;
        document.getElementById('photoPreview').style.display = 'none';
        document.getElementById('previewImg').src = '';
    }

    function autoResize(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
    }

    function handleKey(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSend();
        }
    }

    function showRef() {
        const userId = currentUserId || 'guest';
        const refLink = `https://t.me/NeonVisionBot?start=${userId}`;
        
        const div = document.createElement('div');
        div.className = 'msg ai';
        div.style.cssText = 'border:1px dashed var(--neon); background:rgba(0,255,136,0.03);';
        div.innerHTML = `
            <div style="font-size:13px;opacity:0.8;margin-bottom:8px;">üîó –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê</div>
            <div style="font-size:15px;font-weight:600;margin-bottom:12px;color:var(--neon);">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –∑–∞—Ä—è–¥—ã</div>
            <div style="background:rgba(0,0,0,0.3);padding:12px;border-radius:8px;margin-bottom:12px;font-family:'JetBrains Mono',monospace;font-size:12px;word-break:break-all;color:#aaa;">${refLink}</div>
            <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;font-size:13px;">
                <span style="color:var(--neon);font-weight:700;">1 –¥—Ä—É–≥</span>
                <span style="opacity:0.5;">=</span>
                <span style="color:var(--neon);font-weight:700;">+3 –∑–∞—Ä—è–¥–∞</span>
            </div>
            <button onclick="copyText('${refLink}')" style="width:100%;background:linear-gradient(135deg,var(--neon) 0%,#00cc6a 100%);color:#000;border:none;padding:10px;border-radius:8px;font-weight:700;cursor:pointer;">–ö–û–ü–ò–†–û–í–ê–¢–¨ –°–°–´–õ–ö–£</button>
        `;
        chat.appendChild(div);
        checkScroll();
    }

    function copyText(text) {
        navigator.clipboard.writeText(text).then(() => {
            if (tg.showPopup) {
                tg.showPopup({title: '‚úÖ –ì–æ—Ç–æ–≤–æ', message: '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞. –û—Ç–ø—Ä–∞–≤—å –µ—ë –¥—Ä—É–∑—å—è–º!'});
            } else {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            }
        });
    }

    function generateId() {
        return 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function editMessage(msgId) {
        const msgEl = document.getElementById(msgId);
        if (!msgEl) return;
        
        const text = msgEl.getAttribute('data-text');
        const imgData = msgEl.getAttribute('data-img');
        
        document.getElementById('userInput').value = text;
        if (imgData) {
            currentImageData = imgData;
            document.getElementById('previewImg').src = imgData;
            document.getElementById('photoPreview').style.display = 'block';
        }
        
        editingMsgId = msgId;
        msgEl.classList.add('editing');
        document.getElementById('userInput').focus();
        autoResize(document.getElementById('userInput'));
    }

    function deleteMessage(msgId) {
        const msgEl = document.getElementById(msgId);
        if (msgEl) {
            msgEl.style.opacity = '0';
            setTimeout(() => {
                msgEl.remove();
                if (editingMsgId === msgId) cancelEdit();
            }, 300);
        }
    }

    function cancelEdit() {
        if (editingMsgId) {
            const el = document.getElementById(editingMsgId);
            if (el) el.classList.remove('editing');
            editingMsgId = null;
        }
        document.getElementById('userInput').value = '';
        removePhoto();
    }

    function showRefBanner() {
        const needed = Math.max(1, Math.ceil((3 - energy) / 3));
        
        const div = document.createElement('div');
        div.className = 'msg system';
        div.innerHTML = `
            <div style="padding:4px;">
                <div style="font-size:18px;margin-bottom:12px;">‚ö°Ô∏è –ó–ê–ö–û–ù–ß–ò–õ–ò–°–¨ –ó–ê–†–Ø–î–´</div>
                <div style="opacity:0.9;margin-bottom:16px;line-height:1.6;">
                    –£ —Ç–µ–±—è <b style="color:var(--neon);">${energy}</b> –∑–∞—Ä—è–¥–æ–≤<br>
                    –ü—Ä–∏–≥–ª–∞—Å–∏ <b style="color:var(--neon);">${needed} ${needed === 1 ? '–¥—Ä—É–≥–∞' : '–¥—Ä—É–∑–µ–π'}</b> –∏ –ø–æ–ª—É—á–∏ <b style="color:var(--neon);">+${needed * 3}</b> –∑–∞—Ä—è–¥–æ–≤
                </div>
                <button onclick="showRef()" style="background:var(--neon);color:#000;border:none;padding:12px 24px;border-radius:20px;font-weight:700;cursor:pointer;width:100%;">–ü–û–õ–£–ß–ò–¢–¨ –ó–ê–†–Ø–î–´</button>
            </div>
        `;
        chat.appendChild(div);
        checkScroll();
    }

    function isCodeResponse(text) {
        const codeIndicators = [
            '```', 'function', 'const ', 'let ', 'var ', 'class ', 'import ', 'export ',
            'def ', 'print(', '<html', '<div', '<!DOCTYPE', '#include', 'using namespace',
            'public static', 'func ', 'package ', 'module ', 'require(', 'console.log',
            'System.out', '<?php', '<%', '#!/bin/'
        ];
        return codeIndicators.some(ind => text.includes(ind));
    }

    // –û–ß–ò–°–¢–ö–ê –û–¢–í–ï–¢–ê –û–¢ JSON –ú–£–°–û–†–ê
    function cleanAIResponse(text) {
        // –£–±–∏—Ä–∞–µ–º JSON-–æ–±—ä–µ–∫—Ç—ã —Å reasoning_content –∏ tool_calls
        text = text.replace(/\{"role":"assistant","reasoning_content":".*?","tool_calls":\[\]\}/g, '');
        text = text.replace(/\{"role":"assistant","reasoning_content":".*?"\}/g, '');
        
        // –£–±–∏—Ä–∞–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è JSON –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
        text = text.replace(/\{[^{}]*"role"[^{}]*\}/g, '');
        
        // –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
        text = text.trim();
        
        return text;
    }

    async function handleSend() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        const sendBtn = document.getElementById('sendBtn');
        
        if (!text && !currentImageData) return;
        
        if (!isCreator && energy <= 0) { 
            showRefBanner();
            return; 
        }

        if (editingMsgId) {
            const oldMsg = document.getElementById(editingMsgId);
            if (oldMsg) oldMsg.remove();
            editingMsgId = null;
        }

        const msgId = generateId();
        const userDiv = document.createElement('div');
        userDiv.className = 'msg user';
        userDiv.id = msgId;
        userDiv.setAttribute('data-text', text);
        if (currentImageData) userDiv.setAttribute('data-img', currentImageData);
        
        let content = '';
        if (text) content += escapeHtml(text).replace(/\n/g, '<br>');
        if (currentImageData) {
            content += (text ? '<br>' : '') + `<img src="${currentImageData}" class="preview-img">`;
        }
        
        userDiv.innerHTML = content + `
            <div class="msg-actions">
                <button class="edit-btn" onclick="editMessage('${msgId}')">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                <button class="delete-btn" onclick="deleteMessage('${msgId}')">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        `;
        
        chat.appendChild(userDiv);
        addToHistory(text || '(–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)', true);
        
        input.value = '';
        input.style.height = '42px';
        
        const imgToSend = currentImageData;
        removePhoto();
        checkScroll();
        
        if (!isCreator) {
            energy--;
            updateUI();
        }

        const load = document.createElement('div');
        load.className = 'msg ai';
        load.innerHTML = '<span style="display:flex;align-items:center;gap:8px;"><span style="animation:pulse 1.5s infinite;">üëÅÔ∏è</span> –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...</span>';
        chat.appendChild(load);
        checkScroll();
        
        sendBtn.disabled = true;

        try {
            const historyContext = messageHistory.slice(-6).map(h => ({
                role: h.isUser ? 'user' : 'assistant',
                content: h.text
            }));

            let promptText = text || "–û–ø–∏—à–∏ —á—Ç–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏";
            if (imgToSend) {
                promptText = `[–§–û–¢–û –û–¢–ü–†–ê–í–õ–ï–ù–û] ${promptText}`;
            }

            const messages = [
                { role: "system", content: "–¢—ã NEON VISION PRO ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –∫–æ–¥—É. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –§–æ—Ä–º–∞—Ç–∏—Ä—É–π –∫–æ–¥ –≤ –±–ª–æ–∫–∏ —Å ```. –ü–æ–º–Ω–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä–∞. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π JSON —Ñ–æ—Ä–º–∞—Ç, –æ—Ç–≤–µ—á–∞–π –æ–±—ã—á–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º." },
                ...historyContext,
                { role: "user", content: promptText }
            ];

            const payload = {
                messages: messages,
                model: "openai",
                seed: Math.floor(Math.random() * 1000)
            };

            const response = await fetch("https://text.pollinations.ai", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            let resText = await response.text();
            
            // –û–ß–ò–©–ê–ï–ú –û–¢–í–ï–¢ –û–¢ –ú–£–°–û–†–ê
            resText = cleanAIResponse(resText);
            
            load.remove();

            const hasCode = isCodeResponse(resText);
            const fullResponseText = resText;

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ markdown —Ç–∞–±–ª–∏—Ü
            let formatted = resText
                .replace(/\|(.+)\|/g, (match) => {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º markdown —Ç–∞–±–ª–∏—Ü—É –≤ HTML
                    const rows = match.trim().split('\n');
                    if (rows.length < 2) return match;
                    
                    let html = '<table>';
                    rows.forEach((row, idx) => {
                        const cells = row.split('|').filter(c => c.trim());
                        if (cells.length === 0) return;
                        
                        const tag = idx === 0 ? 'th' : 'td';
                        html += '<tr>' + cells.map(c => `<${tag}>${c.trim()}</${tag}>`).join('') + '</tr>';
                    });
                    html += '</table>';
                    return html;
                })
                .replace(/```(\w+)?([\s\S]*?)```/g, (m, l, code) => {
                    const lang = l || 'text';
                    if (hasCode) {
                        return `<pre><div class="code-buttons"><button class="copy-full-btn" onclick="copyFullResponse(this)">–ö–û–ü–ò–†–û–í–ê–¢–¨ –í–°–Å</button><button class="copy-btn" onclick="copyCode(this)">–ö–û–ü–ò–†–û–í–ê–¢–¨ –ë–õ–û–ö</button></div><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>`;
                    }
                    return `<pre><div class="code-buttons"><button class="copy-btn" onclick="copyCode(this)">–ö–û–ü–ò–†–û–í–ê–¢–¨</button></div><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>`;
                })
                .replace(/`([^`]+)`/g, '<code style="background:rgba(0,255,136,0.1);padding:2px 6px;border-radius:4px;color:var(--neon);font-family:\'JetBrains Mono\',monospace;font-size:12px;">$1</code>')
                .replace(/\*\*(.*?)\*\*/g, '<b style="color:var(--neon);">$1</b>')
                .replace(/\n/g, '<br>');

            const aiDiv = document.createElement('div');
            aiDiv.className = 'msg ai';
            aiDiv.innerHTML = formatted;
            
            if (hasCode) {
                aiDiv.setAttribute('data-full-text', fullResponseText);
            }
            
            chat.appendChild(aiDiv);
            addToHistory(fullResponseText, false);
            
            if (window.Prism) Prism.highlightAll();
            checkScroll();

        } catch (e) { 
            console.error(e);
            load.innerHTML = "‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è<br><small style='opacity:0.7'>" + escapeHtml(e.message) + "</small>"; 
        } finally {
            sendBtn.disabled = false;
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function copyCode(btn) {
        const code = btn.closest('.code-buttons').nextElementSibling.innerText;
        navigator.clipboard.writeText(code).then(() => { 
            btn.innerText = "‚úì –°–ö–û–ü–ò–†–û–í–ê–ù–û"; 
            btn.style.background = "var(--neon)";
            btn.style.color = "#000";
            setTimeout(() => {
                btn.innerText = "–ö–û–ü–ò–†–û–í–ê–¢–¨ –ë–õ–û–ö";
                btn.style.background = "";
                btn.style.color = "";
            }, 2000); 
        });
    }

    function copyFullResponse(btn) {
        const msgEl = btn.closest('.msg');
        const fullText = msgEl.getAttribute('data-full-text');
        if (fullText) {
            navigator.clipboard.writeText(fullText).then(() => {
                btn.innerText = "‚úì –í–°–Å –°–ö–û–ü–ò–†–û–í–ê–ù–û";
                setTimeout(() => {
                    btn.innerText = "–ö–û–ü–ò–†–û–í–ê–¢–¨ –í–°–Å";
                }, 2000);
            });
        }
    }
</script>
</body>
</html>
