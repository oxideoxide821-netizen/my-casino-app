<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ultimate Frontier Farm</title>
    <style>
        :root {
            --neon: #00ff88; --gold: #ffcc00; --wood: #5d4037; --grass: #3e7b36;
            --ui-bg: rgba(10, 20, 10, 0.85);
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #2d5a27; font-family: 'Segoe UI', Tahoma, sans-serif;
            user-select: none; touch-action: none;
        }

        /* –ö–ê–ù–í–ê–° –î–í–ò–ñ–û–ö */
        #gameCanvas { width: 100%; height: 100%; display: block; image-rendering: pixelated; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° (GUI) */
        .overlay {
            position: fixed; pointer-events: none; width: 100%; height: 100%;
            display: flex; flex-direction: column; z-index: 100;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            padding: 20px; display: flex; justify-content: space-between; align-items: flex-start;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            pointer-events: auto;
        }

        .stat-group {
            background: var(--ui-bg); backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 20px; border: 2px solid var(--neon);
            box-shadow: 0 0 20px rgba(0,255,136,0.2); color: white;
        }

        .balance-text { font-size: 32px; font-weight: 900; color: var(--gold); display: flex; align-items: center; gap: 10px; }

        /* –°–∏—Å—Ç–µ–º–∞ –£—Ä–æ–≤–Ω–µ–π */
        .lvl-container { width: 200px; margin-top: 10px; }
        .lvl-bar { width: 100%; height: 6px; background: #222; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        #lvl-fill { width: 30%; height: 100%; background: var(--neon); box-shadow: 0 0 10px var(--neon); transition: 0.4s; }

        /* –ú–ê–ì–ê–ó–ò–ù –ò –°–¢–†–û–ô–ö–ê */
        .bottom-nav {
            margin-top: auto; padding: 20px; display: flex; gap: 15px;
            overflow-x: auto; scrollbar-width: none; pointer-events: auto;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        }
        .bottom-nav::-webkit-scrollbar { display: none; }

        .build-card {
            min-width: 130px; height: 100px; background: var(--ui-bg);
            border: 2px solid rgba(255,255,255,0.1); border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; transition: 0.3s; position: relative;
        }
        .build-card:active { transform: scale(0.9); border-color: var(--neon); }
        .build-card img { width: 40px; margin-bottom: 5px; filter: drop-shadow(0 4px 4px black); }
        .build-card .cost { font-size: 14px; font-weight: bold; color: var(--gold); }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ú–∞–≥–∞–∑–∏–Ω–∞ */
        #shop-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            width: 90%; max-width: 400px; background: #1a1a1a; border: 3px solid var(--gold);
            border-radius: 30px; padding: 30px; color: white; z-index: 1000;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); pointer-events: auto;
        }
        #shop-modal.active { transform: translate(-50%, -50%) scale(1); }

        .shop-item {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
        }

        /* –ù–æ—á–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä */
        #night-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; opacity: 0; pointer-events: none; z-index: 50;
            mix-blend-mode: multiply; transition: 5s linear;
        }
    </style>
</head>
<body>

    <div id="night-overlay"></div>

    <div class="overlay">
        <div class="top-bar">
            <div class="stat-group">
                <div class="balance-text">üí∞ <span id="balance">0</span></div>
                <div class="lvl-container">
                    <div style="display:flex; justify-content:space-between; font-size:12px;">
                        <span>–£–†–û–í–ï–ù–¨ <b id="lvl-num">1</b></span>
                        <span id="xp-text">0/100</span>
                    </div>
                    <div class="lvl-bar"><div id="lvl-fill"></div></div>
                </div>
            </div>
            <div class="stat-group" onclick="toggleShop(true)" style="cursor:pointer; border-color:var(--gold);">
                üèõ –ú–ê–†–ö–ï–¢
            </div>
        </div>

        <div class="bottom-nav" id="build-menu">
            <!-- –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π -->
    <div id="shop-modal">
        <h2 style="text-align:center; color:var(--gold); margin-top:0;">–ö–£–ó–ù–ò–¶–ê –£–õ–£–ß–®–ï–ù–ò–ô</h2>
        <div id="upgrades-list"></div>
        <button onclick="toggleShop(false)" style="width:100%; background:none; border:1px solid #444; color:#888; padding:12px; border-radius:15px; margin-top:10px;">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
/**
 * –§–ï–†–ú–ï–†–°–ö–ò–ô –î–í–ò–ñ–û–ö v2.0
 * –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —á–∏—Å—Ç–æ–º JavaScript Canvas
 */

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const balanceEl = document.getElementById('balance');

// –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
const Game = {
    money: parseInt(localStorage.getItem('farm_money')) || 100,
    xp: parseInt(localStorage.getItem('farm_xp')) || 0,
    lvl: parseInt(localStorage.getItem('farm_lvl')) || 1,
    clickPower: parseInt(localStorage.getItem('farm_power')) || 10,
    lastUpdate: Date.now(),
    entities: [],
    buildings: [],
    particles: [],
    dayTime: 0, // 0 - 24000
    images: {}
};

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö
const AnimalSpecs = {
    'Bull': { speed: 0.5, income: 5, sprite: '1.gif' },
    'calf': { speed: 0.7, income: 3, sprite: '2.gif' },
    'chick': { speed: 1.2, income: 1, sprite: '3.gif' },
    'lamb': { speed: 0.6, income: 4, sprite: '4.gif' },
    'piglet': { speed: 0.8, income: 4, sprite: '5.gif' },
    'rooster': { speed: 1.5, income: 2, sprite: '6.gif' },
    'sheep': { speed: 0.4, income: 6, sprite: '7.gif' },
    'turkey': { speed: 1.0, income: 3, sprite: '8.gif' }
};

const upgradeTypes = [
    { id: 'power', name: '–ó–æ–ª–æ—Ç—ã–µ –¢–∞–ø–∫–∏', desc: '–£–¥–≤–∞–∏–≤–∞–µ—Ç —Å–∏–ª—É –∫–ª–∏–∫–∞', cost: 500 },
    { id: 'luck', name: '–ö–ª–µ–≤–µ—Ä –£–¥–∞—á–∏', desc: '–®–∞–Ω—Å –∫—Ä–∏—Ç-–¥–æ—Ö–æ–¥–∞', cost: 1000 },
    { id: 'speed', name: '–¢—É—Ä–±–æ-–∫–æ—Ä–º', desc: '–ñ–∏–≤–æ—Ç–Ω—ã–µ —Ö–æ–¥—è—Ç –±—ã—Å—Ç—Ä–µ–µ', cost: 2000 }
];

/**
 * –ö–õ–ê–°–° –ñ–ò–í–û–¢–ù–û–ì–û (AI)
 */
class Animal {
    constructor(type, x, y) {
        this.type = type;
        this.x = x || Math.random() * canvas.width;
        this.y = y || Math.random() * canvas.height;
        this.targetX = this.x;
        this.targetY = this.y;
        this.spec = AnimalSpecs[type];
        this.frame = 0;
        this.flip = false;
        this.state = 'idle'; // idle, walk, eat
        this.timer = 0;
    }

    update() {
        this.timer--;
        
        if (this.state === 'idle' && this.timer <= 0) {
            this.state = 'walk';
            this.targetX = Math.max(50, Math.min(canvas.width - 50, this.x + (Math.random() - 0.5) * 400));
            this.targetY = Math.max(100, Math.min(canvas.height - 150, this.y + (Math.random() - 0.5) * 300));
        }

        if (this.state === 'walk') {
            const dx = this.targetX - this.x;
            const dy = this.targetY - this.y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist > 5) {
                this.x += (dx / dist) * this.spec.speed;
                this.y += (dy / dist) * this.spec.speed;
                this.flip = dx < 0;
                this.frame = (this.frame + 0.1) % 6; // –ê–Ω–∏–º–∞—Ü–∏—è 6 –∫–∞–¥—Ä–æ–≤
            } else {
                this.state = 'idle';
                this.timer = Math.random() * 200 + 100;
            }
        }
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        
        // –†–∏—Å—É–µ–º –¢–µ–Ω—å
        ctx.fillStyle = 'rgba(0,0,0,0.2)';
        ctx.beginPath();
        ctx.ellipse(0, 5, 20, 8, 0, 0, Math.PI * 2);
        ctx.fill();

        if (this.flip) ctx.scale(-1, 1);

        // –†–∏—Å—É–µ–º –°–ø—Ä–∞–π—Ç (–û–∫–æ—à–∫–æ)
        const img = Game.images[this.type];
        if (img) {
            const sWidth = img.width / 6; // 6 –∫–∞–¥—Ä–æ–≤ –≤ —Ä—è–¥
            const sHeight = img.height / 8; // –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º 8 —Ä—è–¥–æ–≤
            ctx.drawImage(
                img,
                Math.floor(this.frame) * sWidth, 0, sWidth, sHeight,
                -25, -45, 50, 50
            );
        } else {
            // –ó–∞–≥–ª—É—à–∫–∞ –µ—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
            ctx.fillStyle = 'white';
            ctx.fillRect(-10, -30, 20, 30);
        }
        
        ctx.restore();
    }
}

/**
 * –°–ò–°–¢–ï–ú–ê –≠–§–§–ï–ö–¢–û–í (Particles)
 */
class Particle {
    constructor(x, y, text, color) {
        this.x = x; this.y = y; this.text = text; this.color = color;
        this.life = 1.0; this.vy = -2;
    }
    update() { this.y += this.vy; this.life -= 0.02; }
    draw() {
        ctx.globalAlpha = this.life;
        ctx.fillStyle = this.color;
        ctx.font = 'bold 24px Segoe UI';
        ctx.fillText(this.text, this.x, this.y);
        ctx.globalAlpha = 1.0;
    }
}

/**
 * –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
 */
function init() {
    window.addEventListener('resize', resize);
    resize();

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
    Object.keys(AnimalSpecs).forEach((key, index) => {
        const img = new Image();
        img.src = `${index + 1}.gif`;
        img.onload = () => Game.images[key] = img;
    });

    // –°–æ–∑–¥–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–µ–Ω—é –ø–æ—Å—Ç—Ä–æ–µ–∫
    const menu = document.getElementById('build-menu');
    Object.keys(AnimalSpecs).forEach(key => {
        const card = document.createElement('div');
        card.className = 'build-card';
        card.innerHTML = `
            <span>üêæ</span>
            <div style="font-weight:bold">${key}</div>
            <div class="cost">${AnimalSpecs[key].income * 50} üí∞</div>
        `;
        card.onclick = () => spawnAnimal(key);
        menu.appendChild(card);
    });

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∂–∏–≤–æ—Ç–Ω—ã—Ö
    const savedCount = parseInt(localStorage.getItem('animal_count')) || 1;
    for(let i=0; i<savedCount; i++) {
        const keys = Object.keys(AnimalSpecs);
        Game.entities.push(new Animal(keys[i % keys.length]));
    }

    renderUpgrades();
    loop();
}

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

/**
 * –ò–ì–†–û–í–û–ô –¶–ò–ö–õ (60 FPS)
 */
function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 1. –†–∏—Å—É–µ–º —Ñ–æ–Ω (–¢—Ä–∞–≤—É)
    drawBackground();

    // 2. –û–±–Ω–æ–≤–ª—è–µ–º –∏ —Ä–∏—Å—É–µ–º –∂–∏–≤–æ—Ç–Ω—ã—Ö
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ Y –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞–ª–æ–∂–µ–Ω–∏—è (Z-index)
    Game.entities.sort((a, b) => a.y - b.y);
    Game.entities.forEach(entity => {
        entity.update();
        entity.draw();
    });

    // 3. –ß–∞—Å—Ç–∏—Ü—ã
    Game.particles = Game.particles.filter(p => p.life > 0);
    Game.particles.forEach(p => { p.update(); p.draw(); });

    // 4. –õ–æ–≥–∏–∫–∞ —ç–∫–æ–Ω–æ–º–∏–∫–∏
    processEconomy();

    // 5. –î–µ–Ω—å/–ù–æ—á—å
    updateDayNight();

    requestAnimationFrame(loop);
}

function drawBackground() {
    // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É —Ç—Ä–∞–≤—ã
    const size = 60;
    ctx.strokeStyle = 'rgba(255,255,255,0.03)';
    for(let x=0; x<canvas.width; x+=size) {
        for(let y=0; y<canvas.height; y+=size) {
            ctx.strokeRect(x, y, size, size);
        }
    }
}

function processEconomy() {
    const now = Date.now();
    if (now - Game.lastUpdate > 1000) {
        let income = 0;
        Game.entities.forEach(e => income += e.spec.income);
        Game.money += income;
        addXP(income / 10);
        Game.lastUpdate = now;
        updateUI();
    }
}

function updateDayNight() {
    Game.dayTime = (Game.dayTime + 1) % 24000;
    const overlay = document.getElementById('night-overlay');
    // –ü–∏–∫ –Ω–æ—á–∏ –Ω–∞ 12000
    const intensity = Math.max(0, Math.sin(Game.dayTime * Math.PI / 12000) * 0.4);
    overlay.style.opacity = intensity;
}

/**
 * –î–ï–ô–°–¢–í–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
 */
canvas.addEventListener('pointerdown', (e) => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∂–∏–≤–æ—Ç–Ω–æ–º—É
    let hit = false;
    Game.entities.forEach(entity => {
        const d = Math.sqrt((e.clientX - entity.x)**2 + (e.clientY - entity.y)**2);
        if (d = cost) {
        Game.money -= cost;
        Game.entities.push(new Animal(type));
        localStorage.setItem('animal_count', Game.entities.length);
        updateUI();
    }
}

function addXP(amount) {
    Game.xp += amount;
    const target = Game.lvl * 100;
    if (Game.xp >= target) {
        Game.xp = 0;
        Game.lvl++;
        Game.particles.push(new Particle(canvas.width/2, canvas.height/2, 'LEVEL UP!', '#00ff88'));
    }
}

function updateUI() {
    balanceEl.innerText = Math.floor(Game.money);
    document.getElementById('lvl-num').innerText = Game.lvl;
    document.getElementById('xp-text').innerText = `${Math.floor(Game.xp)}/${Game.lvl * 100}`;
    document.getElementById('lvl-fill').style.width = (Game.xp / (Game.lvl * 100)) * 100 + '%';
    
    localStorage.setItem('farm_money', Game.money);
    localStorage.setItem('farm_lvl', Game.lvl);
    localStorage.setItem('farm_xp', Game.xp);
}

function toggleShop(open) {
    document.getElementById('shop-modal').className = open ? 'active' : '';
}

function renderUpgrades() {
    const list = document.getElementById('upgrades-list');
    upgradeTypes.forEach(upg => {
        const item = document.createElement('div');
        item.className = 'shop-item';
        item.innerHTML = `
            <div><b>${upg.name}</b><br><small>${upg.desc}</small></div>
            <button onclick="buyUpgrade('${upg.id}', ${upg.cost})" style="background:var(--gold); border:none; padding:8px 12px; border-radius:8px; font-weight:bold;">${upg.cost}</button>
        `;
        list.appendChild(item);
    });
}

function buyUpgrade(id, cost) {
    if (Game.money >= cost) {
        Game.money -= cost;
        if (id === 'power') Game.clickPower *= 2;
        updateUI();
        alert('–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!');
    }
}

// –ü–æ–µ—Ö–∞–ª–∏!
init();

</script>
</body>
</html>
