<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>ELITE DEB CASINO</title>
  <style>
    :root {
      --gold: #f3ba2f;
      --bg: #050608;
      --card: #101219;
      --accent: #00f2ff;
      --red: #ff4757;
      --text-soft: #a9b3c1;
      --common: #9ca3af;
      --rare: #3b82f6;
      --epic: #a855f7;
      --legend: #f59e0b;
      --myth: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #151827 0, #050608 55%);
      color: #fff;
      height: 100vh;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    .header {
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(10px);
      background: linear-gradient(to right, rgba(10,12,20,.95), rgba(10,12,20,.8));
      border-bottom: 1px solid rgba(255,255,255,0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .brand {
      font-weight: 800;
      letter-spacing: .08em;
      font-size: 11px;
      text-transform: uppercase;
      color: var(--text-soft);
    }
    .brand span { color: var(--accent); }
    .bal-box {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      font-size: 11px;
    }
    .bal-main {
      font-size: 18px;
      font-weight: 900;
      color: var(--gold);
      text-shadow: 0 0 8px rgba(243,186,47,.4);
    }
    .bal-sub { color: var(--text-soft); font-size: 10px; }

    .page {
      height: calc(100vh - 80px);
      padding: 14px 14px 100px;
      overflow-y: auto;
      display: none;
    }
    .page.active { display: block; }

    /* –ö–ê–¢–ï–ì–û–†–ò–ò –ö–ï–ô–°–û–í */
    .case-categories {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .cat-btn {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(21,23,39,0.8);
      color: var(--text-soft);
      font-size: 11px;
      font-weight: 700;
      white-space: nowrap;
      cursor: pointer;
      transition: all .2s ease;
    }
    .cat-btn.active {
      background: linear-gradient(135deg, var(--gold), #ffe38b);
      color: #000;
      border-color: var(--gold);
    }
    .cat-btn[data-tier="COMMON"] { border-color: var(--common); }
    .cat-btn[data-tier="RARE"] { border-color: var(--rare); color: var(--rare); }
    .cat-btn[data-tier="EPIC"] { border-color: var(--epic); color: var(--epic); }
    .cat-btn[data-tier="LEGEND"] { border-color: var(--legend); color: var(--legend); }
    .cat-btn[data-tier="MYTH"] { border-color: var(--myth); color: var(--myth); }

    /* –£–õ–£–ß–®–ò–¢–ï–õ–¨ */
    .upgrader-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 350;
      backdrop-filter: blur(10px);
    }
    .upgrader {
      width: 90vw;
      max-width: 400px;
      background: linear-gradient(145deg, #111321, #05060c);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 24px;
      max-height: 85vh;
      overflow-y: auto;
    }
    .upgrader-title { font-size: 18px; font-weight: 800; margin-bottom: 16px; text-align: center; }
    
    .upgrade-select-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 20px;
      max-height: 200px;
      overflow-y: auto;
    }
    .upgrade-nft-option {
      aspect-ratio: 1;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all .2s ease;
      background: radial-gradient(circle at top, #181a2c, #090b13);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .upgrade-nft-option.selected {
      border-color: var(--gold);
      box-shadow: 0 0 20px rgba(243,186,47,0.4);
      transform: scale(1.05);
    }
    .upgrade-nft-option .nft-emoji {
      font-size: 32px;
      margin-bottom: 4px;
    }
    .upgrade-nft-option .nft-level {
      font-size: 9px;
      background: rgba(0,0,0,0.7);
      padding: 2px 6px;
      border-radius: 8px;
      font-weight: 700;
    }

    .upgrade-circle-container {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 0 auto 20px;
    }
    .upgrade-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      background: conic-gradient(
        var(--gold) 0deg var(--success-deg, 0deg),
        rgba(243,186,47,0.1) var(--success-deg, 0deg) 360deg
      );
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .circle-inner {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      background: linear-gradient(145deg, #1a1d2a, #0a0c14);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border: 2px solid rgba(243,186,47,0.3);
    }
    .circle-percent {
      font-size: 32px;
      font-weight: 900;
      color: var(--gold);
    }
    .circle-label {
      font-size: 10px;
      color: var(--text-soft);
      text-transform: uppercase;
    }

    .upgrade-preview-box {
      width: 120px;
      height: 120px;
      border-radius: 20px;
      margin: 0 auto 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 60px;
      border: 3px solid;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent 50%);
    }

    .upgrade-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }
    .upgrade-stat {
      background: rgba(21,23,39,0.8);
      padding: 12px;
      border-radius: 12px;
      text-align: center;
    }
    .upgrade-stat-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--gold);
    }
    .upgrade-stat-label {
      font-size: 10px;
      color: var(--text-soft);
      text-transform: uppercase;
    }

    .upgrade-btns {
      display: flex;
      gap: 12px;
    }
    .btn-upgrade {
      flex: 1;
      border-radius: 16px;
      padding: 14px;
      border: none;
      font-size: 14px;
      font-weight: 800;
      background: linear-gradient(135deg, #f3ba2f, #ffe38b);
      color: #000;
      cursor: pointer;
    }
    .btn-ghost-upgrade {
      flex: 1;
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
    }

    /* –ê–ù–ò–ú–ê–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø */
    .case-open-animation {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.98);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 400;
      flex-direction: column;
    }
    .case-shake {
      width: 150px;
      height: 150px;
      position: relative;
      animation: caseShake 0.5s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 100px;
    }
    @keyframes caseShake {
      0%, 100% { transform: rotate(-5deg) translateX(0); }
      25% { transform: rotate(5deg) translateX(-10px); }
      75% { transform: rotate(-5deg) translateX(10px); }
    }
    .roulette-container {
      width: 100%;
      height: 140px;
      position: relative;
      overflow: hidden;
      margin-top: 40px;
    }
    .roulette-track {
      display: flex;
      gap: 16px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }
    .roulette-item {
      width: 100px;
      height: 100px;
      border-radius: 16px;
      border: 3px solid;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent 50%);
    }
    .roulette-center {
      position: absolute;
      left: 50%;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--gold);
      box-shadow: 0 0 20px var(--gold);
      z-index: 10;
      transform: translateX(-50%);
    }

    /* CASES */
    .case-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .case3d-wrap { perspective: 900px; }
    .case-card {
      position: relative;
      border-radius: 20px;
      padding: 12px;
      border: 2px solid;
      box-shadow: 0 20px 40px rgba(0,0,0,0.85);
      transform-style: preserve-3d;
      transition: transform .28s ease, box-shadow .28s ease;
      overflow: hidden;
      background: linear-gradient(145deg, #1a1d2a, #0a0c14);
      cursor: pointer;
    }
    .case-card:hover {
      transform: rotateY(12deg) rotateX(-6deg) translateY(-4px);
      box-shadow: 0 28px 55px rgba(0,0,0,0.98), 0 0 30px var(--rarity-glow);
    }
    .case-card[data-tier="COMMON"] { border-color: var(--common); --rarity-glow: rgba(156,163,175,0.4); }
    .case-card[data-tier="RARE"] { border-color: var(--rare); --rarity-glow: rgba(59,130,246,0.4); }
    .case-card[data-tier="EPIC"] { border-color: var(--epic); --rarity-glow: rgba(168,85,247,0.4); }
    .case-card[data-tier="LEGEND"] { border-color: var(--legend); --rarity-glow: rgba(245,158,11,0.4); }
    .case-card[data-tier="MYTH"] { border-color: var(--myth); --rarity-glow: rgba(239,68,68,0.4); }

    .case-box3d {
      width: 60px;
      height: 60px;
      position: relative;
      transform-style: preserve-3d;
      transform: rotateX(-20deg) rotateY(-28deg);
    }
    .case-face {
      position: absolute;
      inset: 0;
      border-radius: 12px;
      background: linear-gradient(145deg, #22263c, #090b12);
      box-shadow: 0 4px 16px rgba(0,0,0,0.9);
    }
    .case-front-face { transform: translateZ(30px); }
    .case-lock {
      position: absolute;
      width: 16px;
      height: 20px;
      background: linear-gradient(135deg, #8b4513, #654321);
      border-radius: 3px 3px 8px 8px;
      top: 12px;
      right: 8px;
    }
    .case-lock::before {
      content: "";
      position: absolute;
      width: 20px;
      height: 8px;
      background: #654321;
      border-radius: 4px;
      top: -6px;
      left: -2px;
    }

    .case-meta { flex: 1; margin-left: 10px; }
    .case-title { font-size: 10px; text-transform: uppercase; letter-spacing: .1em; color: #cfd6ff; }
    .case-name { font-size: 14px; font-weight: 800; margin: 2px 0; }
    .case-rarity { 
      font-size: 10px; 
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 12px;
      border: 1px solid;
      display: inline-block;
    }
    .case-card[data-tier="COMMON"] .case-rarity { color: var(--common); border-color: var(--common); background: rgba(156,163,175,0.1); }
    .case-card[data-tier="RARE"] .case-rarity { color: var(--rare); border-color: var(--rare); background: rgba(59,130,246,0.1); }
    .case-card[data-tier="EPIC"] .case-rarity { color: var(--epic); border-color: var(--epic); background: rgba(168,85,247,0.1); }
    .case-card[data-tier="LEGEND"] .case-rarity { color: var(--legend); border-color: var(--legend); background: rgba(245,158,11,0.1); }
    .case-card[data-tier="MYTH"] .case-rarity { color: var(--myth); border-color: var(--myth); background: rgba(239,68,68,0.1); }

    .case-price {
      margin-top: 8px;
      font-size: 13px;
      font-weight: 800;
      color: var(--gold);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .case-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: var(--text-soft);
    }
    .case-btn {
      border-radius: 20px;
      padding: 6px 14px;
      border: none;
      background: linear-gradient(135deg, #f3ba2f, #ffdf7f);
      color: #000;
      font-size: 10px;
      font-weight: 900;
      cursor: pointer;
    }

    .stat-card {
      background: linear-gradient(135deg,#151728,#0a0c14);
      border-radius: 20px;
      padding: 16px;
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 20px 40px rgba(0,0,0,0.7);
      margin-bottom: 16px;
    }
    .small { font-size: 11px; color: var(--text-soft); }

    .profile-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .avatar {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      background: radial-gradient(circle at top, #1f2340, #090b12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 800;
    }
    .profile-name { font-size: 14px; font-weight: 800; }
    .profile-tag { font-size: 11px; color: var(--text-soft); }
    .badge {
      font-size: 10px;
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid rgba(243,186,47,.8);
      color: var(--gold);
      background: rgba(243,186,47,.15);
      font-weight: 700;
    }

    /* NFT */
    .nft-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 12px;
    }
    .nft-card {
      border-radius: 18px;
      padding: 10px;
      border: 2px solid;
      box-shadow: 0 16px 35px rgba(0,0,0,0.85);
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at top, #181a2c, #090b13);
      cursor: pointer;
      transition: transform .2s ease;
    }
    .nft-card:hover { transform: translateY(-2px); }
    .nft-card[data-rarity="COMMON"] { border-color: var(--common); }
    .nft-card[data-rarity="RARE"] { border-color: var(--rare); }
    .nft-card[data-rarity="EPIC"] { border-color: var(--epic); }
    .nft-card[data-rarity="LEGEND"] { border-color: var(--legend); }
    .nft-card[data-rarity="MYTH"] { border-color: var(--myth); }
    .nft-card.upgradable { animation: pulse 2s infinite; }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(243,186,47,0.3); }
      50% { box-shadow: 0 0 40px rgba(243,186,47,0.6); }
    }

    .nft-inner {
      border-radius: 14px;
      padding: 12px;
      background: radial-gradient(circle at top, #20223a, #06070f);
      position: relative;
    }
    .nft-figure {
      width: 100%;
      height: 100px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      margin-bottom: 8px;
      background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.2), transparent 60%);
    }
    .nft-name { font-size: 13px; font-weight: 700; margin-bottom: 4px; }
    .nft-meta { font-size: 11px; color: var(--text-soft); font-weight: 600; }
    .upgrade-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(243,186,47,0.9);
      color: #000;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 9px;
      font-weight: 900;
    }

    .nav {
      position: fixed;
      left: 14px;
      right: 14px;
      bottom: 18px;
      background: rgba(8,9,16,0.97);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 24px 50px rgba(0,0,0,0.95);
      display: flex;
      justify-content: space-around;
      padding: 12px 10px;
      z-index: 200;
    }
    .nav-i {
      font-size: 22px;
      opacity: 0.5;
      transition: .25s;
      padding: 8px;
      border-radius: 16px;
      cursor: pointer;
    }
    .nav-i.active {
      opacity: 1;
      color: var(--gold);
      transform: translateY(-4px) scale(1.08);
      background: rgba(243,186,47,0.15);
    }

    .modal-back {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
      backdrop-filter: blur(8px);
    }
    .modal {
      width: 92%;
      max-width: 380px;
      background: linear-gradient(145deg, #111321, #05060c);
      border-radius: 24px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 30px 60px rgba(0,0,0,0.95);
      padding: 20px;
      max-height: 85vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .modal-title { font-size: 16px; font-weight: 800; }
    .pill {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 20px;
      background: rgba(0,242,255,0.2);
      color: var(--accent);
      font-weight: 700;
      border: 1px solid rgba(0,242,255,0.4);
    }
    .modal-actions { margin-top: 16px; display: flex; gap: 12px; }
    .btn {
      flex: 1;
      border-radius: 20px;
      padding: 12px;
      border: none;
      font-size: 13px;
      font-weight: 800;
      cursor: pointer;
      transition: transform .2s;
    }
    .btn:active { transform: scale(0.96); }
    .btn-primary {
      background: linear-gradient(135deg, #f3ba2f, #ffe38b);
      color: #000;
      box-shadow: 0 8px 24px rgba(243,186,47,0.4);
    }
    .btn-ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.25);
      color: #fff;
    }

    .pack-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 16px;
      background: rgba(21,23,39,0.8);
      margin-bottom: 10px;
      font-size: 12px;
      cursor: pointer;
      transition: all .2s ease;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .pack-row:hover, .pack-row.selected {
      background: rgba(243,186,47,0.15);
      border-color: rgba(243,186,47,0.4);
    }
    .pack-title { font-weight: 800; }
    .pack-coins { color: var(--gold); font-weight: 800; font-size: 14px; }
    .pack-tag { font-size: 10px; color: var(--text-soft); }

    /* NFT DETAIL */
    .nft-detail-visual {
      width: 100%;
      height: 200px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 80px;
      margin-bottom: 16px;
      border: 3px solid;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 60%);
    }
    .nft-stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }
    .nft-stat-box {
      background: rgba(21,23,39,0.8);
      padding: 12px;
      border-radius: 12px;
      text-align: center;
    }
    .nft-stat-value { font-size: 16px; font-weight: 800; color: var(--gold); }
    .nft-stat-label { font-size: 9px; color: var(--text-soft); text-transform: uppercase; }

    /* LEADERBOARD */
    .leader-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    .leader-tab {
      flex: 1;
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(21,23,39,0.6);
      color: var(--text-soft);
      font-size: 12px;
      font-weight: 700;
      text-align: center;
      cursor: pointer;
    }
    .leader-tab.active {
      background: linear-gradient(135deg, var(--gold), #ffe38b);
      color: #000;
      border-color: var(--gold);
    }
    .leader-list { display: flex; flex-direction: column; gap: 8px; }
    .leader-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 16px;
      background: rgba(21,23,39,0.6);
      border: 1px solid rgba(255,255,255,0.05);
    }
    .leader-rank {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 14px;
    }
    .leader-rank.gold { background: linear-gradient(135deg, #ffd700, #ffaa00); color: #000; }
    .leader-rank.silver { background: linear-gradient(135deg, #c0c0c0, #a0a0a0); color: #000; }
    .leader-rank.bronze { background: linear-gradient(135deg, #cd7f32, #a0522d); color: #fff; }
    .leader-rank.normal { background: rgba(255,255,255,0.1); color: var(--text-soft); }
    .leader-info { flex: 1; }
    .leader-name { font-weight: 700; font-size: 14px; }
    .leader-value { font-size: 12px; color: var(--gold); font-weight: 700; }

    /* TRADE */
    .trade-section { margin-top: 16px; }
    .trade-input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(21,23,39,0.8);
      color: #fff;
      font-size: 14px;
      margin-bottom: 12px;
    }
    .trade-nft-list {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      margin-bottom: 12px;
      padding-bottom: 8px;
    }
    .trade-nft-item {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      border: 2px solid rgba(255,255,255,0.1);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      cursor: pointer;
      transition: all .2s;
    }
    .trade-nft-item.selected {
      border-color: var(--gold);
      box-shadow: 0 0 20px rgba(243,186,47,0.4);
    }

    #admin-panel {
      background: linear-gradient(135deg, #1a0d2a, #0a0514) !important;
      border: 2px solid rgba(243,186,47,0.8) !important;
      box-shadow: 0 0 40px rgba(243,186,47,0.6) !important;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="brand">ELITE <span>DEB</span></div>
    <div class="bal-box">
      <div class="bal-main"><span id="balance">15 000</span> ü™ô</div>
      <div class="bal-sub" id="event-label">üî• –û–≥–Ω–µ–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è</div>
    </div>
  </div>

  <!-- SHOP -->
  <div class="page active" id="p-shop">
    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-size:14px;font-weight:800;">üé∞ –ö–ï–ô–°–´</div>
        <button class="btn btn-primary" style="font-size:11px;padding:8px 16px;border-radius:20px;" onclick="openTopupModal()">‚≠ê –î–û–î–ï–ü</button>
      </div>
      <div class="small">–í—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–µ–π—Å–æ–≤</div>
    </div>
    
    <div class="case-categories">
      <div class="cat-btn active" onclick="filterCases('ALL', this)">–í–°–ï</div>
      <div class="cat-btn" data-tier="COMMON" onclick="filterCases('COMMON', this)">‚ö™ –û–ë–´–ß–ù–´–ï</div>
      <div class="cat-btn" data-tier="RARE" onclick="filterCases('RARE', this)">üîµ –†–ê–†–´</div>
      <div class="cat-btn" data-tier="EPIC" onclick="filterCases('EPIC', this)">üü£ –≠–ü–ò–ö–ò</div>
      <div class="cat-btn" data-tier="LEGEND" onclick="filterCases('LEGEND', this)">üü° –õ–ï–ì–ï–ù–î–´</div>
      <div class="cat-btn" data-tier="MYTH" onclick="filterCases('MYTH', this)">üî¥ –ú–ò–§–´</div>
    </div>
    
    <div class="case-grid" id="case-container"></div>
  </div>

  <!-- INVENTORY -->
  <div class="page" id="p-inv">
    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <div style="font-size:14px;font-weight:800;">üéí –ú–û–ô –ò–ù–í–ï–ù–¢–ê–†–¨</div>
        <button class="btn btn-primary" style="font-size:11px;padding:6px 12px;border-radius:16px;" onclick="craftItems()">‚öóÔ∏è –ö–†–ê–§–¢ 3‚Üí1</button>
      </div>
      <div class="small">–ù–∞–∂–º–∏ –Ω–∞ NFT –¥–ª—è –¥–µ—Ç–∞–ª–µ–π. ‚ö° = –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å</div>
    </div>
    <div id="inventory-empty" class="small" style="margin-top:12px;text-align:center;opacity:0.7;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –û—Ç–∫—Ä–æ–π –ø–∞—Ä—É –∫–µ–π—Å–æ–≤!</div>
    <div class="nft-grid" id="inventory-grid"></div>
    
    <div class="stat-card trade-section">
      <div style="font-size:14px;font-weight:800;margin-bottom:12px;">üîÑ –û–ë–ú–ï–ù –° –ò–ì–†–û–ö–ê–ú–ò</div>
      <input type="text" class="trade-input" placeholder="@username –∏–≥—Ä–æ–∫–∞" id="trade-username">
      <div class="small" style="margin-bottom:8px;">–í—ã–±–µ—Ä–∏ NFT –¥–ª—è –æ–±–º–µ–Ω–∞ (–Ω–∞–∂–º–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ):</div>
      <div class="trade-nft-list" id="trade-nft-list"></div>
      <button class="btn btn-primary" style="width:100%;" onclick="sendTrade()">üì§ –ü–†–ï–î–õ–û–ñ–ò–¢–¨ –û–ë–ú–ï–ù</button>
    </div>
  </div>

  <!-- PROFILE -->
  <div class="page" id="p-prof">
    <div class="stat-card">
      <div class="profile-head">
        <div style="display:flex;align-items:center;gap:12px;">
          <div class="avatar"><span id="prof-initial">M</span></div>
          <div>
            <div class="profile-name" id="prof-name">–ò–≥—Ä–æ–∫</div>
            <div class="profile-tag" id="prof-username">@user</div>
          </div>
        </div>
        <div><div class="badge" id="prof-title">–ù–æ–≤–∏—á–æ–∫</div></div>
      </div>
      <div class="small">
        –í—Å–µ–≥–æ –∫–µ–π—Å–æ–≤: <span id="prof-cases">0</span> ‚Ä¢ –õ—É—á—à–∏–π –¥—Ä–æ–ø: <span id="prof-best">‚Äì</span>
      </div>
    </div>

    <div class="stat-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <div style="font-size:14px;font-weight:800;">üìÜ –ï–ñ–ï–î–ù–ï–í–ù–´–ô –ë–û–ù–£–°</div>
        <span class="pill" id="daily-pill">–î–æ—Å—Ç—É–ø–µ–Ω</span>
      </div>
      <div class="small">–ë–æ–Ω—É—Å + –∏–≤–µ–Ω—Ç —à–∞–Ω—Å—ã!</div>
      <button class="btn btn-primary" style="margin-top:12px;" onclick="claimDaily()">–ó–ê–ë–†–ê–¢–¨ ü™ô</button>
    </div>

    <div class="stat-card">
      <div style="font-size:14px;font-weight:800;margin-bottom:12px;">üèÜ –¢–û–ü –õ–ò–î–ï–†–û–í</div>
      <div class="leader-tabs">
        <div class="leader-tab active" onclick="switchLeaderTab('balance', this)">üí∞ –ë–∞–ª–∞–Ω—Å</div>
        <div class="leader-tab" onclick="switchLeaderTab('inventory', this)">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
      </div>
      <div class="leader-list" id="leader-list"></div>
    </div>

    <div class="stat-card" id="admin-panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="font-size:14px;font-weight:800;color:var(--gold);">üëë –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨</div>
        <span class="pill" style="background:rgba(243,186,47,0.3);color:var(--gold);">MAX POWER</span>
      </div>
      <div class="modal-actions" style="gap:8px;margin-top:8px;">
        <button class="btn btn-primary" onclick="adminAddBalance()">+1M ü™ô</button>
        <button class="btn btn-primary" onclick="adminSetRich()">–í–°–ï–ú 10M</button>
        <button class="btn btn-primary" onclick="toggleEvent()">üî• –ò–í–ï–ù–¢</button>
      </div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="page" id="p-set">
    <div class="stat-card">
      <div style="font-size:14px;font-weight:800;margin-bottom:12px;">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
        <span class="small">–í–∏–±—Ä–∞—Ü–∏—è</span>
        <input type="checkbox" id="set-vibrate" checked>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <span class="small">–ó–≤—É–∫–∏</span>
        <input type="checkbox" id="set-sound" checked>
      </div>
      <button class="btn btn-ghost" style="margin-top:16px;" onclick="tg?.close()">‚ùå –í–´–ô–¢–ò</button>
    </div>
  </div>

  <!-- ANIMATION -->
  <div class="case-open-animation" id="case-animation">
    <div class="case-shake" id="case-shake">üì¶</div>
    <div class="roulette-container" id="roulette-container" style="display:none;">
      <div class="roulette-track" id="roulette-track"></div>
      <div class="roulette-center"></div>
    </div>
  </div>

  <!-- DROP MODAL -->
  <div class="modal-back" id="drop-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">‚ú® –ù–æ–≤—ã–π NFT-–¥—Ä–æ–ø!</div>
        <span class="pill" id="drop-rarity-pill">RARE</span>
      </div>
      <div class="nft-detail-visual" id="drop-visual">
        <span id="drop-emoji">üé®</span>
      </div>
      <div style="font-size:20px;font-weight:800;text-align:center;margin-bottom:6px;" id="drop-name">Name</div>
      <div class="small" style="text-align:center;margin-bottom:16px;" id="drop-desc">Description</div>
      <div class="nft-stats-grid">
        <div class="nft-stat-box">
          <div class="nft-stat-value" id="drop-power">0</div>
          <div class="nft-stat-label">–°–ò–õ–ê</div>
        </div>
        <div class="nft-stat-box">
          <div class="nft-stat-value" id="drop-luck">0%</div>
          <div class="nft-stat-label">–£–î–ê–ß–ê</div>
        </div>
        <div class="nft-stat-box">
          <div class="nft-stat-value" id="drop-level">0</div>
          <div class="nft-stat-label">–£–†–û–í–ï–ù–¨</div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="rejectDrop()">‚ùå –ü—Ä–æ–¥–∞—Ç—å (+500ü™ô)</button>
        <button class="btn btn-primary" onclick="acceptDrop()">‚úÖ –ó–∞–±—Ä–∞—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- UPGRADER MODAL -->
  <div class="upgrader-modal" id="upgrader-modal">
    <div class="upgrader">
      <div class="upgrader-title">‚ö° –£–õ–£–ß–®–ò–¢–ï–õ–¨ NFT</div>
      <div class="small" style="text-align:center;margin-bottom:12px;">–í—ã–±–µ—Ä–∏ NFT –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è</div>
      
      <div class="upgrade-select-grid" id="upgrade-select-grid"></div>
      
      <div id="upgrade-details" style="display:none;">
        <div class="upgrade-circle-container">
          <div class="upgrade-circle" id="upgrade-circle">
            <div class="circle-inner">
              <div class="circle-percent" id="upgrade-percent">75%</div>
              <div class="circle-label">–®–ê–ù–°</div>
            </div>
          </div>
        </div>
        
        <div class="upgrade-preview-box" id="upgrade-preview">
          <span id="upgrade-emoji">üé®</span>
        </div>
        
        <div class="upgrade-stats">
          <div class="upgrade-stat">
            <div class="upgrade-stat-value" id="upgrade-cost">5K</div>
            <div class="upgrade-stat-label">–¶–ï–ù–ê</div>
          </div>
          <div class="upgrade-stat">
            <div class="upgrade-stat-value" id="upgrade-risk">15%</div>
            <div class="upgrade-stat-label">–†–ò–°–ö</div>
          </div>
        </div>
        
        <div class="upgrade-btns">
          <button class="btn-ghost-upgrade" onclick="closeUpgrader()">‚ùå –û—Ç–º–µ–Ω–∞</button>
          <button class="btn-upgrade" onclick="performUpgrade()">üöÄ –£–õ–£–ß–®–ò–¢–¨</button>
        </div>
      </div>
    </div>
  </div>

  <!-- NFT DETAIL MODAL -->
  <div class="modal-back" id="nft-detail-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title" id="detail-name">NFT</div>
        <span class="pill" id="detail-rarity">RARE</span>
      </div>
      <div class="nft-detail-visual" id="detail-visual">
        <span id="detail-emoji">üé®</span>
      </div>
      <div class="nft-stats-grid">
        <div class="nft-stat-box">
          <div class="nft-stat-value" id="detail-power">0</div>
          <div class="nft-stat-label">–°–ò–õ–ê</div>
        </div>
        <div class="nft-stat-box">
          <div class="nft-stat-value" id="detail-luck">0%</div>
          <div class="nft-stat-label">–£–î–ê–ß–ê</div>
        </div>
        <div class="nft-stat-box">
          <div class="nft-stat-value" id="detail-level">0</div>
          <div class="nft-stat-label">–£–†–û–í–ï–ù–¨</div>
        </div>
      </div>
      <div class="small" style="text-align:center;margin-bottom:16px;" id="detail-desc">–û–ø–∏—Å–∞–Ω–∏–µ</div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeNFTDetail()">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
        <button class="btn btn-primary" id="detail-upgrade-btn" onclick="upgradeFromDetail()">‚ö° –£–ª—É—á—à–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- TOPUP MODAL -->
  <div class="modal-back" id="topup-modal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">üíé –ö–∞—Å—Å–∞ ELITE DEB</div>
        <span class="pill">NFT BATTLE</span>
      </div>
      <div class="small" style="margin-bottom:16px;">–í—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç –º–æ–Ω–µ—Ç</div>
      <div class="pack-row" onclick="selectPack(10000, this)">
        <div>
          <div class="pack-title">Starter</div>
          <div class="pack-tag">–î–ª—è —Ä–∞–∑–≥–æ–Ω–∞</div>
        </div>
        <div class="pack-coins">10 000 ü™ô</div>
      </div>
      <div class="pack-row" onclick="selectPack(50000, this)">
        <div>
          <div class="pack-title">Grinder</div>
          <div class="pack-tag">–ö–µ–π—Å—ã 24/7</div>
        </div>
        <div class="pack-coins">50 000 ü™ô</div>
      </div>
      <div class="pack-row" onclick="selectPack(250000, this)">
        <div>
          <div class="pack-title">Whale</div>
          <div class="pack-tag">NFT‚Äë–∏–º–ø–µ—Ä–∏—è</div>
        </div>
        <div class="pack-coins">250 000 ü™ô</div>
      </div>
      <div class="small" id="topup-selected" style="margin-top:12px;">–ü–∞–∫–µ—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω</div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeTopupModal()">–ó–ê–ö–†–´–¢–¨</button>
        <button class="btn btn-primary" onclick="applyTopup()">–ü–û–ü–û–õ–ù–ò–¢–¨</button>
      </div>
    </div>
  </div>

  <div class="nav">
    <div class="nav-i active" onclick="openTab('p-shop', this)">üì¶</div>
    <div class="nav-i" onclick="openTab('p-inv', this)">üéí</div>
    <div class="nav-i" onclick="openTab('p-prof', this)">üëë</div>
    <div class="nav-i" onclick="openTab('p-set', this)">‚öôÔ∏è</div>
  </div>

  <audio id="snd-spin" src="https://cdn.freesound.org/previews/341/341695_6261196-lq.mp3"></audio>
  <audio id="snd-drop" src="https://cdn.freesound.org/previews/235/235909_3982175-lq.mp3"></audio>
  <audio id="snd-upgrade" src="https://cdn.freesound.org/previews/387/387739_4175099-lq.mp3"></audio>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.expand();

    const STORAGE_KEY = "elite_deb_v3";
    
    let state = {
      bal: 15000,
      inv: [],
      totalCases: 0,
      bestDropRarity: null,
      bestDropName: null,
      lastDaily: null,
      eventFireWeek: true
    };

    let currentFilter = 'ALL';
    let selectedPack = null;
    let pendingDrop = null;
    let currentUpgradingIndex = null;
    let selectedTradeIndex = null;
    let currentDetailIndex = null;

    // –ó–∞–≥—Ä—É–∑–∫–∞
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) state = {...state, ...JSON.parse(raw)};
      } catch(e) {}
    }
    function saveState() {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e) {}
    }
    loadState();

    const RARITY = [
      {code: "COMMON", label: "–û–ë–´–ß–ù–´–ô", color:"#9ca3af", weight:1, emoji: "‚ö™"},
      {code: "RARE", label:"–†–ê–†–ï", color:"#3b82f6", weight:2, emoji: "üîµ"},
      {code: "EPIC", label:"–≠–ü–ò–ö", color:"#a855f7", weight:3, emoji: "üü£"},
      {code: "LEGEND", label:"–õ–ï–ì–ï–ù–î–ê–†–ù–´–ô", color:"#f59e0b", weight:4, emoji: "üü°"},
      {code: "MYTH", label:"–ú–ò–§–ò–ß–ï–°–ö–ò–ô", color:"#ef4444", weight:5, emoji: "üî¥"}
    ];

    const NFT_TEMPLATES = [
      { name: "Virus Core", desc: "–°–µ—Ä–¥—Ü–µ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –≤–∏—Ä—É—Å–∞", emoji: "ü¶†", power: 45 },
      { name: "Toxic Blade", desc: "–û—Ç—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ª–µ–∑–≤–∏–µ", emoji: "‚öîÔ∏è", power: 72 },
      { name: "Crown of Glitch", desc: "–ö–æ—Ä–æ–Ω–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ —Å–±–æ—è", emoji: "üëë", power: 95 },
      { name: "Neon Chip", desc: "–ù–µ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä", emoji: "üíæ", power: 28 },
      { name: "Quantum Shard", desc: "–ö–≤–∞–Ω—Ç–æ–≤—ã–π –æ—Å–∫–æ–ª–æ–∫", emoji: "üíé", power: 120 },
      { name: "Cyber Skull", desc: "–ö–∏–±–µ—Ä-—á–µ—Ä–µ–ø", emoji: "üíÄ", power: 88 },
      { name: "Data Orb", desc: "–°—Ñ–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö", emoji: "üîÆ", power: 55 },
      { name: "Neural Link", desc: "–ù–µ–π—Ä–æ–Ω–Ω–∞—è —Å–≤—è–∑—å", emoji: "üîó", power: 67 },
      { name: "Plasma Core", desc: "–ü–ª–∞–∑–º–µ–Ω–Ω–æ–µ —è–¥—Ä–æ", emoji: "‚ö°", power: 105 },
      { name: "Void Essence", desc: "–≠—Å—Å–µ–Ω—Ü–∏—è –ø—É—Å—Ç–æ—Ç—ã", emoji: "üåë", power: 150 }
    ];

    let CASES = [];
    
    function generateNFT(tier, isUpgrade = false) {
      const template = NFT_TEMPLATES[Math.floor(Math.random() * NFT_TEMPLATES.length)];
      const rarity = RARITY.find(r => r.code === tier);
      const upgradeLevel = isUpgrade ? 0 : Math.floor(Math.random() * 3);
      
      return {
        id: Date.now() + Math.random(),
        name: template.name + " #" + Math.floor(Math.random() * 999),
        rarity: tier,
        desc: template.desc,
        emoji: template.emoji,
        power: template.power + (rarity.weight * 15) + (upgradeLevel * 10),
        luck: rarity.weight * 3 + Math.floor(Math.random() * 10),
        upgradeLevel: upgradeLevel,
        maxLevel: 5
      };
    }

    function initCases() {
      const tiers = ["COMMON", "RARE", "EPIC", "LEGEND", "MYTH"];
      const counts = [12, 10, 8, 6, 4];
      const prices = [1500, 7500, 25000, 120000, 400000];
      
      let id = 1;
      tiers.forEach((tier, idx) => {
        for (let i = 0; i < counts[idx]; i++) {
          CASES.push({
            id: id++,
            name: `${tier} #${i+1}`,
            tier: tier,
            price: Math.floor(prices[idx] * (0.8 + Math.random() * 0.4)),
            preview: generateNFT(tier)
          });
        }
      });
      CASES.sort(() => Math.random() - 0.5);
    }
    initCases();

    function formatCoins(n) { return Math.floor(n).toLocaleString("ru-RU"); }
    function getRarity(tier) { return RARITY.find(r => r.code === tier); }

    // –†–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤
    function drawCases() {
      const container = document.getElementById("case-container");
      const filtered = currentFilter === 'ALL' ? CASES : CASES.filter(c => c.tier === currentFilter);
      
      container.innerHTML = filtered.map(c => {
        const r = getRarity(c.tier);
        return `
          <div class="case3d-wrap">
            <div class="case-card" data-tier="${c.tier}" onclick="startOpenCase(${c.id})">
              <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px;">
                <div class="case-box3d">
                  <div class="case-face case-front-face">
                    <div class="case-lock"></div>
                  </div>
                </div>
                <div class="case-meta">
                  <div class="case-title">–ö–ï–ô–°</div>
                  <div class="case-name">${c.name}</div>
                  <div class="case-rarity">${r.label}</div>
                </div>
              </div>
              <div class="case-price">
                <div>${formatCoins(c.price)} ü™ô</div>
                <span style="font-size:10px;color:var(--text-soft);">${c.preview.emoji} ${c.preview.name.split(' ')[0]}</span>
              </div>
              <div class="case-footer">
                <span>üîì –û—Ç–∫—Ä—ã—Ç—å</span>
                <button class="case-btn">–ö–†–£–¢–ò–¢–¨!</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function filterCases(tier, btn) {
      currentFilter = tier;
      document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      drawCases();
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    function startOpenCase(id) {
      const c = CASES.find(x => x.id === id);
      if (!c) return;
      
      if (state.bal < c.price) {
        alert("üí∏ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
        hapticImpact("heavy");
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
      const anim = document.getElementById("case-animation");
      const shake = document.getElementById("case-shake");
      const rouletteContainer = document.getElementById("roulette-container");
      const track = document.getElementById("roulette-track");
      
      anim.style.display = "flex";
      shake.style.display = "flex";
      rouletteContainer.style.display = "none";
      
      // –¢—Ä—è—Å–∫–∞ 1 —Å–µ–∫—É–Ω–¥—É
      setTimeout(() => {
        shake.style.display = "none";
        rouletteContainer.style.display = "block";
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä—É–ª–µ—Ç–∫—É (20 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
        let html = '';
        const items = [];
        for (let i = 0; i < 20; i++) {
          // –ü–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç - –ø—Ä–∏–∑
          if (i === 19) {
            items.push(generateNFT(c.tier));
          } else {
            // –°–º–µ—à–∞–Ω–Ω–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å
            const rand = Math.random();
            let tier = "COMMON";
            if (rand > 0.6) tier = "RARE";
            if (rand > 0.8) tier = "EPIC";
            if (rand > 0.9) tier = "LEGEND";
            items.push(generateNFT(tier));
          }
        }
        
        // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑
        pendingDrop = items[19];
        
        html = items.map((item, i) => {
          const color = getRarity(item.rarity).color;
          return `<div class="roulette-item" style="border-color:${color}">${item.emoji}</div>`;
        }).join('');
        
        track.innerHTML = html;
        track.style.transition = "none";
        track.style.transform = "translateX(-50%) translateX(0)";
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
        setTimeout(() => {
          track.style.transition = "transform 3s cubic-bezier(0.1, 0.7, 0.1, 1)";
          // –°–¥–≤–∏–≥–∞–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã 19-–π —ç–ª–µ–º–µ–Ω—Ç (–∏–Ω–¥–µ–∫—Å 19) –æ–∫–∞–∑–∞–ª—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ
          // –ö–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç 100px + 16px gap = 116px
          // –¶–µ–Ω—Ç—Ä = 19 * 116 + 50 = 2254px –æ—Ç –Ω–∞—á–∞–ª–∞
          // –ù–æ —Ç—Ä–µ–∫ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω translateX(-50%), —Ç–∞–∫ —á—Ç–æ —Å–¥–≤–∏–≥–∞–µ–º –≤–ª–µ–≤–æ
          const offset = -(19 * 116) + (window.innerWidth / 2) - 50;
          track.style.transform = `translateX(calc(-50% + ${offset}px))`;
          
          playSound("snd-spin");
          
          setTimeout(() => {
            anim.style.display = "none";
            state.bal -= c.price;
            state.totalCases++;
            updateBalance();
            saveState();
            showDropModal(pendingDrop);
            playSound("snd-drop");
            hapticImpact("heavy");
          }, 3000);
        }, 100);
      }, 800);
    }

    function showDropModal(nft) {
      const r = getRarity(nft.rarity);
      document.getElementById("drop-name").textContent = nft.name;
      document.getElementById("drop-desc").textContent = nft.desc;
      document.getElementById("drop-emoji").textContent = nft.emoji;
      document.getElementById("drop-power").textContent = nft.power;
      document.getElementById("drop-luck").textContent = nft.luck + "%";
      document.getElementById("drop-level").textContent = nft.upgradeLevel;
      
      const visual = document.getElementById("drop-visual");
      visual.style.borderColor = r.color;
      visual.style.boxShadow = `0 0 40px ${r.color}40`;
      
      const pill = document.getElementById("drop-rarity-pill");
      pill.textContent = r.label;
      pill.style.color = r.color;
      pill.style.borderColor = r.color;
      pill.style.background = r.color + "33";
      
      document.getElementById("drop-modal").style.display = "flex";
    }

    function acceptDrop() {
      if (!pendingDrop) return closeDropModal();
      state.inv.push(pendingDrop);
      
      const dropWeight = getRarity(pendingDrop.rarity).weight;
      const bestWeight = state.bestDropRarity ? getRarity(state.bestDropRarity).weight : 0;
      if (dropWeight > bestWeight) {
        state.bestDropRarity = pendingDrop.rarity;
        state.bestDropName = pendingDrop.name;
      }
      
      pendingDrop = null;
      saveState();
      renderInventory();
      updateProfile();
      closeDropModal();
    }

    function rejectDrop() {
      if (pendingDrop) {
        state.bal += 500; // –ü—Ä–æ–¥–∞–∂–∞ –∑–∞ 500
        updateBalance();
        saveState();
      }
      pendingDrop = null;
      closeDropModal();
    }

    function closeDropModal() {
      document.getElementById("drop-modal").style.display = "none";
    }

    // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
    function renderInventory() {
      const grid = document.getElementById("inventory-grid");
      const empty = document.getElementById("inventory-empty");
      const tradeList = document.getElementById("trade-nft-list");
      
      if (!state.inv.length) {
        grid.innerHTML = "";
        if (tradeList) tradeList.innerHTML = "";
        empty.style.display = "block";
        return;
      }
      
      empty.style.display = "none";
      
      // –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞
      grid.innerHTML = state.inv.map((nft, i) => {
        const r = getRarity(nft.rarity);
        const canUpgrade = nft.upgradeLevel < nft.maxLevel;
        return `
          <div class="nft-card ${canUpgrade ? 'upgradable' : ''}" 
               data-rarity="${nft.rarity}" 
               onclick="selectNFTForTrade(${i}); openNFTDetail(${i})">
            ${canUpgrade ? '<div class="upgrade-badge">‚ö°</div>' : ''}
            <div class="nft-inner">
              <div class="nft-figure" style="border:2px solid ${r.color}">
                <span style="font-size:48px;">${nft.emoji}</span>
              </div>
              <div class="nft-name">${nft.name}</div>
              <div class="nft-meta">${r.label} ‚Ä¢ –£—Ä. ${nft.upgradeLevel}</div>
            </div>
          </div>
        `;
      }).join('');
      
      // –°–ø–∏—Å–æ–∫ –¥–ª—è –æ–±–º–µ–Ω–∞
      if (tradeList) {
        tradeList.innerHTML = state.inv.map((nft, i) => `
          <div class="trade-nft-item ${selectedTradeIndex === i ? 'selected' : ''}" 
               onclick="selectNFTForTrade(${i})"
               style="border-color:${getRarity(nft.rarity).color}">
            ${nft.emoji}
          </div>
        `).join('');
      }
    }

    function selectNFTForTrade(index) {
      selectedTradeIndex = index;
      renderInventory(); // –ü–µ—Ä–µ—Ä–∏—Å—É–µ–º —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ
    }

    function sendTrade() {
      const username = document.getElementById("trade-username").value.trim();
      if (!username) return alert("–í–≤–µ–¥–∏—Ç–µ username!");
      if (selectedTradeIndex === null) return alert("–í—ã–±–µ—Ä–∏ NFT –¥–ª—è –æ–±–º–µ–Ω–∞!");
      
      const nft = state.inv[selectedTradeIndex];
      alert(`üì§ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!\n\n–û—Ç–¥–∞—ë—à—å: ${nft.emoji} ${nft.name}\n–ò–≥—Ä–æ–∫—É: ${username}\n\n(–í –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ –æ–±–º–µ–Ω –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π)`);
      selectedTradeIndex = null;
      renderInventory();
    }

    // –î–µ—Ç–∞–ª–∏ NFT
    function openNFTDetail(index) {
      currentDetailIndex = index;
      const nft = state.inv[index];
      const r = getRarity(nft.rarity);
      
      document.getElementById("detail-name").textContent = nft.name;
      document.getElementById("detail-rarity").textContent = r.label;
      document.getElementById("detail-rarity").style.color = r.color;
      document.getElementById("detail-rarity").style.borderColor = r.color;
      document.getElementById("detail-rarity").style.background = r.color + "33";
      document.getElementById("detail-emoji").textContent = nft.emoji;
      document.getElementById("detail-visual").style.borderColor = r.color;
      document.getElementById("detail-power").textContent = nft.power;
      document.getElementById("detail-luck").textContent = nft.luck + "%";
      document.getElementById("detail-level").textContent = nft.upgradeLevel + "/" + nft.maxLevel;
      document.getElementById("detail-desc").textContent = nft.desc;
      
      const upgradeBtn = document.getElementById("detail-upgrade-btn");
      if (nft.upgradeLevel >= nft.maxLevel) {
        upgradeBtn.style.display = "none";
      } else {
        upgradeBtn.style.display = "block";
      }
      
      document.getElementById("nft-detail-modal").style.display = "flex";
    }

    function closeNFTDetail() {
      document.getElementById("nft-detail-modal").style.display = "none";
    }

    function upgradeFromDetail() {
      closeNFTDetail();
      openUpgrader();
    }

    // –£–ª—É—á—à–µ–Ω–∏–µ
    function openUpgrader() {
      const grid = document.getElementById("upgrade-select-grid");
      const details = document.getElementById("upgrade-details");
      
      details.style.display = "none";
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å
      const upgradable = state.inv.filter(n => n.upgradeLevel < n.maxLevel);
      
      if (upgradable.length === 0) {
        alert("–ù–µ—Ç NFT –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!");
        return;
      }
      
      grid.innerHTML = upgradable.map((nft, idx) => {
        const originalIndex = state.inv.indexOf(nft);
        const r = getRarity(nft.rarity);
        return `
          <div class="upgrade-nft-option ${currentUpgradingIndex === originalIndex ? 'selected' : ''}" 
               onclick="selectForUpgrade(${originalIndex})">
            <div class="nft-emoji">${nft.emoji}</div>
            <div class="nft-level">Lv.${nft.upgradeLevel}</div>
          </div>
        `;
      }).join('');
      
      document.getElementById("upgrader-modal").style.display = "flex";
    }

    function selectForUpgrade(index) {
      currentUpgradingIndex = index;
      const nft = state.inv[index];
      const r = getRarity(nft.rarity);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ —Å–µ—Ç–∫–µ
      document.querySelectorAll('.upgrade-nft-option').forEach((el, i) => {
        el.classList.toggle('selected', state.inv.filter(n => n.upgradeLevel < n.maxLevel).indexOf(nft) === i);
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏
      document.getElementById("upgrade-details").style.display = "block";
      
      // –ö—Ä—É–≥ —Å —à–∞–Ω—Å–æ–º
      const level = nft.upgradeLevel;
      const chance = Math.max(20, 80 - (level * 12)); // 80% -> 20%
      const deg = (chance / 100) * 360;
      
      document.getElementById("upgrade-circle").style.background = 
        `conic-gradient(var(--gold) 0deg ${deg}deg, rgba(243,186,47,0.1) ${deg}deg 360deg)`;
      document.getElementById("upgrade-percent").textContent = chance + "%";
      
      // –ü—Ä–µ–≤—å—é
      document.getElementById("upgrade-preview").style.borderColor = r.color;
      document.getElementById("upgrade-emoji").textContent = nft.emoji;
      
      // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      const cost = 5000 * (level + 1);
      const risk = 15 + (level * 8); // 15% -> 55%
      
      document.getElementById("upgrade-cost").textContent = formatCoins(cost);
      document.getElementById("upgrade-risk").textContent = risk + "%";
      document.getElementById("upgrade-risk").style.color = risk > 30 ? "var(--red)" : "var(--gold)";
    }

    function performUpgrade() {
      if (currentUpgradingIndex === null) return;
      
      const nft = state.inv[currentUpgradingIndex];
      const level = nft.upgradeLevel;
      const cost = 5000 * (level + 1);
      const risk = 15 + (level * 8);
      const chance = Math.max(20, 80 - (level * 12));
      
      if (state.bal < cost) {
        alert("üí∏ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
        return;
      }
      
      state.bal -= cost;
      
      // –ë—Ä–æ—Å–∞–µ–º –∫—É–±–∏–∫
      const roll = Math.random() * 100;
      
      if (roll < risk) {
        // –ü—Ä–æ–≤–∞–ª - —Ç–µ—Ä—è–µ–º NFT
        state.inv.splice(currentUpgradingIndex, 1);
        alert("üí• –£–ü–°! NFT —É–Ω–∏—á—Ç–æ–∂–µ–Ω –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏!");
        playSound("snd-drop");
      } else if (roll < risk + (100 - chance - risk) / 2) {
        // –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö - +1 —É—Ä–æ–≤–µ–Ω—å
        nft.upgradeLevel++;
        nft.power += 15;
        alert("‚ö° –£–ª—É—á—à–µ–Ω–æ! –£—Ä–æ–≤–µ–Ω—å +" + nft.upgradeLevel);
        playSound("snd-upgrade");
      } else {
        // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Å–ø–µ—Ö - +2 —É—Ä–æ–≤–Ω—è –∏–ª–∏ —Ä–µ–¥–∫–æ—Å—Ç—å++
        if (nft.upgradeLevel < nft.maxLevel - 1) {
          nft.upgradeLevel += 2;
          nft.power += 30;
          alert("üåü –ö–†–ò–¢! –£—Ä–æ–≤–µ–Ω—å +" + nft.upgradeLevel);
        } else {
          // –ü–æ–≤—ã—à–∞–µ–º —Ä–µ–¥–∫–æ—Å—Ç—å
          const currentRarityIdx = RARITY.findIndex(r => r.code === nft.rarity);
          if (currentRarityIdx < 4) {
            nft.rarity = RARITY[currentRarityIdx + 1].code;
            nft.power += 50;
            alert("üöÄ –≠–í–û–õ–Æ–¶–ò–Ø! –†–µ–¥–∫–æ—Å—Ç—å –ø–æ–≤—ã—à–µ–Ω–∞!");
          } else {
            nft.upgradeLevel++;
            nft.power += 20;
            alert("‚ö° –ú–ê–ö–°–ò–ú–£–ú! –°–∏–ª–∞ +" + nft.power);
          }
        }
        playSound("snd-upgrade");
      }
      
      updateBalance();
      saveState();
      renderInventory();
      updateProfile();
      closeUpgrader();
    }

    function closeUpgrader() {
      document.getElementById("upgrader-modal").style.display = "none";
      currentUpgradingIndex = null;
    }

    // –ö—Ä–∞—Ñ—Ç
    function craftItems() {
      if (state.inv.length < 3) {
        alert("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 3 NFT!");
        return;
      }
      
      // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 3
      const materials = state.inv.slice(0, 3);
      const avgPower = Math.floor(materials.reduce((a, b) => a + b.power, 0) / 3);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–¥–∫–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      const rarityCounts = {};
      materials.forEach(m => {
        rarityCounts[m.rarity] = (rarityCounts[m.rarity] || 0) + 1;
      });
      
      let resultTier = "COMMON";
      if (rarityCounts["MYTH"] >= 1) resultTier = "LEGEND";
      else if (rarityCounts["LEGEND"] >= 1) resultTier = "EPIC";
      else if (rarityCounts["EPIC"] >= 2) resultTier = "EPIC";
      else if (rarityCounts["RARE"] >= 2) resultTier = "RARE";
      
      const crafted = generateNFT(resultTier);
      crafted.power = avgPower + 25;
      crafted.name = "Crafted " + crafted.name;
      crafted.emoji = "‚ú®";
      
      state.inv.splice(0, 3);
      state.inv.push
