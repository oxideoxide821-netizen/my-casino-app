<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Business Empire Tycoon - 4 Years Edition</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap');
    body { background: #050505; color: white; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    .glass { background: rgba(20, 20, 30, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
    .glass-strong { background: rgba(30, 30, 45, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.15); }
    .gold-text { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .price-up { color: #4ade80; text-shadow: 0 0 10px rgba(74, 222, 128, 0.5); animation: pulse-green 2s infinite; }
    .price-down { color: #f87171; text-shadow: 0 0 10px rgba(248, 113, 113, 0.5); animation: pulse-red 2s infinite; }
    @keyframes pulse-green { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    @keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .bar-green { background: linear-gradient(180deg, #4ade80 0%, #22c55e 100%); box-shadow: 0 0 10px rgba(74, 222, 128, 0.5); animation: grow-up 0.5s ease-out; }
    .bar-red { background: linear-gradient(180deg, #f87171 0%, #ef4444 100%); box-shadow: 0 0 10px rgba(248, 113, 113, 0.5); animation: grow-up 0.5s ease-out; }
    @keyframes grow-up { from { transform: scaleY(0); } to { transform: scaleY(1); } }
    .btn-press:active { transform: scale(0.95); }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .notification { animation: slide-in 0.3s ease-out; }
    @keyframes slide-in { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .rainbow-text { background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3); background-size: 400% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: rainbow 3s linear infinite; }
    @keyframes rainbow { 0% { background-position: 0% 50%; } 100% { background-position: 400% 50%; } }
    .shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); background-size: 200% 100%; animation: shimmer 2s infinite; }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    /* Набор иконок, которых достаточно для всей игры */

    const Icons = {
      TrendingUp: ({className}) => (
        <svg className={className} width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2.5">
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
          <polyline points="17 6 23 6 23 12" />
        </svg>
      ),
      TrendingDown: ({className}) => (
        <svg className={className} width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2.5">
          <polyline points="23 18 13.5 8.5 8.5 13.5 1 6" />
          <polyline points="17 18 23 18 23 12" />
        </svg>
      ),
      DollarSign: () => (
        <svg width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2">
          <line x1="12" y1="1" x2="12" y2="23" />
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
        </svg>
      ),
      Users: () => (
        <svg width="20" height="20" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
          <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
          <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
      ),
      Bell: () => (
        <svg width="18" height="18" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
          <path d="M13.73 21a2 2 0 0 1-3.46 0" />
        </svg>
      ),
      Target: () => (
        <svg width="18" height="18" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2">
          <circle cx="12" cy="12" r="10" />
          <circle cx="12" cy="12" r="6" />
          <circle cx="12" cy="12" r="2" />
        </svg>
      ),
      Rocket: () => (
        <svg width="24" height="24" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" strokeWidth="2">
          <path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z" />
          <path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z" />
        </svg>
      ),
    };

    /* Данные игры */

    const INITIAL_BUSINESSES = [
      { id: 1, name: 'Ларёк с шаурмой', level: 1, baseIncome: 1500, employees: 1, costToUpgrade: 5000 },
      { id: 2, name: 'Кофейня у офиса', level: 0, baseIncome: 6000, employees: 0, costToUpgrade: 20000 },
      { id: 3, name: 'Онлайн‑магазин мерча', level: 0, baseIncome: 14000, employees: 0, costToUpgrade: 45000 }
    ];

    const INITIAL_STOCKS = [
      { id: 'CHKN', name: 'Chicken House Corp', price: 120, change: 0, owned: 0 },
      { id: 'TECH', name: 'Techno Future', price: 300, change: 0, owned: 0 },
      { id: 'OILX', name: 'OilX Energy', price: 80, change: 0, owned: 0 }
    ];

    const GAME_YEARS = 4;
    const MONTHS_TOTAL = GAME_YEARS * 12;

    function Notification({ item, onClose }) {
      useEffect(() => {
        const t = setTimeout(onClose, 4000);
        return () => clearTimeout(t);
      }, [onClose]);

      return (
        <div className="notification glass-strong px-4 py-3 rounded-xl shadow-lg mb-3 border border-emerald-400/40 flex items-start gap-3">
          <div className="mt-0.5 text-emerald-400">
            <Icons.Bell />
          </div>
          <div className="flex-1">
            <div className="text-sm font-semibold">{item.title}</div>
            <div className="text-xs text-neutral-300 mt-0.5">{item.text}</div>
          </div>
          <button
            className="text-xs text-neutral-400 hover:text-white"
            onClick={onClose}
          >
            ✕
          </button>
        </div>
      );
    }

    function NotificationsPanel({ list, remove }) {
      return (
        <div className="fixed right-4 bottom-4 max-w-xs z-50 space-y-2">
          {list.map(n => (
            <Notification key={n.id} item={n} onClose={() => remove(n.id)} />
          ))}
        </div>
      );
    }

    function BusinessCard({ b, onUpgrade }) {
      const monthlyIncome = b.baseIncome * (1 + 0.35 * (b.level - 1));

      return (
        <div className="glass rounded-2xl p-4 flex flex-col gap-2">
          <div className="flex items-center justify-between">
            <div className="text-sm font-semibold">{b.name}</div>
            <div className="flex items-center gap-1 text-xs text-emerald-300">
              <Icons.DollarSign />
              <span>доход {Math.round(monthlyIncome).toLocaleString()} ₽/мес</span>
            </div>
          </div>
          <div className="flex items-center justify-between text-xs text-neutral-300">
            <span>Уровень: {b.level}</span>
            <span>Сотрудники: {b.employees}</span>
          </div>
          <button
            className="mt-2 w-full btn-press text-xs bg-emerald-500 hover:bg-emerald-400 text-black font-semibold py-2 rounded-xl disabled:bg-neutral-700 disabled:text-neutral-400"
            onClick={() => onUpgrade(b)}
          >
            Улучшить за {b.costToUpgrade.toLocaleString()} ₽
          </button>
        </div>
      );
    }

    function StockCard({ s, onBuy, onSell, balance }) {
      const canBuy = balance >= s.price;
      const canSell = s.owned > 0;

      return (
        <div className="glass rounded-2xl p-4 flex flex-col gap-2">
          <div className="flex items-center justify-between">
            <div>
              <div className="text-sm font-semibold">{s.name}</div>
              <div className="text-[11px] text-neutral-400">{s.id}</div>
            </div>
            <div className="text-right">
              <div className="text-sm font-mono">
                {s.price.toLocaleString()} ₽
              </div>
              <div className={`text-[11px] font-mono ${s.change >= 0 ? 'price-up' : 'price-down'}`}>
                {s.change >= 0 ? '+' : ''}{s.change.toFixed(1)}%
              </div>
            </div>
          </div>

          <div className="flex items-center justify-between text-xs text-neutral-300">
            <span>В портфеле: {s.owned} шт.</span>
          </div>

          <div className="mt-2 grid grid-cols-2 gap-2 text-xs">
            <button
              disabled={!canBuy}
              onClick={() => onBuy(s)}
              className="btn-press bg-emerald-500 hover:bg-emerald-400 disabled:bg-neutral-700 disabled:text-neutral-400 text-black font-semibold py-1.5 rounded-xl"
            >
              Купить
            </button>
            <button
              disabled={!canSell}
              onClick={() => onSell(s)}
              className="btn-press bg-neutral-800 hover:bg-neutral-700 disabled:bg-neutral-700 disabled:text-neutral-400 text-white font-semibold py-1.5 rounded-xl"
            >
              Продать
            </button>
          </div>
        </div>
      );
    }

    function App() {
      const [month, setMonth] = useState(1);
      const [balance, setBalance] = useState(50000);
      const [businesses, setBusinesses] = useState(INITIAL_BUSINESSES);
      const [stocks, setStocks] = useState(INITIAL_STOCKS);
      const [netWorth, setNetWorth] = useState(50000);
      const [notifications, setNotifications] = useState([]);
      const [finished, setFinished] = useState(false);

      const notifId = useRef(1);

      const pushNotification = (title, text) => {
        const id = notifId.current++;
        setNotifications(prev => [...prev, { id, title, text }]);
      };

      const removeNotification = (id) => {
        setNotifications(prev => prev.filter(n => n.id !== id));
      };

      const totalBusinessIncome = businesses.reduce((acc, b) => {
        if (b.level <= 0) return acc;
        const income = b.baseIncome * (1 + 0.35 * (b.level - 1));
        return acc + income;
      }, 0);

      const portfolioValue = stocks.reduce(
        (acc, s) => acc + s.owned * s.price,
        0
      );

      useEffect(() => {
        setNetWorth(balance + portfolioValue);
      }, [balance, portfolioValue]);

      const handleUpgradeBusiness = (biz) => {
        if (balance < biz.costToUpgrade) {
          pushNotification('Недостаточно денег', `Для улучшения «${biz.name}» нужно ещё ${(biz.costToUpgrade - balance).toLocaleString()} ₽`);
          return;
        }
        setBalance(b => b - biz.costToUpgrade);
        setBusinesses(prev =>
          prev.map(x =>
            x.id === biz.id
              ? {
                  ...x,
                  level: x.level + 1,
                  employees: x.employees + 1,
                  costToUpgrade: Math.round(x.costToUpgrade * 1.9)
                }
              : x
          )
        );
        pushNotification('Бизнес улучшен', `«${biz.name}» теперь уровня ${biz.level + 1}!`);
      };

      const randomizeStocks = () => {
        setStocks(prev =>
          prev.map(s => {
            const delta = (Math.random() * 14 - 7);
            const newPrice = Math.max(15, Math.round(s.price * (1 + delta / 100)));
            return { ...s, price: newPrice, change: delta };
          })
        );
      };

      const handleBuyStock = (stock) => {
        if (balance < stock.price) {
          pushNotification('Не хватает денег', `Нужно минимум ${stock.price.toLocaleString()} ₽ для покупки акции ${stock.id}.`);
          return;
        }
        setBalance(b => b - stock.price);
        setStocks(prev =>
          prev.map(s =>
            s.id === stock.id ? { ...s, owned: s.owned + 1 } : s
          )
        );
      };

      const handleSellStock = (stock) => {
        if (stock.owned <= 0) return;
        setBalance(b => b + stock.price);
        setStocks(prev =>
          prev.map(s =>
            s.id === stock.id ? { ...s, owned: s.owned - 1 } : s
          )
        );
      };

      const nextMonth = () => {
        if (finished) return;

        const income = totalBusinessIncome;
        const expenses = Math.round(Math.random() * 0.25 * income);
        const delta = income - expenses;

        setBalance(b => b + delta);

        randomizeStocks();

        if (delta >= 0) {
          pushNotification('Месяц закрыт с прибылью', `+${delta.toLocaleString()} ₽ (доходы ${income.toLocaleString()} ₽, расходы ${expenses.toLocaleString()} ₽).`);
        } else {
          pushNotification('Месяц в минусе', `${delta.toLocaleString()} ₽ (доходы ${income.toLocaleString()} ₽, расходы ${expenses.toLocaleString()} ₽).`);
        }

        setMonth(m => {
          const next = m + 1;
          if (next > MONTHS_TOTAL) {
            setFinished(true);
            pushNotification('Игра завершена', '4 года прошли! Посмотри свой итоговый капитал.');
            return m;
          }
          return next;
        });
      };

      const restart = () => {
        setMonth(1);
        setBalance(50000);
        setBusinesses(INITIAL_BUSINESSES);
        setStocks(INITIAL_STOCKS);
        setFinished(false);
        setNotifications([]);
      };

      const year = Math.ceil(month / 12);
      const monthInYear = ((month - 1) % 12) + 1;
      const progress = Math.round((month / MONTHS_TOTAL) * 100);

      return (
        <div className="min-h-screen flex flex-col items-center justify-center px-4 py-6">
          <div className="max-w-5xl w-full space-y-4">
            <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
              <div>
                <div className="text-xs uppercase tracking-[0.3em] text-neutral-500 mb-1">
                  BUSINESS EMPIRE • 4 YEARS
                </div>
                <h1 className="text-2xl md:text-3xl font-extrabold">
                  Построй свою <span className="gold-text">бизнес‑империю</span> за 4 года
                </h1>
              </div>
              <div className="glass-strong rounded-2xl px-4 py-2 flex items-center gap-3 text-xs">
                <Icons.Target />
                <div>
                  <div className="font-semibold text-sm">Цель</div>
                  <div className="text-neutral-300">Достигни капитала 5 000 000 ₽ к концу 4‑го года.</div>
                </div>
              </div>
            </div>

            <div className="grid md:grid-cols-4 gap-3">
              <div className="glass-strong rounded-2xl p-3 flex flex-col gap-2">
                <div className="flex items-center justify-between text-xs text-neutral-400">
                  <span>Текущий месяц</span>
                  <span>{year} год</span>
                </div>
                <div className="flex items-end justify-between">
                  <div className="text-2xl font-bold">{monthInYear}/12</div>
                  <div className="text-xs text-neutral-300">{month}/{MONTHS_TOTAL} мес</div>
                </div>
                <div className="mt-2 h-1.5 w-full bg-neutral-800 rounded-full overflow-hidden">
                  <div
                    className="h-full bg-gradient-to-r from-emerald-400 to-emerald-600"
                    style={{ width: `${progress}%` }}
                  />
                </div>
              </div>

              <div className="glass rounded-2xl p-3 flex flex-col gap-1">
                <div className="flex items-center justify-between text-xs text-neutral-400">
                  <span>Баланс</span>
                  <Icons.DollarSign />
                </div>
                <div className="text-xl font-bold">
                  {balance.toLocaleString()} ₽
                </div>
                <div className="text-[11px] text-neutral-400">Наличные средства</div>
              </div>

              <div className="glass rounded-2xl p-3 flex flex-col gap-1">
                <div className="flex items-center justify-between text-xs text-neutral-400">
                  <span>Доход бизнеса</span>
                  <Icons.Users />
                </div>
                <div className="text-xl font-bold">
                  {Math.round(totalBusinessIncome).toLocaleString()} ₽/мес
                </div>
                <div className="text-[11px] text-neutral-400">Суммарный пассивный доход</div>
              </div>

              <div className="glass rounded-2xl p-3 flex flex-col gap-1">
                <div className="flex items-center justify-between text-xs text-neutral-400">
                  <span>Чистый капитал</span>
                  <Icons.Rocket />
                </div>
                <div className="text-xl font-bold">
                  {netWorth.toLocaleString()} ₽
                </div>
                <div className="text-[11px] text-neutral-400">
                  Портфель: {portfolioValue.toLocaleString()} ₽
                </div>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-4">
              <div className="glass-strong rounded-3xl p-4 space-y-3">
                <div className="flex items-center justify-between mb-1">
                  <div className="flex items-center gap-2">
                    <Icons.Users />
                    <div className="text-sm font-semibold">Твои бизнесы</div>
                  </div>
                  <div className="text-[11px] text-neutral-400">
                    Улучшай, чтобы увеличить пассивный доход
                  </div>
                </div>
                <div className="space-y-3">
                  {businesses.map(b => (
                    <BusinessCard
                      key={b.id}
                      b={b}
                      onUpgrade={handleUpgradeBusiness}
                    />
                  ))}
                </div>
              </div>

              <div className="glass-strong rounded-3xl p-4 space-y-3">
                <div className="flex items-center justify-between mb-1">
                  <div className="flex items-center gap-2">
                    <Icons.TrendingUp className="text-emerald-400" />
                    <div className="text-sm font-semibold">Фондовый рынок</div>
                  </div>
                  <div className="text-[11px] text-neutral-400">
                    Покупай акции и спекулируй на колебаниях
                  </div>
                </div>
                <div className="space-y-3">
                  {stocks.map(s => (
                    <StockCard
                      key={s.id}
                      s={s}
                      balance={balance}
                      onBuy={handleBuyStock}
                      onSell={handleSellStock}
                    />
                  ))}
                </div>
              </div>
            </div>

            <div className="glass-strong rounded-2xl p-3 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
              <div className="text-xs text-neutral-300">
                Каждый ход = 1 месяц. К концу 4‑го года смотри, насколько вырос твой капитал.
              </div>
              <div className="flex gap-2">
                <button
                  onClick={restart}
                  className="btn-press px-4 py-2 rounded-xl text-xs border border-neutral-600 text-neutral-200 hover:bg-neutral-800"
                >
                  Начать заново
                </button>
                <button
                  onClick={nextMonth}
                  disabled={finished}
                  className="btn-press px-4 py-2 rounded-xl text-xs bg-emerald-500 hover:bg-emerald-400 disabled:bg-neutral-700 disabled:text-neutral-400 text-black font-semibold"
                >
                  {finished ? 'Игра завершена' : 'Следующий месяц →'}
                </button>
              </div>
            </div>

            {finished && (
              <div className="glass-strong rounded-2xl p-4 border border-emerald-400/40">
                <div className="text-sm font-semibold mb-1">
                  4 года пролетели!
                </div>
                <div className="text-xs text-neutral-300">
                  Твой конечный капитал: <span className="gold-text font-semibold">{netWorth.toLocaleString()} ₽</span>. Попробуй другой стиль игры: агрессивные инвестиции, консервативный портфель или упор на рост бизнеса.
                </div>
              </div>
            )}
          </div>

          <NotificationsPanel list={notifications} remove={removeNotification} />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
