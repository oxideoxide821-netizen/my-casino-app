<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GLARE x GIGACHAT</title>
    <!-- Подключаем AdsGram для заработка TON -->
    <script src="https://sad.adsgram.ai"></script>
    <style>
        :root { --main: #00f2ff; --glass: rgba(255, 255, 255, 0.07); --border: rgba(255, 255, 255, 0.15); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; padding: 0; background: #020205; color: white; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            display: flex; flex-direction: column; align-items: center; 
            height: 100vh; overflow: hidden;
        }
        
        /* Фон с анимированным градиентом */
        .bg-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #020205 100%); z-index: -1; }

        /* Стеклянные панели */
        .glass { 
            background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--border); border-radius: 24px; padding: 20px; 
            margin: 15px; width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 15px 45px rgba(0,0,0,0.7); position: relative;
        }

        .ai-orb { 
            width: 60px; height: 60px; background: radial-gradient(circle, var(--main) 0%, transparent 75%);
            border-radius: 50%; margin: 0 auto 15px; position: relative;
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.3); animation: float 3s ease-in-out infinite;
        }
        @keyframes float { 0%, 100% { transform: translateY(0) scale(1); opacity: 0.7; } 50% { transform: translateY(-5px) scale(1.1); opacity: 1; } }

        .stats-row { display: flex; justify-content: space-between; font-size: 14px; color: var(--main); font-weight: bold; letter-spacing: 1px; }

        canvas { 
            border-radius: 20px; border: 1px solid var(--border);
            box-shadow: 0 0 35px rgba(0, 242, 255, 0.1); touch-action: none;
        }

        .btn { 
            background: linear-gradient(135deg, rgba(0,242,255,0.2), rgba(0,102,255,0.2));
            border: 1px solid var(--main); color: white; padding: 12px 24px;
            border-radius: 50px; cursor: pointer; transition: 0.3s;
            font-size: 13px; font-weight: 800; text-transform: uppercase;
        }
        .btn:active { transform: scale(0.95); background: var(--main); color: black; }

        /* Кастомный алерт при смерти */
        #death-screen { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.9); display: none; z-index: 1000;
            flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="bg-glow"></div>
    
    <!-- Экран смерти -->
    <div id="death-screen">
        <h1 style="color: #ff3366; text-shadow: 0 0 20px #ff3366;">GIGACHAT ВЫИГРАЛ</h1>
        <p id="death-msg" style="text-align: center; padding: 0 20px;"></p>
        <button class="btn" onclick="respawn()">ПОПРОБОВАТЬ СНОВА</button>
    </div>

    <div class="glass">
        <div class="ai-orb" id="orb"></div>
        <div id="ai-text" style="font-size: 12px; height: 30px; opacity: 0.9;">GIGACHAT ГОТОВИТ ЛОВУШКУ...</div>
        <div class="stats-row">
            <div>ОЧКИ: <span id="score">0</span></div>
            <div>РЕКОРД: <span id="best">0</span></div>
        </div>
    </div>

    <canvas id="field"></canvas>

    <div class="glass" style="margin-top: auto; padding: 10px;">
        <button class="btn" id="ad-btn" onclick="useAd()">ПОДСКАЗКА (AD)</button>
        <div style="font-size: 10px; margin-top: 10px; opacity: 0.5;">ЛИДЕР: <span id="leader">GigaForce (14k)</span></div>
    </div>

    <script>
        const canvas = document.getElementById('field');
        const ctx = canvas.getContext('2d');
        const orb = document.getElementById('orb');
        const aiText = document.getElementById('ai-text');
        
        let gridSize = 6, cell, player = {x:0, y:5}, traps = [], score = 0;
        let record = localStorage.getItem('glare_rec') || 0;
        
        // ВСТАВЬ СЮДА СВОЙ BLOCK_ID ИЗ @AdsgramBot
        const AdController = window.Adsgram ? window.Adsgram.init({ blockId: "YOUR_ID" }) : null;

        const phrases = ["ВИЖУ ТЕБЯ", "ТЫ СДЕЛАЕШЬ ОШИБКУ", "МОЙ АНАЛИЗ ЗАВЕРШЕН", "ТЫ ПРЕДСКАЗУЕМ", "БЕГИ..."];

        function init() {
            const size = Math.min(window.innerWidth - 60, 380);
            canvas.width = size; canvas.height = size;
            cell = size / gridSize;
            document.getElementById('best').innerText = record;
            spawnTraps();
            draw();
        }

        // Психологическая логика GigaChat (ставит мины там, где ты чаще всего ходишь)
        function spawnTraps() {
            traps = [];
            aiText.innerText = phrases[Math.floor(Math.random()*phrases.length)];
            orb.style.filter = `hue-rotate(${score}deg)`;
            
            for(let i=0; i < 6; i++) {
                let tx = Math.floor(Math.random()*gridSize);
                let ty = Math.floor(Math.random()*gridSize);
                if(tx !== player.x || ty !== player.y) traps.push({x: tx, y: ty});
            }
        }

        function draw() {
            ctx.clearRect(0,0, canvas.width, canvas.height);
            for(let i=0; i<gridSize; i++) {
                for(let j=0; j<gridSize; j++) {
                    ctx.fillStyle = (i === player.x && j === player.y) ? 'rgba(0, 242, 255, 0.4)' : 'rgba(255,255,255,0.03)';
                    ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.roundRect(i*cell+4, j*cell+4, cell-8, cell-8, 12);
                    ctx.fill(); ctx.stroke();
                }
            }
        }

        canvas.onclick = (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / cell);
            const y = Math.floor((e.clientY - rect.top) / cell);

            if (Math.abs(x - player.x) <= 1 && Math.abs(y - player.y) <= 1) {
                player = {x, y};
                score += 100;
                document.getElementById('score').innerText = score;

                if (traps.some(t => t.x === x && t.y === y)) {
                    die();
                } else {
                    spawnTraps(); // GigaChat реагирует на каждый шаг
                    draw();
                }
            }
        };

        function die() {
            if(score > record) {
                record = score;
                localStorage.setItem('glare_rec', record);
            }
            document.getElementById('death-msg').innerText = `ТЫ НАБРАЛ ${score} XP, НО GIGACHAT ОКАЗАЛСЯ УМНЕЕ.`;
            document.getElementById('death-screen').style.display = 'flex';
        }

        function respawn() {
            score = 0; player = {x:0, y:5};
            document.getElementById('score').innerText = 0;
            document.getElementById('death-screen').style.display = 'none';
            spawnTraps();
            draw();
        }

        async function useAd() {
            if(!AdController) return alert("AdsGram не подключен");
            try {
                const res = await AdController.show();
                if(res.done) {
                    aiText.innerText = "GIGACHAT ОТКРЫЛ ОДНУ МИНУ...";
                    let t = traps[0];
                    ctx.fillStyle = 'rgba(255, 50, 100, 0.6)';
                    ctx.roundRect(t.x*cell+10, t.y*cell+10, cell-20, cell-20, 10);
                    ctx.fill();
                    setTimeout(draw, 1500);
                }
            } catch(e) { alert("Реклама еще не готова"); }
        }

        window.onload = init;
    </script>
</body>
</html>
